"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[567361],{28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>c});var s=o(296540);const t={},i=s.createContext(t);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},746163:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"enterpriseauditor/solutions/databases/sql/recommended","title":"Recommended Configurations","description":"The following sections describe the recommended configurations for the SQL Solution 0.Collection Job Group and the Azure SQL 0.Collection Job Group.","source":"@site/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/recommended.md","sourceDirName":"enterpriseauditor/solutions/databases/sql","slug":"/enterpriseauditor/solutions/databases/sql/recommended","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/recommended","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/recommended.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"SQL\\\\_ServerPermissions Job","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/permissions/sql_serverpermissions"},"next":{"title":"5.Sensitive Data Job Group","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/sensitivedata/overview"}}');var t=o(474848),i=o(28453);const r={},c="Recommended Configurations",l={},a=[{value:"SQL Solution 0.Collection Job Group",id:"sql-solution-0collection-job-group",level:2},{value:"Azure SQL 0.Collection Job Group",id:"azure-sql-0collection-job-group",level:2}];function d(e){const n={a:"a",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"recommended-configurations",children:"Recommended Configurations"})}),"\n",(0,t.jsx)(n.p,{children:"The following sections describe the recommended configurations for the SQL Solution 0.Collection Job Group and the Azure SQL 0.Collection Job Group."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," The SQL Solution Jobs report on both the SQL and Azure SQL Collection Jobs."]}),"\n",(0,t.jsx)(n.h2,{id:"sql-solution-0collection-job-group",children:"SQL Solution 0.Collection Job Group"}),"\n",(0,t.jsx)(n.p,{children:"The SQL Solution has been configured to inherit down from the SQL > Settings node. However, it is best practice to assign the host list and the Connection Profile at the data collection level, the 0.Collection Job Group. Once these are assigned to the job group, it can be run directly or scheduled."}),"\n",(0,t.jsx)(n.p,{children:"Dependencies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:".Active Directory Inventory Job Group run successfully"}),"\n",(0,t.jsxs)(n.li,{children:["For Activity Auditing \u2013 SQL Server Audit Specifications to be configured on the target databases","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Audit destination must be a binary file"}),"\n",(0,t.jsxs)(n.li,{children:["See the Microsoft ",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/sql/relational-databases/security/auditing/create-a-server-audit-and-database-audit-specification",children:"Create a Server Audit and Database Audit Specification"})," article for additional information."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["For the SQL_SecurityAssessment Job \u2013 One or more of the following jobs or job groups must be run to produce results:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/collection/overview",children:"0.Collection > SQL Job Group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/usersroles/overview",children:"1.Users and Roles Job Group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/permissions/overview",children:"3.Permissions Job Group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/sensitivedata/overview",children:"5.Sensitive Data Job Group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/windows/privilegedaccounts/overview",children:"Privileged Accounts Job Group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/windows/privilegedaccounts/overview",children:"Privileged Accounts Job Group"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Some of the 0.Collection Job Group queries can be scoped to target specific databases/instances. However, it is necessary for the SA_SQL_Instances table to be populated before attempting to scope the queries. Therefore, the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/sql/collection/sql_instancediscovery",children:"0-SQL_InstanceDiscovery Job"})," must be manually executed before attempting to scope the 0.Collection Job Group queries."]}),"\n",(0,t.jsx)(n.p,{children:"Targeted Host(s)"}),"\n",(0,t.jsx)(n.p,{children:"The 0.Collection Job Group has been set to run against the following default dynamic host list:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"All Microsoft SQL Server Hosts"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," Default dynamic host lists are populated from hosts in the Host Master Table which meet the host inventory criteria for the list. Ensure the appropriate host list(s) have been populated through host inventory results."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Connection Profile"}),"\n",(0,t.jsxs)(n.p,{children:["The SQL Data Collector requires a specific set of permissions. See the Permissions section for necessary permissions. The account used can be either an Active Directory account or a SQL account. Once the account has been provisioned, create a custom Connection Profile containing the credentials for the targeted environment. See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/datacollector/sql/configurejob",children:"SQL\xa0Custom Connection Profile & Default Dynamic Host List"})," topic for additional information."]}),"\n",(0,t.jsx)(n.p,{children:"The Connection Profile should be assigned under the SQL > 0.Collection > Settings > Connection node. It is set to Use the Default Profile, as configured at the global settings level. However, since this may not be the Connection Profile with the necessary permissions for the assigned hosts, click the radio button for the Select one of the following user defined profiles option and select the appropriate Connection Profile drop-down menu."}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/settings/connection/overview",children:"Connection"})," topic for additional information."]}),"\n",(0,t.jsx)(n.p,{children:"Schedule Frequency"}),"\n",(0,t.jsx)(n.p,{children:"One of the most important decisions to make is how frequently to collect this data. The SQL Job Group can be scheduled to run as desired depending on the types of auditing being conducted and the scope of the target environment. The general recommendation is to schedule the solution to run daily."}),"\n",(0,t.jsx)(n.p,{children:"Run Order"}),"\n",(0,t.jsx)(n.p,{children:"The 0.Collection Jobs must be run first and in order. The other SQL Solution sub-job groups can be run in any order, together or individually, after running the 0.Collection Job Group."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"RECOMMENDED:"})})," Run the solution at the top level."]}),"\n",(0,t.jsx)(n.p,{children:"Workflow"}),"\n",(0,t.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Successful execution of the .Active Directory Inventory Job Group"}),"\n",(0,t.jsx)(n.li,{children:"For the 3-SQL_ActivityScan, configure SQL Server Audit and SQL Server Audit Specifications on target SQL Server Databases. Audit destination for the configured server or database audit must be a binary file."}),"\n",(0,t.jsxs)(n.li,{children:["The 5-SQL_ServerSettings Job contains the Orphaned Users query which returns users that are orphaned for each database. The query uses the sp_Change_users_login procedure which requires the db_owner fixed database to be assigned to the Access Analyzer User. See the ",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql?view=sql-server-ver15",children:"sp_change_users_login (Transact-SQL)"})," Microsoft article for additional information."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"(Optional) Configure the queries for the jobs in the 0.Collection Job Group"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Schedule the 0.Collection Job Group to run daily or as desired"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," Running the 0.Collection Job Group is a prerequisite for the other job groups in the SQL solution"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Review the reports generated by the 0.Collection Job Group\u2019s jobs"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"azure-sql-0collection-job-group",children:"Azure SQL 0.Collection Job Group"}),"\n",(0,t.jsx)(n.p,{children:"The Azure SQL Solution has been configured to inherit down from the Azure SQL > Settings node. However, it is best practice to assign the host list and the Connection Profile at the data collection level, the 0.Collection Job Group. Once these are assigned to the job group, it can be run directly or scheduled."}),"\n",(0,t.jsx)(n.p,{children:"Dependencies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Full registration within Microsoft's Azure portal:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Creation of a Access Analyzer Azure SQL\xa0Role in the Access control (IAM)\xa0section"}),"\n",(0,t.jsx)(n.li,{children:"Successful registration of the Access Analyzer app"}),"\n",(0,t.jsx)(n.li,{children:"Successful creation of an Application (client)\xa0ID"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Successful configuration of an AzureSQL-specific connection profile"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Creation of an Azure Tenancy host list (ex. COMPANY.onmicrosoft.com) and Azure Active Directory user credential(s)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"RECOMMENDED:"})})," To avoid functional issues with Access Analyzer, create multiple connection profiles to accommodate multiple credentials."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Define and validate connection information in the Connection screen"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/databases/azuresql/collection/azuresql_instancediscovery",children:"0-AzureSQL_InstanceDiscovery Job"})," run successfully"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Targeted Host(s)"}),"\n",(0,t.jsx)(n.p,{children:"The 0.Collection Job Group has been set to run against the following default dynamic host list:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All targeted Azure SQL Tenants"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Connection Profile"}),"\n",(0,t.jsxs)(n.p,{children:["The SQL Data Collector requires a specific set of permissions. See the Permissions section for necessary permissions. The account used can be either an Active Directory account with database login enabled or a SQL account. Once the account has been provisioned, create a custom Connection Profile containing the credentials for the targeted environment. See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/datacollector/sql/configurejob",children:"SQL\xa0Custom Connection Profile & Default Dynamic Host List"})," topic for additional information."]}),"\n",(0,t.jsxs)(n.p,{children:["The Connection Profile should be assigned under the ",(0,t.jsx)(n.strong,{children:"Databases"})," > 0.Collection > Azure SQL > Settings > Connection node. It is set to Use the Default Profile, as configured at the global settings level. However, since this may not be the Connection Profile with the necessary permissions for the assigned hosts, click the radio button for the Select one of the following user defined profiles option and select the appropriate Connection Profile drop-down menu."]}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/settings/connection/overview",children:"Connection"})," topic for additional information."]}),"\n",(0,t.jsx)(n.p,{children:"Schedule Frequency"}),"\n",(0,t.jsx)(n.p,{children:"One of the most important decisions to make is how frequently to collect this data. The Azure SQL Job Group can be scheduled to run as desired depending on the types of auditing being conducted and the scope of the target environment. The general recommendation is to schedule the solution to run daily."}),"\n",(0,t.jsx)(n.p,{children:"Run Order"}),"\n",(0,t.jsx)(n.p,{children:"The 0.Collection Jobs must be run first and in order. The other Azure SQL Solution sub-job groups can be run in any order, together or individually, after running the 0.Collection Job Group."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"RECOMMENDED:"})})," Run the solution at the top level."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);