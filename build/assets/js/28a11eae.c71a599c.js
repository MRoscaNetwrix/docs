"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[665967],{28453:(e,t,o)=>{o.d(t,{R:()=>i,x:()=>r});var n=o(296540);const s={},a=n.createContext(s);function i(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(a.Provider,{value:t},e.children)}},74383:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7ee5e-img-18-e9aa98bc91eddfa1a06b6d77a65fb315.webp"},94672:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7ec3c-img-17-8a8a26ccb6c4709dbe80e1080b2d1f0d.webp"},123107:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bb83ef-img-02-55f555c937dd6e0750ad6b834c632b1f.webp"},132936:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bec541-img-10-292a105ea9a19f69078d9e77d562583e.webp"},322648:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7ec45-img-01-d48aa5c90682fd6da219925ca04e12e5.webp"},334752:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bdece8-img-11-279ce373912dee387662ba4552d9e96e.webp"},363897:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bdece8-img-16-f45b89d3d29e9920e08e124cda6c8cee.webp"},370439:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bec541-img-15-38aa795740ffc12475242d283cc27047.webp"},370694:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7e4f0-img-21-ce2dd147e2df641a770c0f06fefcd947.webp"},500406:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bc37d5-img-12-b9dd9ca73277ee4cd97c06d068174a1c.webp"},600098:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7e690-img-19-a763a6014ab620aea1729beadada65c9.webp"},609487:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570b7ed35-img-20-eae16b2697effd8731aa7ef1c572ab5c.webp"},630056:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570be4088-img-09-0e5b50d497ad3314ba00f08f7c6058e0.webp"},647548:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570be8938-img-13-99bde9b542a4a217fca8d6b53bbe5852.webp"},741132:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"policypak/tips/eventlogs","title":"Windows 10 (and Server) Event Logs to Azure Log Analytics Walkthru","description":"It\'s a Cloud, Cloud, Cloud, Cloud, Cloud, Cloud world. Except actually most of your stuff is still likely mostly on-prem, or acts that way. Take Windows 10 for instance. Windows 10 has events in the event logs, and maybe you already know about on-prem Event Forwarding.","source":"@site/docs/policypak/policypak/tips/eventlogs.md","sourceDirName":"policypak/tips","slug":"/policypak/tips/eventlogs","permalink":"/docs/policypak/policypak/tips/eventlogs","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/policypak/policypak/tips/eventlogs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"policyPakSidebar","previous":{"title":"List of Endpoint Policy Manager Event Categories and IDs","permalink":"/docs/policypak/policypak/tips/eventcategories"},"next":{"title":"How does Endpoint Policy Manager perform Folder Redirection or OneDrive Known Folder Move (KFM) with Endpoint Policy Manager Group Policy, Endpoint Policy ManagerMDM or Endpoint Policy Manager Cloud?","permalink":"/docs/policypak/policypak/tips/folderredirection"}}');var s=o(474848),a=o(28453);const i={},r="Windows 10 (and Server) Event Logs to Azure Log Analytics Walkthru",d={},c=[{value:"Data.. data? Do we have data ?",id:"data-data-do-we-have-data-",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"windows-10-and-server-event-logs-to-azure-log-analytics-walkthru",children:"Windows 10 (and Server) Event Logs to Azure Log Analytics Walkthru"})}),"\n",(0,s.jsx)(t.p,{children:"It's a Cloud, Cloud, Cloud, Cloud, Cloud, Cloud world. Except actually most of your stuff is still likely mostly on-prem, or acts that way. Take Windows 10 for instance. Windows 10 has events in the event logs, and maybe you already know about on-prem Event Forwarding."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"NOTE:"})," If you want to learn more about on-prem Event Forwarding, you can see my Walkthrough of that here ",(0,s.jsx)(t.a,{href:"/docs/policypak/policypak/video/leastprivilege/windowseventforwarding",children:"Using Windows Event Forwarding to search for interesting events"})," and ",(0,s.jsx)(t.a,{href:"/docs/policypak/policypak/leastprivilege/windowseventforwarding",children:"How to forward interesting events for Least Privilege Manager (or anything else) to a centralized location using Windows Event Forwarding."}),"."]}),"\n",(0,s.jsx)(t.p,{children:"But how do we take on-prem events from Windows 10 (or Windows Server) and get the up to the cloud for later analysis? If you have 24, 250, or 25,000 domain joined (or even NON-domain joined) machines, say with Windows Intune or Netwrix Endpoint Policy Manager (formerly PolicyPak) Cloud\u2026 how can you do the equivalent of event forwarding to some central place?"}),"\n",(0,s.jsx)(t.p,{children:'That is the job of Azure Log Analytics. I\'m going to call it "LA" for short.'}),"\n",(0,s.jsx)(t.p,{children:"LA had an original name, OMS which stood for Operations Management Suite, but as near as I can tell, that's over. But its good to know LA's original name, because you'll see OMS pop up from time to time in the walkthrough, docs, and software. Additionally, it's also good to know that what you'll see here is build upon the original System Center Microsoft Operations Manager (SCOM); but I won't be using that function."}),"\n",(0,s.jsxs)(t.p,{children:["The official documentation for LA can be found ",(0,s.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/platform/agent-windows",children:"https://docs.microsoft.com/en-us/azure/azure-monitor/platform/agent-windows"}),"; but I had a few stumbles. Some tips o' the hat to Travis Roberts' video and blog which also helped give me a leg up. The blog is ",(0,s.jsx)(t.a,{href:"https://www.ciraltos.com/collect-custom-windows-event-logs-in-log-analytics/",children:"https://www.ciraltos.com/collect-custom-windows-event-logs-in-log-analytics/"})," and the helpful video series on Azure Log Analytics (though a little old now because of the name and UI changes) can be found at: ",(0,s.jsx)(t.a,{href:"https://www.youtube.com/watch?v=6hgvjgPBNzE&list=PLnWpsLZNgHzVXXyN9a0jm9xNNDrikHf8I",children:"https://www.youtube.com/watch?v=6hgvjgPBNzE&list=PLnWpsLZNgHzVXXyN9a0jm9xNNDrikHf8I"})]}),"\n",(0,s.jsx)(t.p,{children:"My goal in researching this project was to give some Endpoint Policy Manager MDM Customers a quick guide to research interesting events that Endpoint Policy Manager automatically logs to its own event log. But in this guide, I'm also going to show you how to collect some standard and also some extra event logs."}),"\n",(0,s.jsx)(t.p,{children:"To get started you need a Log Workspace. This is basically a security block between this collection of logs, and say another collection of logs. Each Log Workspace has a GUID based Workspace ID and two keys (Primary and Secondary.) You'll use these to send, say, YOUR Windows 10 machines' event logs to your workspace. And the other Azure admins \u2026 you know, those SQL server people or Exchange or whatever \u2026 they'll send their event logs to their workspaces."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 1 \u2013"}),' To get started use the big search thingie to find "Log Analytics workspaces" like what\'s seen here.']}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7ec45-img-01",src:o(322648).A+"",width:"1205",height:"358"})}),"\n",(0,s.jsx)(t.p,{children:"Then, there's a little Wizard (not shown) to help you get started. Basically it's asking you for names and which Azure region you want to keep the data in. Then after it gets going you'll see \"Your deployment is underway\" like what's seen here."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bb83ef-img-02",src:o(123107).A+"",width:"1993",height:"1128"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 2 \u2013"}),' Then you should be thrown into the Advanced settings like what\'s seen here. If not, find the Workspace you just created and click Advanced in the left-side menu. It should get you to this place. Note then the "WORKSPACE ID" and "PRIMARY KEY" like what\'s seen here. Hang on to those, you\'ll need these in a bit. Then also download the Windows Agent 64-bit or 32-bit to get started for your example machines.']}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bb8f55-img-03",src:o(850710).A+"",width:"1971",height:"1390"})}),"\n",(0,s.jsx)(t.p,{children:"In this example, we'll be installing the LA Agent by hand on a test machine. In real life you could use, say Windows Intune to deploy it with command line options to just chuck in your Workspace ID and Primary Keys and do the whole thing silently and automatically."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 3 \u2013"})," Once you have the download, get it over to your test machine. Machine can be real or virtual. Note that you shouldn't do this (nor do you need to) for WVD virtual machines. Those have a magical connector to accept event logs to LA; and you shouldn't need to use this method. (Docs: ",(0,s.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/virtual-desktop/diagnostics-log-analytics",children:"https://docs.microsoft.com/en-us/azure/virtual-desktop/diagnostics-log-analytics"}),"\xa0and a blog\xa0",(0,s.jsx)(t.a,{href:"https://www.mdmandgpanswers.com/blogs/view-blog/windows-10-and-server-event-logs-to-azure-log-analytics-walkthru",children:"https://www.mdmandgpanswers.com/blogs/view-blog/windows-10-and-server-event-logs-to-azure-log-analytics-walkthru"}),")"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bc2bfc-img-04",src:o(881155).A+"",width:"2150",height:"1427"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 4 \u2013"})," Then, Up, Up and away. Launch the agent.. which requires admin rights. (Or, pro tip: Use Endpoint Policy Manager Scripts to install it automatically where the script is elevated.",(0,s.jsx)(t.a,{href:"/docs/policypak/policypak/video/scriptstriggers/cloud",children:"Endpoint Policy ManagerScripts .. Deploy Software via VPN or with Endpoint Policy Manager Cloud"})]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 5 \u2013"})," You'll need to select \"Connect the agent to Azure Log Analytics (OMS)\" like what's seen here."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bad3be-img-05",src:o(752923).A+"",width:"1494",height:"784"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 6 \u2013"})," Then, it's time to chuck in your Workspace ID and Workspace Key. And you'll likely keep the default of Azure Cloud: Azure Commercial. Pull the pulldown if you have something unusual to select here."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bbca1c-img-06",src:o(747057).A+"",width:"1243",height:"687"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 7 \u2013"})," Yes, you want to check for updates when MS Update kicks in\u2026."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bc37d5-img-07",src:o(741896).A+"",width:"1171",height:"589"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 8 \u2013"})," And.. you're basically done."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570be8938-img-08",src:o(900564).A+"",width:"1160",height:"579"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 9 \u2013"})," Now let's make sure we're talking in both directions. The Microsoft Monitoring Agent is found in Control Panel\u2026 which is a weird place, but, hey\u2026 that's okay."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570be4088-img-09",src:o(630056).A+"",width:"1172",height:"259"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 10 \u2013"})," Then click the Azure Log Analytics (OMS) tab and \u2026 see you're talking outbound."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bec541-img-10",src:o(132936).A+"",width:"882",height:"896"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 11 \u2013"})," Back in Azure, in the Advanced Settings page, the zero should be one !"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bdece8-img-11",src:o(334752).A+"",width:"1856",height:"853"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 12 \u2013"})," Now it's time to add in the actual event logs you want to capture. Note that the more you capture, the more you pay. Strictly speaking for the Endpoint Policy Manager customer I made this blog entry for, he only needed to capture the Endpoint Policy Manager log (which I do last.) But just for completeness and testing, I'll capture some more too, since you might not have the Endpoint Policy Manager Log. (And, why don't you!? Come on over and check out Endpoint Policy Manager for Pete's sake. Really, your sake to be honest.)"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bc37d5-img-12",src:o(500406).A+"",width:"2502",height:"1179"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 13 \u2013"}),' So just type Application then +. Then System and + and bingo. Those are "well known" logs which LA knows about and pre-populates this list. But Endpoint Policy Manager? Not as common.. (Yet !) Therefore you could take a guess that our event logs are named Endpoint Policy Manager (they are\u2026). But how would you know?']}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570be8938-img-13",src:o(647548).A+"",width:"2478",height:"1077"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 14 \u2013"})," The trick is to find the log you want to capture in Windows, and go to its properties and get its Full Name like what's seen here. Yeah, this one was easy."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570be4088-img-14",src:o(809177).A+"",width:"1350",height:"1310"})}),"\n",(0,s.jsx)(t.p,{children:"But some are harder. I also wanted to capture the MDM event log which has a goofy and weird name. To get it, I went into an Event inside that log and captured its name microsoft-windows-devicemanagement-enterprise-diagnostics-provider/Operational and its brother microsoft-windows-devicemanagement-enterprise-diagnostics-provider/admin."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bec541-img-15",src:o(370439).A+"",width:"1782",height:"1260"})}),"\n",(0,s.jsx)(t.p,{children:"You can see that second log here\u2026"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570bdece8-img-16",src:o(363897).A+"",width:"1791",height:"1257"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 15 \u2013"})," Once I pasted in all the logs and added them, I clicked Save and got this!"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7ec3c-img-17",src:o(94672).A+"",width:"2379",height:"732"})}),"\n",(0,s.jsx)(t.h2,{id:"data-data-do-we-have-data-",children:"Data.. data? Do we have data ?"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 1 \u2013"})," Click on Logs and close the sample queries. Let's just see what have. All of it (which shouldn't be much.)"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7ee5e-img-18",src:o(74383).A+"",width:"2509",height:"922"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 2 \u2013"})," In the top box, type SEARCH"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 3 \u2013"})," Then click Run. Bingo.. out should pop all the events that have been captured. You can change the Display Time to make sure that you're getting the right events, right now."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7e690-img-19",src:o(600098).A+"",width:"2540",height:"1383"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 4 \u2013"})," It took a little while for the non-well-known logs to show up. But maybe it will work faster for you than for me. If you want to give it a shot and try your non-well-known logs, like this, give it a go."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:'Event | where Eventlog == "PolicyPak"'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Step 5 \u2013"})," Then click Run again."]}),"\n",(0,s.jsx)(t.p,{children:"Pow! Here come your logs."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7ed35-img-20",src:o(609487).A+"",width:"2475",height:"919"})}),"\n",(0,s.jsx)(t.p,{children:"Then I can also dig into an event, and \u2026 hey look ! EastSalesUser1 ran Procmon, and Endpoint Policy Manager did the elevation ! Amazeballs !"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"f5f03570b7e4f0-img-21",src:o(370694).A+"",width:"1705",height:"642"})}),"\n",(0,s.jsx)(t.p,{children:"That's it. Well, that's basics anyway."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"Remember,"}),'  this blog is a simple walkthrough / getting started. This isn\'t "Magic Tricks with Windows Analytics." But if I had this guide, I would have been up and running about 10x faster. So I hope this helps you out and shows how you can take on-prem or "Always on the go" Windows 10 machines and record their logs, then sort thru them for actionable items and trends.']})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},741896:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bc37d5-img-07-4d94973be79e9c1e0f13df72dfd531cc.webp"},747057:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bbca1c-img-06-bbbadf3e0d64eaeb15d01a716cc53718.webp"},752923:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bad3be-img-05-728f5ddd729c9e3e1e6470a6e0d63d13.webp"},809177:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570be4088-img-14-a37cf39a36e4ac41174ea006504618bf.webp"},850710:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bb8f55-img-03-72b8654b584eeea11eb38789da6e51eb.webp"},881155:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570bc2bfc-img-04-4b2c03e265f25d92d73ea7bcc4cbc5f5.webp"},900564:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/f5f03570be8938-img-08-cee6dbb9f40e16000721c0ce5825ab5c.webp"}}]);