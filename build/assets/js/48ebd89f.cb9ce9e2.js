"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[274147],{17974:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"policypak/troubleshooting/grouppolicycompliancereporter/tuning/overview","title":"Tuning Group Policy Compliance Reporter","description":"Tuning Endpoint Policy Manager GPCR involves using provided ADMX files to reduce or increase how often Endpoint Policy Manager GPCR endpoints communicate with the Endpoint Policy Manager GPCPR server. We discuss using these files, as well as how the auditing process works and what triggers it, in the sections below.","source":"@site/docs/policypak/policypak/troubleshooting/grouppolicycompliancereporter/tuning/overview.md","sourceDirName":"policypak/troubleshooting/grouppolicycompliancereporter/tuning","slug":"/policypak/troubleshooting/grouppolicycompliancereporter/tuning/overview","permalink":"/docs/policypak/policypak/troubleshooting/grouppolicycompliancereporter/tuning/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/policypak/policypak/troubleshooting/grouppolicycompliancereporter/tuning/overview.md","tags":[],"version":"current","frontMatter":{},"sidebar":"policyPakSidebar","previous":{"title":"Using ADMX Files to Tune the Auditor","permalink":"/docs/policypak/policypak/troubleshooting/grouppolicycompliancereporter/tuning/admx"},"next":{"title":"What does \\"Unsupported item\\" mean in PPGPCR reports and tests?","permalink":"/docs/policypak/policypak/troubleshooting/grouppolicycompliancereporter/unsupporteditem"}}');var i=o(474848),r=o(28453);const s={},a="Tuning Group Policy Compliance Reporter",l={},d=[{value:"Triggering the Auditor with a Scheduled Task",id:"triggering-the-auditor-with-a-scheduled-task",level:2},{value:"Default Auditor Triggers",id:"default-auditor-triggers",level:2},{value:"Auditing Process for Modern Versions of Group Policy Compliance Reporter",id:"auditing-process-for-modern-versions-of-group-policy-compliance-reporter",level:2},{value:"Auditing Process for Older Versions of Group Policy Compliance Reporter",id:"auditing-process-for-older-versions-of-group-policy-compliance-reporter",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"tuning-group-policy-compliance-reporter",children:"Tuning Group Policy Compliance Reporter"})}),"\n",(0,i.jsx)(t.p,{children:"Tuning Endpoint Policy Manager GPCR involves using provided ADMX files to reduce or increase how often Endpoint Policy Manager GPCR endpoints communicate with the Endpoint Policy Manager GPCPR server. We discuss using these files, as well as how the auditing process works and what triggers it, in the sections below."}),"\n",(0,i.jsx)(t.h2,{id:"triggering-the-auditor-with-a-scheduled-task",children:"Triggering the Auditor with a Scheduled Task"}),"\n",(0,i.jsxs)(t.p,{children:["Starting with Endpoint Policy Manager GPCR build 1227, endpoints using ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"})," will not push data up to the server every time Group Policy applies. However, a scheduled task will trigger ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"})," to run every time Group Policy is applied. This is shown below in the Group Policy Preference item that triggers the auditor to run:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'Subscription <QueryList><Query Id="0" Path="Microsoft-  \nWindows-GroupPolicy/Operational"><Select Path="Microsoft-  \nWindows-GroupPolicy/Operational">*[System[( (EventID &gt;=\xa0  \n8000 and EventID &lt;= 8007) or (EventID &gt;= 7000 and\xa0  \nEventID &lt;= 7007) or (EventID &gt;= 6000 and EventID\xa0  \n&lt;= 6007) )]]</Select></Query></QueryList>\n'})}),"\n",(0,i.jsx)(t.p,{children:"The auditor EXE determines when to run and then sends the data back to the server."}),"\n",(0,i.jsx)(t.h2,{id:"default-auditor-triggers",children:"Default Auditor Triggers"}),"\n",(0,i.jsx)(t.p,{children:"The Endpoint Policy Manager GPCR auditor EXE process will only do work and send data back to the server when a Group Policy background refresh event occurs:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"8006 Successful computer periodic refresh event"}),"\n",(0,i.jsx)(t.li,{children:"8007 Successful user periodic refresh event"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["This ensures that the computer is started and the user is logged in (90\u2013120 minutes after login) and Group Policy is successful. The auditor EXE also keeps track of how many times per day it runs, with a maximum of 20. Capping the auditor EXE at 20 runs per day ensures you'll never send an unrealistic number of audits in a day. You could also configure the ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"}),' using ADMX files (see the section called "Troubleshooting with ADMX or Registry Entries) to change or augment these settings.']}),"\n",(0,i.jsx)(t.h2,{id:"auditing-process-for-modern-versions-of-group-policy-compliance-reporter",children:"Auditing Process for Modern Versions of Group Policy Compliance Reporter"}),"\n",(0,i.jsxs)(t.p,{children:["When ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"})," runs, the first thing it does is gather the RSOP via WMI and send them to the Endpoint Policy Manager GPCR server for storage and processing."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Running",(0,i.jsx)(t.code,{children:" PPGPCR.Auditor.exe"})," over the network requires about 1.4 MB of extra data to be sent. This occurs only at the background refresh cycle (but is changeable using ADMX settings)."]}),"\n",(0,i.jsx)(t.li,{children:"Taking an XML RSOP from WMI happens locally and takes no bandwidth."}),"\n",(0,i.jsx)(t.li,{children:"Sending the RSOP data to the server takes virtually no bandwidth. Once the RSOP is determined (about 600 KB), it is zipped down to about 68 KB."}),"\n",(0,i.jsx)(t.li,{children:"If the RSOP is the same as the last time, then no zipped files are sent from the client to the server, but a 1 KB heartbeat is still sent to update the server."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Note that it's possible to copy ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"})," locally and run it there instead of running it from a share on the server. This saves running 1.4 MB over the network every time any Group Policy event is triggered. Values may change slightly from run to run."]}),"\n",(0,i.jsx)(t.h2,{id:"auditing-process-for-older-versions-of-group-policy-compliance-reporter",children:"Auditing Process for Older Versions of Group Policy Compliance Reporter"}),"\n",(0,i.jsxs)(t.p,{children:["With older versions of the PPGPCR, the first thing that ",(0,i.jsx)(t.code,{children:"PPGPCR.Auditor.exe"})," does is run the in-system function GPRESULT /X to generate RSOPs and send them to the Endpoint Policy Manager GPCR server for storage and processing. When this happens, about 10 MB of data is sent over the network. This is the very nature of ",(0,i.jsx)(t.code,{children:"GPRESULT /X"}),". You can do a rough calculation of how long Endpoint Policy Manager GPCR might take to push data from the endpoints up to the server based on the number of endpoints and the bandwidth by using this calculator: ",(0,i.jsx)(t.a,{href:"http://ibeast.com/tools/band-calc.asp",children:"http://ibeast.com/tools/band-calc.asp"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"For example, if you had nine computers over a very slow 1.5 MB link to the closest DC, you could estimate that the upload would take 8 minutes and 8 seconds if they all ran the auditor at the exact same time. Since Group Policy is randomly running across all machines in the background (90\u2013120 minutes after login), and since PPGPCR.Auditor.exe will only trigger on successful background user and computer refreshes (now by default) and not at computer startup or user login, the risk of saturation of a slow link is minimized."}),"\n",(0,i.jsx)(t.p,{children:"Here is the breakdown of exactly what is happening when PPGPCR.Auditor.exe is triggered to do work:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Running PPGPCR.Auditor.exe over the network requires about 1.4 MB of extra data to be sent. This occurs only at the background refresh cycle (but is changeable using ADMX settings)."}),"\n",(0,i.jsxs)(t.li,{children:["Taking an XML RSOP from ",(0,i.jsx)(t.code,{children:"gpresult.exe /x"})," causes about 7\u201310 MB of data to be sent over the network from the DC to the endpoint."]}),"\n",(0,i.jsx)(t.li,{children:"Sending the RSOP data to the server takes virtually no bandwidth. Once the RSOP is determined (about 600 KB), it is zipped down to about 34 KB."}),"\n",(0,i.jsx)(t.li,{children:"If the RSOP is the same as the last time, then no zipped files are sent from the client to the server, but a 1 KB heartbeat is still sent to update the server."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Note that it's possible to copy",(0,i.jsx)(t.code,{children:" PPGPCR.Auditor.exe"})," locally and run it there instead of running it from a share on the server. This saves running 1.4 MB over the network every time any Group Policy event is triggered. Values may change slightly from run to run, but in summary, after running GPUpdate, the Endpoint Policy Manager GPCR auditor takes about 10 MB of network bandwidth on the next auditor run because of the need to generate a new RSOP and compare it to the last one. The biggest problem is that the Endpoint Policy Manager GPCR auditor relies on GPRESULT /X, which is a system command and is hardcoded to work the way it does, making it take up the bulk of the bandwidth. This is why only events that actually trigger the auditor to do real work are successful user and computer background events, and they are capped at 20 per day."]}),"\n",(0,i.jsx)(t.p,{children:"Endpoint Policy Manager GPCR has a problem where bandwidth is constrained between the client and the DCs, but build 1227 has dramatically improved on this problem. In builds beyond 1227, we will continue working on additional ways to minimize the problem GPresult /x causes over slow links with future releases."})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>a});var n=o(296540);const i={},r=n.createContext(i);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);