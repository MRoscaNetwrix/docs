"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[906068],{28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(296540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},277674:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/proxy_example-afcb156dbef5caa809c1b79c13228e10.webp"},350006:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/proxy_purpose_loadbalancing-f7249d9a621db1f1331e899040b879b5.webp"},545021:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"usercube/installation-guide/reverse-proxy/index","title":"Reverse Proxy","description":"Identity Manager\xa0can be installed behind a reverse proxy that acts as an intermediate server between users and Identity Manager\'s server, in order to process users\' requests and redirect them to the right server(s), for performance and security purposes.","source":"@site/docs/usercube/usercube/installation-guide/reverse-proxy/index.md","sourceDirName":"usercube/installation-guide/reverse-proxy","slug":"/usercube/installation-guide/reverse-proxy/","permalink":"/docs/usercube/usercube/installation-guide/reverse-proxy/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/usercube/usercube/installation-guide/reverse-proxy/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"userCubeSidebar","previous":{"title":"Server","permalink":"/docs/usercube/usercube/installation-guide/requirements/server-requirements/"},"next":{"title":"Integration Guide","permalink":"/docs/usercube/usercube/integration-guide/"}}');var s=r(474848),i=r(28453);const o={},a="Reverse Proxy",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Nginx",id:"nginx",level:3},{value:"Load balancing",id:"load-balancing",level:3},{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"Static files",id:"static-files",level:3},{value:"Load Balancing Configuration",id:"load-balancing-configuration",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"reverse-proxy",children:"Reverse Proxy"})}),"\n",(0,s.jsxs)(n.p,{children:["Identity Manager\xa0can be installed behind a ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Reverse_proxy",children:"reverse proxy"})," that acts as an intermediate server between users and Identity Manager's server, in order to process users' requests and redirect them to the right server(s), for performance and security purposes."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"A reverse proxy is usually used when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"needing to encrypt the requests from/to end-users on the one hand, and on the other hand to be able to monitor plain text requests from/to Identity Manager's server;"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Proxy Purposes: Encryption",src:r(983554).A+"",width:"2423",height:"1007"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"installing Identity Manager\xa0with an integrated agent on a network isolated from the users' browsers, in order to be able to access sensitive systems which are protected by being set up on a network isolated from the Internet;"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Proxy Installation Example",src:r(277674).A+"",width:"2846",height:"2470"})}),"\n",(0,s.jsx)(n.p,{children:"This installation will be used for the configuration examples below."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"using several Identity Manager's server instances for load-balancing purposes."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Proxy Purposes: Load Balancing",src:r(350006).A+"",width:"2399",height:"1860"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"As Identity Manager\xa0is session-less, working with several servers does not imply the need to synchronize sessions between servers, nor the need to guarantee that a particular IP will be processed by a particular server."}),"\n",(0,s.jsx)(n.h3,{id:"nginx",children:"Nginx"}),"\n",(0,s.jsxs)(n.p,{children:["For these tasks, ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/#nginx",children:"nginx"})," is a relevant choice of reverse proxy. There are several versions of nginx available, suitable for several Linux-based environments. ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/installing-nginx/",children:"Installation instructions"})," can be found directly on the nginx website."]}),"\n",(0,s.jsxs)(n.p,{children:["At its core, Identity Manager\xa0is an ASP.NET application with a Kestrel server. We can configure a nginx reverse proxy accordingly by following ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-8.0&tabs=linux-ubuntu#microsofts-guidelines",children:"Microsoft's guidelines"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Nginx ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/",children:"configuration files"})," are usually located in ",(0,s.jsx)(n.code,{children:"/etc/nginx"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"load-balancing",children:"Load balancing"}),"\n",(0,s.jsxs)(n.p,{children:["Nginx offers several ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#load-balancing-methods",children:"load balancing methods"})," which are all compatible with Identity Manager."]}),"\n",(0,s.jsx)(n.p,{children:"Then, in order for servers to be able to properly schedule and coordinate synchronization and provisioning, the following file locations must be shared by all Identity Manager\xa0servers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TempFolderPath"}),"\n",(0,s.jsx)(n.li,{children:"WorkFolderPath"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["All Identity Manager\xa0servers also share a database. See the ",(0,s.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/network-configuration/agent-configuration/appsettings/",children:"Application Settings"})," topic for additional information."]}),"\n",(0,s.jsx)(n.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The following is a basic configuration, in the ",(0,s.jsx)(n.code,{children:"nginx.conf"})," file, with one virtual host, that directs incoming requests on ",(0,s.jsx)(n.code,{children:"<listening-port>"})," from network 1 to a Identity Manager\xa0server instance at ",(0,s.jsx)(n.code,{children:"<Usercube-server-url>"})," on network 2."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nnginx.conf\n\nworker_processes auto;\n\nhttp {\n\n\t##\n\t# Basic Settings\n\t##\n\n\tsendfile on;\n\ttcp_nopush on;\n\ttcp_nodelay on;\n\tkeepalive_timeout 65;\n\ttypes_hash_max_size 2048;\n\tdefault_type application/octet-stream;\n\n\t##\n\t# SSL Settings\n\t##\n\n\tssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE\n\tssl_prefer_server_ciphers on;\n\n\t##\n\t# Logging Settings\n\t##\n\n\taccess_log /nginx-1.19.7/logs/access.log;\n\terror_log /nginx-1.19.7/logs/error.log;\n\n\t##\n\t# Gzip Settings\n\t##\n\n\tgzip on;\n\n\t##\n\t# Virtual Host Configs\n\t##\n\n\tserver {\n\t\tlisten       <listening-port> default_server;\n\t\tserver_name  <server-name>;\n\n\t\tlocation / {\n\t\t\tproxy_pass         http://<Usercube-server-url>;\n\t\t\tproxy_http_version 1.1;\n\t\t\tproxy_set_header   Upgrade $http_upgrade;\n\t\t\tproxy_set_header   Connection keep-alive;\n\t\t\tproxy_set_header   Host $host;\n\t\t\tproxy_cache_bypass $http_upgrade;\n\t\t\tproxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\t\tproxy_set_header   X-Forwarded-Proto $scheme;\n\t\t\tproxy_set_header   X-Real-IP $remote_addr;\n\t\t}\n\t}\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<listening-port>"})," is the port that nginx listens to on network 1 for incoming HTTP requests. It should be set to ",(0,s.jsx)(n.code,{children:"80"}),", except if you have another web server listening for port 80 requests and passing them to your nginx server."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<server-name>"})," is the URL used by end-users to request Identity Manager's server, such as ",(0,s.jsx)(n.code,{children:"contoso.usercube.com"}),". It is the content of the host header in the incoming HTTP request."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<Usercube-server-url>"})," is Identity Manager's server URL on network 2."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["With this configuration, SSL is enabled between the nginx proxy and the client, but not between the proxy and Identity Manager's server. ",(0,s.jsx)(n.code,{children:"gzip"})," is used to compress files to be sent over the network."]}),"\n",(0,s.jsx)(n.h3,{id:"static-files",children:"Static files"}),"\n",(0,s.jsxs)(n.p,{children:["Performance can be enhanced for static file serving. This requires extracting static files such as the UI JavaScript application and the logo and pictures, and storing them on the nginx server directly.See more information about ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/",children:"static file serving with nginx"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"load-balancing-configuration",children:"Load Balancing Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Load balancing involves at least two Identity Manager\xa0servers to which ",(0,s.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/",children:"nginx, acting as a load balancer"}),", distributes the load of incoming requests."]}),"\n",(0,s.jsxs)(n.p,{children:["Then, in addition to the configuration from the previous example, a group of servers must be declared, using the ",(0,s.jsx)(n.code,{children:"upstream"})," directive in the ",(0,s.jsx)(n.code,{children:"http"})," section."]}),"\n",(0,s.jsxs)(n.p,{children:["The following configuration defines a group named ",(0,s.jsx)(n.code,{children:"usercubegroup"})," which contains two server configurations, each one resolving to an actual Identity Manager's server instance:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\n...\nhttp {\n    upstream usercubegroup {\n        server usercube1.contoso.com;\n        server usercube2.contoso.com;\n    }\n    ...\n}\n...\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then, the name of the group takes the place of ",(0,s.jsx)(n.code,{children:"<Usercube-server-url>"})," in the virtual host definition:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nserver {\n        listen       <listening-port> default_server;\n        server_name  <server-name>;\n\n\t\tlocation / {\n\t        proxy_pass         http://IdentityManagergroup;\n\t        proxy_http_version 1.1;\n\t        proxy_set_header   Upgrade $http_upgrade;\n\t        proxy_set_header   Connection keep-alive;\n\t        proxy_set_header   Host $host;\n\t        proxy_cache_bypass $http_upgrade;\n\t        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\t        proxy_set_header   X-Forwarded-Proto $scheme;\n\t\t    proxy_set_header   X-Real-IP $remote_addr;\n\t   }\n\n\t}\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},983554:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/proxy_purpose_encryption-f405b5bdfbaa304010e19aa35d11a835.webp"}}]);