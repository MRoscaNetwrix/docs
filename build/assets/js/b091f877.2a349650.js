"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[536791],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var i=n(296540);const r={},o=i.createContext(r);function s(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:t},e.children)}},322514:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"threatprevention/troubleshooting/lsass","title":"LSASS Process Terminated","description":"To collect real-time activity data, the Agent hooks into (intercepts) specific Microsoft APIs in the LSASS process. Note the following:","source":"@site/docs/threatprevention/threatprevention/troubleshooting/lsass.md","sourceDirName":"threatprevention/troubleshooting","slug":"/threatprevention/troubleshooting/lsass","permalink":"/docs/threatprevention/threatprevention/troubleshooting/lsass","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/threatprevention/threatprevention/troubleshooting/lsass.md","tags":[],"version":"current","frontMatter":{},"sidebar":"threatPreventionSidebar","previous":{"title":"Exchange Lockdown Considerations","permalink":"/docs/threatprevention/threatprevention/troubleshooting/exchangelockdown"},"next":{"title":"MSI Installer Logs","permalink":"/docs/threatprevention/threatprevention/troubleshooting/msilogs"}}');var r=n(474848),o=n(28453);const s={},a="LSASS Process Terminated",h={},c=[{value:"Enable the &#39;LSASS Process Terminated&#39; Email Alert",id:"enable-the-lsass-process-terminated-email-alert",level:2}];function l(e){const t={a:"a",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"lsass-process-terminated",children:"LSASS Process Terminated"})}),"\n",(0,r.jsx)(t.p,{children:"To collect real-time activity data, the Agent hooks into (intercepts) specific Microsoft APIs in the LSASS process. Note the following:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Occasionally Microsoft issues KBs (hot-fixes) that alter the LSASS components. Most of these hot-fixes do not alter the APIs in terms of the number or type parameters passed into them or values returned which are monitored by the Agent, and therefore do not impact operation of the Agent."}),"\n",(0,r.jsx)(t.li,{children:"Infrequently Microsoft issues a KB that changes one of these APIs in a way that can result in interfering with the Agent instrumentation. This in turn can result in an exception which causes the LSASS process to terminate. Historically, an update resulting in this type of exception is released less than once a year. When it does occur, such a conflict is typically manifested within a minute of boot up, often before the GINA allowing interactive login is initialized. When the Windows operating system (OS) detects such a situation, it will initiate a reboot of the OS. The end result can be an OS reboot loop which is resolved by either applying a \u2018counter\u2019 patch from Netwrix to adapt to the Microsoft change or by setting the Threat Prevention Agent service from its default \u2018automatic start\u2019 to \u2018disabled\u2019 or \u2018manual start\u2019 so that on the next reboot the Threat Prevention hooks are not deployed."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The Agent can detect if the LSASS process has terminated. If an LSASS termination is observed within the first five minutes from last reboot, then the Agent assumes it is due to the above situation and will take the following two actions well before the OS shuts down for the first time:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"First, it sends an alert to the Enterprise Manager, \u201cLSASS shutdown detected\u201d"}),"\n",(0,r.jsx)(t.li,{children:"Second, it sets itself to \u201cmanual start\u201d so that the Agent instrumentation is not loaded on reboot"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"While this does result in a suspension of further Threat Prevention event monitoring and/or blocking on the affected domain controller, it ensures the domain controller continues to operate normally. Once the counter patch provided by Netwrix is deployed, you can restart the Agent from the Administration Console. In this case, the console will first check if the Agent is currently set to \u2018manual start\u2019 mode. If yes, then the Agent service is set back to \u2018automatic start\u2019 mode and restarted, restoring normal operation."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"NOTE:"})," It is necessary to register a primary and a secondary technical contact for your orgaization with Netwrix throughout the lifetime of Threat Prevention usage. Netwrix will issue notifications to these registered technical contacts related to Microsoft-issued KBs affecting LSASS and the counter patch (if one is needed). Contact the organization\u2019s Netwrix Sales Representative or ",(0,r.jsx)(t.a,{href:"mailto:support@stealthbits.com"}),(0,r.jsx)(t.a,{href:"https://www.netwrix.com/support.html",children:"Netwrix Support"})," to ensure that these contacts have been registered."]}),"\n",(0,r.jsx)(t.p,{children:"Prior to Microsoft releasing a KB that alters the LSASS components in a manner that causes a conflict with the Agent, Netwrix will first send a notification informing the registered technical contact(s) of the release along with detailed instructions on how to obtain and apply the relevant Agent counter patch. Counter patches are typically made available via these notifications 24 hours or more prior to Microsoft issuing the incompatible KB."}),"\n",(0,r.jsx)(t.p,{children:"Since this requires the Threat Prevention administrator to take action, there is an Operations alert specific to this event."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"RECOMMENDED:"})})," Enable the ",(0,r.jsx)(t.em,{children:"LSASS process terminated"})," alert under Operations on the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/configuration/systemalerting/overview",children:"System Alerting Window"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["The Agent can be enabled with a safe mode, which would prevent the Active Directory monitoring module of the Agent from loading if any LSASS change is detected. See the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/agents/safemode",children:"Agent Safe Mode"})," topic for additional information."]}),"\n",(0,r.jsx)(t.h2,{id:"enable-the-lsass-process-terminated-email-alert",children:"Enable the 'LSASS Process Terminated' Email Alert"}),"\n",(0,r.jsxs)(t.p,{children:["Follow the steps to enable email notifications for the ",(0,r.jsx)(t.em,{children:"LSASS process terminated"})," alert under Operations."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"NOTE:"})," These steps require the Threat Prevention administrator user role. They also assume that the SMTP host information has been configured and email alerts have been enabled. See the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/configuration/systemalerting/email#configure-smtp-host-information",children:"Configure SMTP Host Information"})," topic for additional information"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Step 1 \u2013"})," Click ",(0,r.jsx)(t.strong,{children:"Configuration"})," > ",(0,r.jsx)(t.strong,{children:"Alerts"})," on the menu to open the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/configuration/systemalerting/overview",children:"System Alerting Window"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Step 2 \u2013"})," On the Email tab, click ",(0,r.jsx)(t.strong,{children:"Configure"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Step 3 \u2013"})," Create a Message Profile for the LSASS notification with the recipient(s) to be notified when the LSASS process terminates. See the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/configuration/systemalerting/email#create-message-profiles",children:"Create Message Profiles"})," topic for additional information."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"System Alerting window - LSASS Process Terminated alert",src:n(503856).A+"",width:"965",height:"799"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Step 4 \u2013"})," On the Email tab, click ",(0,r.jsx)(t.strong,{children:"Events"}),", and then click ",(0,r.jsx)(t.strong,{children:"Operations"})," in the left pane. Check the ",(0,r.jsx)(t.strong,{children:"LSASS process terminated"})," event alert and select the Message Profile created in Step 3 from the drop-down menu. See the ",(0,r.jsx)(t.a,{href:"/docs/threatprevention/threatprevention/admin/configuration/systemalerting/email",children:"Email Tab"})," topic for additional information."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Step 5 \u2013"})," Ensure that the email alerts are enabled, as indicated by the Enabled toggle button, and click ",(0,r.jsx)(t.strong,{children:"OK"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"When the LSASS process terminated event alert is triggered, an email notification is sent to the assigned (step 3) recipient(s)."})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},503856:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/lsassprocessterminated-88f5a5c632aac239f47a84942c906e76.webp"}}]);