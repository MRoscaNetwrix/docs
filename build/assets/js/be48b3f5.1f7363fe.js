"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[397906],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(296540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},352999:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"config/netappcmode/configurefpolicy","title":"Configure FPolicy","description":"Activity Monitor relies on the NetApp FPolicy framework for monitoring of file access events on Storage Virtual Machines (SVM). FPolicy needs to be configured for each SVM.","source":"@site/docs/accessanalyzer/config/netappcmode/configurefpolicy.md","sourceDirName":"config/netappcmode","slug":"/config/netappcmode/configurefpolicy","permalink":"/docs/accessanalyzer/config/netappcmode/configurefpolicy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/config/netappcmode/configurefpolicy.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"Configure Network","permalink":"/docs/accessanalyzer/config/netappcmode/configurefirewall"},"next":{"title":"NetApp Data ONTAP Cluster-Mode Target Requirements","permalink":"/docs/accessanalyzer/config/netappcmode/overview"}}');var r=t(474848),s=t(28453);const o={},l="Configure FPolicy",c={},a=[{value:"TLS Authentication Options",id:"tls-authentication-options",level:2},{value:"Generate Server Certificate",id:"generate-server-certificate",level:3},{value:"Create PEM File for Client Certificate",id:"create-pem-file-for-client-certificate",level:3},{value:"Persistent Store",id:"persistent-store",level:2},{value:"Manually Configure FPolicy",id:"manually-configure-fpolicy",level:2},{value:"Part 1: Install Server Certificate on the SVM",id:"part-1-install-server-certificate-on-the-svm",level:3},{value:"Validate Part 1: Server Certificate Install",id:"validate-part-1-server-certificate-install",level:4},{value:"Part 2: Create External Engine",id:"part-2-create-external-engine",level:3},{value:"Validate Part 2: External Engine Creation",id:"validate-part-2-external-engine-creation",level:4},{value:"Part 3: Create FPolicy Event",id:"part-3-create-fpolicy-event",level:3},{value:"Validate Part 3: FPolicy Event Creation",id:"validate-part-3-fpolicy-event-creation",level:4},{value:"Part 4: Create Persistent Store",id:"part-4-create-persistent-store",level:3},{value:"Validate Part 4: Create Persistent Store",id:"validate-part-4-create-persistent-store",level:4},{value:"Part 5: Create FPolicy Policy",id:"part-5-create-fpolicy-policy",level:3},{value:"Validate Part 5: FPolicy Policy Creation",id:"validate-part-5-fpolicy-policy-creation",level:4},{value:"Part 6: Create FPolicy Scope",id:"part-6-create-fpolicy-scope",level:3},{value:"Validate Part 6: FPolicy Scope Creation",id:"validate-part-6-fpolicy-scope-creation",level:4},{value:"Part 7: Set TLS Authentication",id:"part-7-set-tls-authentication",level:3},{value:"Set Server-Authentication",id:"set-server-authentication",level:4},{value:"Set Mutual-Authentication",id:"set-mutual-authentication",level:4},{value:"Validate Mutual-Authentication Is Set",id:"validate-mutual-authentication-is-set",level:4},{value:"Part 8: Enable the FPolicy",id:"part-8-enable-the-fpolicy",level:3},{value:"Validate Part 8: FPolicy Enabled",id:"validate-part-8-fpolicy-enabled",level:4},{value:"Part 9: Connect FPolicy Server / Agent to Cluster Node",id:"part-9-connect-fpolicy-server--agent-to-cluster-node",level:3},{value:"Validate Part 9: Connection to Cluster Node",id:"validate-part-9-connection-to-cluster-node",level:4},{value:"Automatic Configuration of FPolicy",id:"automatic-configuration-of-fpolicy",level:2},{value:"Set TLS Mutual-Authentication",id:"set-tls-mutual-authentication",level:3},{value:"Validate: Mutual-Authentication",id:"validate-mutual-authentication",level:4},{value:"Customization of FPolicy Object Names",id:"customization-of-fpolicy-object-names",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configure-fpolicy",children:"Configure FPolicy"})}),"\n",(0,r.jsx)(n.p,{children:"Activity Monitor relies on the NetApp FPolicy framework for monitoring of file access events on Storage Virtual Machines (SVM). FPolicy needs to be configured for each SVM."}),"\n",(0,r.jsx)(n.p,{children:"There are two ways to configure FPolicy:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Activity Monitor agent can facilitate the ",(0,r.jsx)(n.a,{href:"#automatic-configuration-of-fpolicy",children:"Automatic Configuration of FPolicy"})," for the monitored SVM using the ONTAP\xa0API. This mode is simple, but does not allow you to exclude certain volumes or shares of the SVM from being monitored. It also requires additional permissions to create and modify FPolicy."]}),"\n",(0,r.jsxs)(n.li,{children:["Another option is to ",(0,r.jsx)(n.a,{href:"#manually-configure-fpolicy",children:"Manually Configure FPolicy"})," for each SVM. This mode allows you to fine tune FPolicy by excluding certain volumes or shares from being monitored. It also reduces product permissions."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Regardless of the chosen approach for FPolicy configuration, one also needs to perform extra steps if the FPolicy communication has to be secured with TLS."}),"\n",(0,r.jsx)(n.h2,{id:"tls-authentication-options",children:"TLS Authentication Options"}),"\n",(0,r.jsx)(n.p,{children:"There are two TLS FPolicy Authentication options that can be used:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TLS, server authentication \u2013 Server only authentication"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. The Server Certificate PEM file needs to be saved locally on the Activity Monitor Console server."}),"\n",(0,r.jsx)(n.li,{children:"For manual FPolicy configuration, the Server Certificate needs to be installed on the SVM, and then server-authentication set."}),"\n",(0,r.jsx)(n.li,{children:"For automatic FPolicy configuration, the Activity Monitor manages installation of the Server Certificate."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TLS, mutual authentication \u2013 Mutual authentication"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. The Server Certificate PEM file needs to be saved locally on the Activity Monitor Console server."}),"\n",(0,r.jsx)(n.li,{children:"A certificate (Client Certificate) for the SVM needs to be copied to a PEM file and saved locally on the Activity Monitor Console server."}),"\n",(0,r.jsx)(n.li,{children:"For manual FPolicy configuration, the Server Certificate needs to be installed on the SVM and then mutual-authentication set."}),"\n",(0,r.jsx)(n.li,{children:"For automatic FPolicy configuration, mutual-authentication set before the configuration process. The Activity Monitor manages installation of both certificates."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"generate-server-certificate",children:"Generate Server Certificate"}),"\n",(0,r.jsx)(n.p,{children:"A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. This is required for both of the TLS authentication options."}),"\n",(0,r.jsx)(n.p,{children:"The PEM file must contain both Public Key and Private Key parts. A certificate may be self-signed or issued by a certification authority. Below are the steps for generation of a self-signed certificate using OpenSSL toolkit."}),"\n",(0,r.jsx)(n.p,{children:"Use the following command on the agent server to create the Server Certificate and copy it to a .pem file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'openssl.exe req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes -subj "/CN=[ACTIVITY_AGENT_SERVER_NAME]"\xa0  \ncopy cert.pem+key.pem [CERTIFICATE_FILE_NAME.pem]  \ndel cert.pem key.pem .rnd\n'})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'openssl.exe req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes -subj "/CN=testagentserver"\xa0  \ncopy cert.pem+key.pem agentkey.pem  \ndel cert.pem key.pem .rnd\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In this example ",(0,r.jsx)(n.code,{children:" agentkey.pem"})," would be used as the Server Certificate. Save the Server Certificate locally on the Activity Monitor Console server."]}),"\n",(0,r.jsx)(n.h3,{id:"create-pem-file-for-client-certificate",children:"Create PEM File for Client Certificate"}),"\n",(0,r.jsx)(n.p,{children:"A certificate (Client Certificate) for the SVM needs to be copied to a PEM file. This is required for the TLS, mutual authentication option. Follow the steps to create the PEM file for the Client Certificate."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," On the SVM , use the following command to show the security certificate details:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate show -vserver [SVM_NAME] -type server instance\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate show -vserver testserver -type server instance\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," Copy the security certificate details into a text file and copy the public key to a PEM file. The following variables from security details will be needed to set mutual-authentication during Part 6 of manual configuration and prior to automatic configuration:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SVM"}),"\n",(0,r.jsx)(n.li,{children:"Common Name"}),"\n",(0,r.jsx)(n.li,{children:"Certificate Serial"}),"\n",(0,r.jsx)(n.li,{children:"Public Key Certificate"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"}),' Copy the value of Public Key Certificate field to a PEM file. The value spans multiple lines, starts with "',(0,r.jsx)(n.code,{children:"----BEGIN CERTIFICATE-----"}),'" and ends with "',(0,r.jsx)(n.code,{children:"-----END CERTIFICATE-----"}),'".']}),"\n",(0,r.jsx)(n.p,{children:"The Client Certificate PEM file has been created."}),"\n",(0,r.jsx)(n.h2,{id:"persistent-store",children:"Persistent Store"}),"\n",(0,r.jsx)(n.p,{children:"For ONTAP 9.15.1 and later, enabling the Persistent Store feature is recommended regardless of the chosen FPolicy configuration approach. The Persistent Store provides resilience and predictable latency in scenarios such as network delays or bursts of activity events. The feature uses a dedicated volume for each SVM as a staging buffer before events are sent to the agent."}),"\n",(0,r.jsx)(n.p,{children:"Persistent\xa0Store requires the following parameters:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Volume name \u2013 If the volume does not exist, it will be created automatically (recommended)."}),"\n",(0,r.jsx)(n.li,{children:"Initial volume size \u2013 Specifies the starting size of the volume."}),"\n",(0,r.jsx)(n.li,{children:"Autosize mode \u2013 Options include Off, Grow, or Grow/Shrink."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The size depends on the time duration for which you want to persist the events and the rate of events. For example, if you want 30 minutes of events to persist in an SVM with a capacity of 5000 events per second and the average event record size of 0.6 KB, the required volume size is ",(0,r.jsx)(n.code,{children:"5000 * 30 * 60 * 0.6 KB = 5400000 KB \u2248 5 GB"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," To find the approximate event rate, use the FPolicy counter ",(0,r.jsx)(n.code,{children:"requests_dispatched_rate"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," For the Persistent Store to automatically create a volume, the SVM must have at least one local tier (aggregate) assigned."]}),"\n",(0,r.jsx)(n.p,{children:"To check that the SVM has assigned local tiers, use the following command:"}),"\n",(0,r.jsx)(n.p,{children:"vserver show -vserver [SVM_NAME] -fields aggr-list"}),"\n",(0,r.jsx)(n.p,{children:'The command shows currently local tiers. If no tiers are assigned, "-" is displayed.'}),"\n",(0,r.jsx)(n.p,{children:"To assign local tiers to the SVM use the following command:"}),"\n",(0,r.jsx)(n.p,{children:"vserver add-aggregates -vserver [SVM_NAME] -aggregates [AGGREGATE_LIST]"}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.p,{children:"vserver add-aggregates -vserver testserver -aggregates aggr1,aggr2"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," This command is available to cluster administrators at the admin privilege level."]}),"\n",(0,r.jsx)(n.p,{children:"It is recommended to allow the volume to be created automatically. In this case, the FPolicy subsystem manages the volume, maintains the directory structure, and protects it from accidental deletion by marking it as not mountable."}),"\n",(0,r.jsx)(n.p,{children:"If you choose to create the volume manually, ensure the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The volume is not mounted and has no junction point."}),"\n",(0,r.jsx)(n.li,{children:"The snapshot policy for the volume is set to none."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For additional and up-to-date recommendations on volumes for the Persistent Store, refer to the NetApp documentation."}),"\n",(0,r.jsx)(n.h2,{id:"manually-configure-fpolicy",children:"Manually Configure FPolicy"}),"\n",(0,r.jsx)(n.p,{children:"This section describes how to manually configure FPolicy. Manual configuration of the FPolicy is recommended if the policy needs to be scoped to monitor select volumes or shares. It is necessary to create several FPolicy components and then enable the FPolicy. See the sections corresponding to each part of this list:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 1: Install Server Certificate on the SVM (only if using TLS authentication)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This is only needed if using either of the TLS, \u2026 authentication options."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 2: Create External Engine"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The External Engine defines how FPolicy makes and manages connections to external FPolicy servers like Activity Monitor Agent."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 3: Create FPolicy Events"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"An FPolicy event defines which protocol(s) to monitor and which file access events to monitor."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 4: Create Persistent Store (only if Persistent Store is used.\xa0RECOMMENDED)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A Persistent Store is used as a temporary on-disk storage before the events are sent to Activity Monitor Agent."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 5: Create FPolicy Policy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The FPolicy policy associates the other three FPolicy components and allows for the designation of a privileged FPolicy user"}),"\n",(0,r.jsx)(n.li,{children:"If running the Access Auditing (FSAA), Activity Auditing (FSAC), and/or Sensitive Data Discovery Auditing scans, then this is the user account credential to be added to the Access Analyzer Connection Profile."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 6: Create FPolicy Scope"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The FPolicy scope creates the filters necessary to perform scans on specific shares or volumes."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 7: Set TLS Authentication (optional)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This is only needed if using either of the TLS authentication options."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 8: Enable the FPolicy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Once the FPolicy is enabled, the Activity Monitor Agent can be configured to monitor the SVM."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Part 9: Connect FPolicy Server / Agent to Cluster Node (optional)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This is only needed if there is an issue with connection to the Cluster node or for troubleshooting a disconnection issue."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"part-1-install-server-certificate-on-the-svm",children:"Part 1: Install Server Certificate on the SVM"}),"\n",(0,r.jsx)(n.p,{children:"If using the TLS authentication options, it is necessary to install the Server Certificate on the SVM."}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to install the Server Certificate:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate install type client-ca -vserver [SVM_NAME]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate install type client-ca -vserver testserver\n"})}),"\n",(0,r.jsxs)(n.p,{children:['The command will ask you to provide a public certificate. Copy the public key from the Server Certificate PEM file, i.e. the block starting with "',(0,r.jsx)(n.code,{children:"-----BEGIN CERTIFICATE-----"}),'" and ending with "',(0,r.jsx)(n.code,{children:"-----END CERTIFICATE-----"}),'". Paste the block to the terminal window.']}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-1-server-certificate-install",children:"Validate Part 1: Server Certificate Install"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the Server Certificate is installed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate show -vserver [SVM_NAME] -commonname [ACTIVITY_AGENT_SERVER_NAME] -type client-ca instance\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"security certificate show -vserver testserver -commonname testagentserver -type client-ca instance\n"})}),"\n",(0,r.jsx)(n.h3,{id:"part-2-create-external-engine",children:"Part 2: Create External Engine"}),"\n",(0,r.jsx)(n.p,{children:"The External Engine defines how FPolicy makes and manages connections to external FPolicy servers."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"-primary-servers"})," must be the server or servers hosting the Activity Monitor Agent."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"If intending to use the Activity Monitor with Access Analyzer, then the primary server must also be the proxy server from which the Access Analyzer Access Auditing (FSAC) scans are running, e.g. the Access Analyzer Console server for local mode or the proxy server if running in any of the proxy mode options."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The following values are required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"engine-name StealthAUDITEngine"}),", the names of the external engine object can be customized (see below)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"port 9999"}),", Port number can be customized, but it is recommended to use 9999."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"extern-engine-type asynchronous"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"ssl-option no-auth"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"send-buffer-size 6291456"}),", for ONTAP 9.10+ use ",(0,r.jsx)(n.code,{children:"send-buffer-size 8388608"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," All parameters are case sensitive."]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the external engine:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"set -privilege advanced  \nvserver fpolicy policy external-engine create -vserver [SVM_NAME] -engine-name StealthAUDITEngine -primary-servers [IP_ADDRESS,\u2026] -port 9999 -extern-engine-type asynchronous -ssl-option no-auth -send-buffer-size 6291456\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"set -privilege advanced  \nvserver fpolicy policy external-engine create -vserver testserver -engine-name StealthAUDITEngine -primary-servers 192.168.30.15 -port 9999 -extern-engine-type asynchronous -ssl-option no-auth -send-buffer-size 6291456\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-2-external-engine-creation",children:"Validate Part 2: External Engine Creation"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the creation of the external engine:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy policy external-engine show -vserver [SVM_NAME] -engine-name StealthAUDITEngine -instance\n"})}),"\n",(0,r.jsx)(n.p,{children:"Verify that the output is displayed as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy policy external-engine show -vserver svm0 -engine-name StealthAUDITEngine -instance  \n\xa0\xa0(vserver fpolicy policy external-engine show)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Vserver: svm0  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Engine: StealthAUDITEngine  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Primary FPolicy Servers: 192.168.11.35  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Port Number of FPolicy Service: 9999  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Secondary FPolicy Servers: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0External Engine Type: asynchronous  \n\xa0\xa0SSL Option for External Communication: no-auth  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0FQDN or Custom Common Name: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Serial Number of Certificate: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Certificate Authority: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Is Resiliency Feature Enabled: false  \nMaximum Notification Retention Duration: 3m  \n\xa0\xa0\xa0\xa0\xa0Directory for Notification Storage: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0External Engine Format: xml\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Relevant NetApp Documentation: To learn more about creating an external engine, please visit the NetApp website and read the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-external-engine-create.html",children:"vserver fpolicy policy external-engine create"})," article."]}),"\n",(0,r.jsx)(n.h3,{id:"part-3-create-fpolicy-event",children:"Part 3: Create FPolicy Event"}),"\n",(0,r.jsx)(n.p,{children:"An event defines which protocol to monitor and which file access events to monitor."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Access Analyzer and the Activity Monitor are capable of monitoring both NFS and CIFS. However, it is necessary to create separate events for each protocol."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The following values are required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"event-name"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["For CIFS shares \u2013 ",(0,r.jsx)(n.code,{children:" StealthAUDITScreeningCifs"}),"\xa0for successful events; ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningFailedCifs"})," for failed events."]}),"\n",(0,r.jsxs)(n.li,{children:["For NFS shares \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningNfsV3, StealthAUDITScreeningNfsV4"})," for\xa0successful events; ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningFailedNfsV3, StealthAUDITScreeningFailedNfsV4"})," for failed events.",(0,r.jsx)(n.br,{}),"\n","The names of the event objects can be customized (see ",(0,r.jsx)(n.a,{href:"#customization-of-fpolicy-object-names",children:"Customization of FPolicy Object Names"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"volume-operation true"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"protocol"})," \u2013 one of the following ",(0,r.jsx)(n.code,{children:"cifs"}),", ",(0,r.jsx)(n.code,{children:"nfsv3"}),", ",(0,r.jsx)(n.code,{children:"nfsv4"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"monitor-fileop-failure"})," \u2013 ",(0,r.jsx)(n.code,{children:"true "}),"or ",(0,r.jsx)(n.code,{children:"false"}),", indicates whether failed file operations are reported."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Limiting the file operations to be monitored is an excellent way to limit the performance impact the FPolicy will have on the NetApp device. The file operations from which to choose are below with additional filter options:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"create"})," \u2013 File create operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"create_dir"})," \u2013 Directory create operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"close"})," \u2013 File close operations"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable this operation for NFSv4 to capture all read operations"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"delete"}),"\xa0\u2013 File delete operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"delete_dir"})," \u2013 Directory delete operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"link"})," \u2013 Link operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"open"})," \u2013 File open operations for CIFS protocol"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"open-with-delete-intent"})," \u2013 Limits notification to only when an attempt is made to open a file with the intent to delete it, according to the ",(0,r.jsx)(n.code,{children:"FILE_DELETE_ON_CLOSE"})," flag specification"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," File open operations are only supported with the ",(0,r.jsx)(n.code,{children:"open-with-delete-intent"})," filter applied."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"read"})," \u2013 File read operations"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"first-read"})," \u2013 Limits notification to only first read operations for CIFS protocol. For ONTAP 9.2+, this filter can be used for both CIFS and NFS protocols."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"rename"}),"\u2013 File rename operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"rename_dir"}),"\u2013 Directory rename operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"setattr"})," \u2013 Set attribute operations and permission changes. The following filters are available for ONTAP 9.0+ to limit events to permission changes only:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"CIFS:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-owner-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-group-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-sacl-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-dacl-change"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"NFSv3:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-owner-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-group-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-mode-change"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"NFSv4:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-owner-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-group-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-mode-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-sacl-change"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"setattr-with-dacl-change"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"symlink"})," \u2013 Symbolic link operations"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"write"}),"\xa0\u2013 File write operations"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"first-write"})," \u2013 Limits notification to only first write operations for CIFS protocol. For ONTAP 9.2+, this filter can be used for both CIFS and NFS protocols."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"For failed/denied events, the list of supported file operations is limited to the following values:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["CIFS: ",(0,r.jsx)(n.code,{children:"open"})]}),"\n",(0,r.jsxs)(n.li,{children:["NFSv3: ",(0,r.jsx)(n.code,{children:"create, create_dir, read, write, delete, delete_dir, rename, rename_dir, setattr, link"})]}),"\n",(0,r.jsxs)(n.li,{children:["NFSv4: ",(0,r.jsx)(n.code,{children:"open, create, create_dir, read, write, delete, delete_dir, rename, rename_dir, setattr, link"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," All parameters are case sensitive."]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy event for CIFS protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningCifs -volume-operation true -protocol cifs -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningCifs -volume-operation true -protocol cifs -file-operations create,create_dir,delete,delete_dir,open,read,write,rename,rename_dir,setattr -filters first-read,first-write,open-with-delete-intent,setattr-with-owner-change,setattr-with-group-change,setattr-with-sacl-change,setattr-with-dacl-change\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy event for NFSv3 protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningNfsV3 -volume-operation true -protocol nfsv3 -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningNfsV3 -volume-operation true -protocol nfsv3 -file-operations create,create_dir,delete,delete_dir,read,write,rename,rename_dir,setattr,link,symlink -filters first-read,first-write,setattr-with-owner-change,setattr-with-group-change,setattr-with-mode-change\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy event for NFSv4 protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningNfsV4 -volume-operation true -protocol nfsv4 -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningNfsV4 -volume-operation true -protocol nfsv4 -file-operations create,create_dir,delete,delete_dir,read,write,rename,rename_dir,setattr,link,symlink,close -filters setattr-with-group-change,setattr-with-mode-change,setattr-with-sacl-change,setattr-with-dacl-change\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-3-fpolicy-event-creation",children:"Validate Part 3: FPolicy Event Creation"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the creation of the FPolicy event:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy policy event show -vserver [SVM_NAME] -event-name [StealthAUDITScreeningCifs or StealthAUDITScreeningNfsV3 or StealthAUDITScreeningNfsV4 or ...] -instance\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy policy event show -vserver [SVM_NAME] -event-name StealthAUDITScreeningCifs -instance\n"})}),"\n",(0,r.jsx)(n.p,{children:"Verify that the output is displayed as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy policy event show -vserver svm0 -event-name StealthAUDITScreeningCifs  \n\xa0\xa0(vserver fpolicy policy event show)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Vserver: svm0  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Event: StealthAUDITScreeningCifs  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Protocol: cifs  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0File Operations: create, create_dir, delete,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0delete_dir, open, read, write,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0rename, rename_dir, setattr  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Filters: first-read, first-write,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0open-with-delete-intent,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0setattr-with-owner-change,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0setattr-with-group-change,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0setattr-with-sacl-change,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0setattr-with-dacl-change,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0setattr-with-mode-change  \n\xa0\xa0\xa0\xa0\xa0Send Volume Operation Notifications: true  \nSend Failed File Operation Notifications: false\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Relevant NetApp Documentation: To learn more about creating an event, please visit the NetApp website and read the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-event-create.html",children:"vserver fpolicy policy event create"})," article."]}),"\n",(0,r.jsx)(n.h3,{id:"part-4-create-persistent-store",children:"Part 4: Create Persistent Store"}),"\n",(0,r.jsx)(n.p,{children:"The Persistent Store provides a temporary on-disk storage for activity events before they are sent to Activity Monitor Agent. The Persistent Store is optional but recommended for ONTAP 9.15.1 and later versions."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Persistent Store is supported for ONTAP 9.15.1 and later versions."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The SVM used must be the one hosting the CIFS or NFS shares to be monitored."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"There is no need to use an existing volume. A new volume will be created automatically and managed by the FPolicy subsystem."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The volume size depends on the duration for which the events persist and the event rate. For example, if you want 30 minutes of events to persist in an SVM with a capacity of 5000 events/second and the average event record size of 0.6 KB, the required volume size is ",(0,r.jsx)(n.code,{children:"5000 * 30 * 60 * 0.6 KB = 5400000 KB \u2248 5 GB"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["For the Persistent Store to create a volume automatically, at least one local tier (aggregate) must be assigned to the SVM. Use ",(0,r.jsx)(n.code,{children:"vserver add-aggregates"})," to assign local tiers."]}),"\n",(0,r.jsx)(n.p,{children:"The following values are required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"vserver"})," \u2013 The name of the SVM where you want to create the Persistent Store."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"persistent-store"})," \u2013 The name of the Persistent Store object."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The default name is ",(0,r.jsx)(n.code,{children:"StealthAUDITPersistentStore"}),".",(0,r.jsx)(n.br,{}),"\n","The names of the event objects can be customized (see ",(0,r.jsx)(n.a,{href:"#customization-of-fpolicy-object-names",children:"Customization of FPolicy Object Names"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"volume"})," \u2013 The name of the volume used for event storage."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If the volume does not exist, it will be automatically created on an assigned local tier. This is recommended."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"size"})," \u2013 The initial size of the volume. The format is ",(0,r.jsx)(n.code,{children:"<integer>[KB|MB|GB]"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following values are optional:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"autosize-mode"})," \u2013 Specifies the auto size behavior for the volume. Options include ",(0,r.jsx)(n.code,{children:"off"})," (default), ",(0,r.jsx)(n.code,{children:"grow"}),", or ",(0,r.jsx)(n.code,{children:"grow_shrink"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," All parameters are case sensitive."]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the Persistent Store:"}),"\n",(0,r.jsx)(n.p,{children:"vserver fpolicy persistent-store create -vserver [SVM_NAME] -persistent-store [STORE_NAME] -volume [VOLUME_NAME] -size [SIZE] -autosize-mode [AUTOSIZE]"}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.p,{children:"vserver fpolicy persistent-store create -vserver testserver -persistent-store StealthAUDITPersistentStore -volume testserver_ps_vol -size 5GB -autosize-mode grow_shrink"}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-4-create-persistent-store",children:"Validate Part 4: Create Persistent Store"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the creation of the Persistent Store:"}),"\n",(0,r.jsx)(n.p,{children:"vserver fpolicy persistent-store show -vserver [SVM_NAME] -persistent-store StealthAUDITPersistentStore -instance"}),"\n",(0,r.jsx)(n.p,{children:"Ensure that the output is displayed as follows:"}),"\n",(0,r.jsxs)(n.p,{children:["cluster1::> vserver fpolicy persistent-store show -vserver testserver -persistent-store StealthAUDITPersistentStore -instance",(0,r.jsx)(n.br,{}),"\n","Vserver: testserver",(0,r.jsx)(n.br,{}),"\n","Persistent Store Name: StealthAUDITPersistentStore",(0,r.jsx)(n.br,{}),"\n","Volume name of the Persistent store: testserver_ps_vol",(0,r.jsx)(n.br,{}),"\n","Size of the Persistent Store: 5GB",(0,r.jsx)(n.br,{}),"\n","Autosize Mode for the Volume: grow_shrink"]}),"\n",(0,r.jsxs)(n.p,{children:["Visit the NetApp website and see the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli/vserver-fpolicy-persistent-store-create.html",children:"vserver fpolicy persistent store create"})," article for additional information about creating a Persistent Store."]}),"\n",(0,r.jsx)(n.h3,{id:"part-5-create-fpolicy-policy",children:"Part 5: Create FPolicy Policy"}),"\n",(0,r.jsx)(n.p,{children:"The FPolicy policy associates the other three FPolicy components and allows for the designation of a privileged FPolicy user, or the provisioned FPolicy account. If running the Access Auditing (FSAA), Activity Auditing (FSAC), and/or Sensitive Data Discovery Auditing scans in Access Analyzer, then this is also the user account credential to be added to the Access Analyzer Connection Profile."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"To monitor both CIFS and NFS protocols, two FPolicy Event were created. Multiple events can be included in the FPolicy policy."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The External Engine, FPolicy Event, Persistent Store used in this command must be configuration objects created in the preceding steps."}),"\n",(0,r.jsx)(n.p,{children:"The following values are required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"vserver"})," \u2013 The name of SVM."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"policy-name StealthAUDIT"})," \u2013 The name of the policy object can be customized (see ",(0,r.jsx)(n.a,{href:"#customization-of-fpolicy-object-names",children:"Customization of FPolicy Object Names"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"engine"})," \u2013 The name of the External Engine created in ",(0,r.jsx)(n.a,{href:"#part-2-create-external-engine",children:"Part 2: Create External Engine"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"events"})," \u2013 A list of FPolicy Event objects created in ",(0,r.jsx)(n.a,{href:"#part-3-create-fpolicy-event",children:"Part 3: Create FPolicy Event"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"persistent-store"})," \u2013 The name of the Persistent Store created in ",(0,r.jsx)(n.a,{href:"#part-4-create-persistent-store",children:"Part 4: Create Persistent Store"}),". Required only if the Persistent Store is used."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following values are required for Access Analyzer integration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"privileged-user-name"})," \u2013 Must be a provisioned FPolicy account."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"allow-privileged-access"})," \u2013 Set to yes."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," All parameters are case sensitive."]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy policy to monitor both CIFS and NFS protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningCifs,StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\\DOMAINUSER]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningCifs,StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\\user1\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy policy to monitor only CIFS protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningCifs -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\\DOMAINUSER]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningCifs -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\\user1\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy policy to monitor only NFS protocols:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\\DOMAINUSER]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\\user1\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-5-fpolicy-policy-creation",children:"Validate Part 5: FPolicy Policy Creation"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the creation of the FPolicy policy:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy policy show -vserver [SVM_NAME] -policy-name StealthAUDIT -instance\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy policy show -instance  \n\xa0\xa0(vserver fpolicy policy show)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Vserver: svm0  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Policy: StealthAUDIT  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Events to Monitor: StealthAUDITScreeningCifs,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDITScreeningFailedCifs,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDITScreeningNfsV3,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDITScreeningFailedNfsV3,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDITScreeningNfsV4,  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDITScreeningFailedNfsV4  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0FPolicy Engine: StealthAUDITEngine  \nIs Mandatory Screening Required: false  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Allow Privileged Access: no  \nUser Name for Privileged Access: -  \n\xa0\xa0\xa0\xa0Is Passthrough Read Enabled: false  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Persistent Store Name: -\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Relevant NetApp Documentation: To learn more about creating a policy, please visit the NetApp website and read the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli/vserver-fpolicy-policy-create.html",children:"vserver fpolicy policy create"})," article."]}),"\n",(0,r.jsx)(n.h3,{id:"part-6-create-fpolicy-scope",children:"Part 6: Create FPolicy Scope"}),"\n",(0,r.jsx)(n.p,{children:"The FPolicy scope creates the filters necessary to perform scans on specific shares or volumes. It is possible to set the scope to monitor all volumes or all shares by replacing the volume/share name variable [SVM_NAME] in the command with an asterisk (*)."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored."}),"\n",(0,r.jsx)(n.li,{children:"It is not necessary to specify both volumes and shares. One or the other is sufficient."}),"\n",(0,r.jsxs)(n.li,{children:['If you want to monitor everything, set the "',(0,r.jsx)(n.code,{children:"volumes-to-include"}),'" value to "',(0,r.jsx)(n.code,{children:"*"}),'".']}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy scope by specifying volume(s):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy scope create -vserver [SVM_NAME] -policy-name StealthAUDIT -volumes-to-include [VOLUME_NAME],[VOLUME_NAME]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy scope create -vserver testserver -policy-name StealthAUDIT -volumes-to-include samplevolume1,samplevolume2\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to create the FPolicy scope by specifying share(s):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy scope create -vserver [SVM_NAME] -policy-name StealthAUDIT -shares-to-include [SHARE_NAME],[SHARE_NAME]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy scope create -vserver testserver -policy-name StealthAUDIT -shares-to-include sampleshare1,sampleshare2\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-6-fpolicy-scope-creation",children:"Validate Part 6: FPolicy Scope Creation"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the FPolicy scope creation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy policy scope show -instance\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy policy scope show -instance  \n\xa0\xa0(vserver fpolicy policy scope show)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Vserver: svm0  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Policy: StealthAUDIT  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Shares to Include: *  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Shares to Exclude: -  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Volumes to Include: *  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Volumes to Exclude: -  \nExport Policies to Include: *  \nExport Policies to Exclude: -  \nFile Extensions to Include: -  \nFile Extensions to Exclude: -\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Relevant NetApp Documentation: To learn more about creating scope, please visit the NetApp website and read the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-scope-create.html",children:"vserver fpolicy policy scope create"})," article."]}),"\n",(0,r.jsx)(n.h3,{id:"part-7-set-tls-authentication",children:"Part 7: Set TLS Authentication"}),"\n",(0,r.jsx)(n.p,{children:"If using the TLS authentication options, it is necessary to set authentication for the type of authentication."}),"\n",(0,r.jsx)(n.h4,{id:"set-server-authentication",children:"Set Server-Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to set server-authentication:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy externalengine modify -vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option server-auth\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy externalengine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option server-auth\n"})}),"\n",(0,r.jsx)(n.h4,{id:"set-mutual-authentication",children:"Set Mutual-Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to set mutual-authentication:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy external-engine modify \u2011vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name [COMMON_NAME] -certificate-serial [CERTIFICATE_SERIAL] -certificate-ca [CERTIFICATE_AUTHORITY]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'vserver fpolicy policy external-engine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name testserver -certificate-serial 461AC46521B31321330EBBE4321AC51D -certificate-ca "VeriSign Universal Root Certification Authority"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"validate-mutual-authentication-is-set",children:"Validate Mutual-Authentication Is Set"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to confirm mutual-authentication is set:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy external-engine show -fields ssl-option\n"})}),"\n",(0,r.jsx)(n.h3,{id:"part-8-enable-the-fpolicy",children:"Part 8: Enable the FPolicy"}),"\n",(0,r.jsx)(n.p,{children:"The FPolicy must be enabled before the Activity Monitor Agent can be configured to monitor the SVM."}),"\n",(0,r.jsx)(n.p,{children:"IMPORTANT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to enable the FPolicy:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy enable -vserver [SVM_NAME] -policy-name StealthAUDIT -sequence-number [INTEGER]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy enable -vserver testserver -policy-name StealthAUDIT -sequence-number 10\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-8-fpolicy-enabled",children:"Validate Part 8: FPolicy Enabled"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate the FPolicy scope creation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy show\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy show  \n\xa0\xa0\xa0\xa0show\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0show-enabled  \n\xa0\xa0\xa0\xa0show-engine\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0show-passthrough-read-connection  \nOntap915::> fpolicy show  \n\xa0\xa0(vserver fpolicy show)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Sequence  \nVserver\xa0\xa0\xa0\xa0\xa0\xa0\xa0Policy Name\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Number\xa0\xa0Status\xa0\xa0\xa0Engine  \n------------- ----------------------- --------\xa0\xa0-------- ---------  \nsvm0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAUDIT\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa010\xa0\xa0on\xa0\xa0\xa0\xa0\xa0\xa0\xa0StealthAU  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DITEngine\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Relevant NetApp Documentation: To learn more about enabling a policy, please visit the NetApp website and read the ",(0,r.jsx)(n.a,{href:"https://docs.netapp.com/us-en/ontap-cli-9121//vserver-fpolicy-enable.html",children:"vserver fpolicy enable"})," article."]}),"\n",(0,r.jsx)(n.h3,{id:"part-9-connect-fpolicy-server--agent-to-cluster-node",children:"Part 9: Connect FPolicy Server / Agent to Cluster Node"}),"\n",(0,r.jsx)(n.p,{children:"Manually connecting the FPolicy server (or Agent server) to the Cluster Node is only needed if there is an issue with connection to the Cluster Node or for troubleshooting a disconnection issue."}),"\n",(0,r.jsxs)(n.p,{children:["Use the following command to connect the ",(0,r.jsx)(n.code,{children:"StealthAUDITEngine"})," that belongs to the ",(0,r.jsx)(n.code,{children:"StealthAUDIT"})," policy to all Cluster Nodes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"policy engine-connect -vserver [SVM_NAME] -policy-name StealthAUDIT -node *\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"policy engine-connect -vserver testserver -policy-name StealthAUDIT -node *\n"})}),"\n",(0,r.jsx)(n.h4,{id:"validate-part-9-connection-to-cluster-node",children:"Validate Part 9: Connection to Cluster Node"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to validate connection to the Cluster Node:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fpolicy show-engine -vserver [SVM_NAME] -policy-name StealthAUDIT -node *\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ontap915::> fpolicy show-engine -vserver svm0 -policy-name StealthAUDIT -node *  \n\xa0\xa0(vserver fpolicy show-engine)  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0FPolicy\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Server\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Server  \nVserver Policy Name\xa0\xa0\xa0Node\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Server\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Status\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Type  \n------- ------------- ------------ ----------------- -------------- -----------  \nsvm0\xa0\xa0\xa0\xa0StealthAUDIT\xa0\xa0Ontap915-01\xa0\xa0192.168.11.35\xa0\xa0\xa0\xa0\xa0disconnected\xa0\xa0\xa0primary\n"})}),"\n",(0,r.jsx)(n.h2,{id:"automatic-configuration-of-fpolicy",children:"Automatic Configuration of FPolicy"}),"\n",(0,r.jsxs)(n.p,{children:["The Activity Monitor can automatically configure FPolicy on the targeted SVM. The FPolicy created will monitor file system activity from all volumes and shares of the SVM. This feature can be enabled using the ",(0,r.jsx)(n.strong,{children:"Configure FPolicy. Create or modify FPolicy objects if needed"})," checkbox on the FPolicy page in the monitored host's properties in the Activity Monitor."]}),"\n",(0,r.jsxs)(n.p,{children:["Starting ONTAP 9.15.1 and later versions, it is recommended to enable the Persistent Store feature that stores events on disk before they are sent to the Activity Monitor Agent. This reduces client-side latency and increases resilience during network delays or bursts of activity. To enable the Persistent Store, specify a volume name and size on the Persistent Store tab of the FPolicy page in the monitored host properties. The volume will be automatically created if it does not already exist. See the ",(0,r.jsx)(n.a,{href:"#persistent-store",children:"Persistent Store"})," topic for additional information on the recommended volume size."]}),"\n",(0,r.jsx)(n.p,{children:"If using the TLS, mutual authentication option, you will need to create the PEM file for the Client Certification, which is needed during the monitored host configuration in the Activity Monitor. It will also be necessary to set mutual authentication on the SVM."}),"\n",(0,r.jsx)(n.h3,{id:"set-tls-mutual-authentication",children:"Set TLS Mutual-Authentication"}),"\n",(0,r.jsx)(n.p,{children:"If using the TLS, mutual authentication options, it is necessary to set authentication."}),"\n",(0,r.jsx)(n.p,{children:"Use the following command to set mutual-authentication:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy external-engine modify -vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name [COMMON_NAME] -certificate-serial [CERTIFICATE_SERIAL] -certificate-ca [CERTIFICATE_AUTHORITY]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'vserver fpolicy policy external-engine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name testserver -certificate-serial 461AC46521B31321330EBBE4321AC51D -certificate-ca "VeriSign Universal Root Certification Authority"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"validate-mutual-authentication",children:"Validate: Mutual-Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to confirm mutual-authentication is set:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vserver fpolicy policy external-engine show -fields ssl-option\n"})}),"\n",(0,r.jsx)(n.h2,{id:"customization-of-fpolicy-object-names",children:"Customization of FPolicy Object Names"}),"\n",(0,r.jsx)(n.p,{children:"Activity Monitor uses the following FPolicy object names by default:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Policy name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDIT"})]}),"\n",(0,r.jsxs)(n.li,{children:["External Engine name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITEngine"})]}),"\n",(0,r.jsxs)(n.li,{children:["CIFS Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningCifs"})]}),"\n",(0,r.jsxs)(n.li,{children:["NFS v3 Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningNfsV3"})]}),"\n",(0,r.jsxs)(n.li,{children:["NFS v4 Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningNfsV4"})]}),"\n",(0,r.jsxs)(n.li,{children:["Failed CIFS Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningFailedCifs"})]}),"\n",(0,r.jsxs)(n.li,{children:["Failed NFS v3 Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningFailedNfsV3"})]}),"\n",(0,r.jsxs)(n.li,{children:["Failed NFS v4 Event name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITScreeningFailedNfsV4"})]}),"\n",(0,r.jsxs)(n.li,{children:["Persistent Store name \u2013 ",(0,r.jsx)(n.code,{children:"StealthAUDITPersistentStore"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These names can be customized in the monitored host's settings in the Activity Monitor. It can be useful in two scenarios:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You want the names to match the company policies;"}),"\n",(0,r.jsx)(n.li,{children:'You want to configure FPolicy manually using your custom names, but also want to leverage the "Enable and Connect FPolicy" feature of the Activity Monitor, so that the product ensures that FPolicy stays enabled and connected at all times.'}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);