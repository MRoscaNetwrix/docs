"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[627092],{28453:(e,i,t)=>{t.d(i,{R:()=>o,x:()=>c});var n=t(296540);const r={},s=n.createContext(r);function o(e){const i=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(s.Provider,{value:i},e.children)}},122296:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"config/netappcmode/configurefirewall","title":"Configure Network","description":"Activity Monitor requires two communication channels for ONTAP monitoring:","source":"@site/docs/activitymonitor/config/netappcmode/configurefirewall.md","sourceDirName":"config/netappcmode","slug":"/config/netappcmode/configurefirewall","permalink":"/docs/activitymonitor/config/netappcmode/configurefirewall","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/activitymonitor/config/netappcmode/configurefirewall.md","tags":[],"version":"current","frontMatter":{},"sidebar":"activityMonitorSidebar","previous":{"title":"NetApp Data ONTAP Cluster-Mode Activity Auditing Configuration","permalink":"/docs/activitymonitor/config/netappcmode/activity"},"next":{"title":"Configure FPolicy","permalink":"/docs/activitymonitor/config/netappcmode/configurefpolicy"}}');var r=t(474848),s=t(28453);const o={},c="Configure Network",l={},a=[{value:"ONTAP API",id:"ontap-api",level:2},{value:"Management-http Service",id:"management-http-service",level:3},{value:"Firewall Policy",id:"firewall-policy",level:3},{value:"Create New Firewall HTTP Policy",id:"create-new-firewall-http-policy",level:4},{value:"Create New Firewall HTTPS Policy",id:"create-new-firewall-https-policy",level:4},{value:"Apply Firewall Policy to SVM Data LIF",id:"apply-firewall-policy-to-svm-data-lif",level:4},{value:"Validate Firewall Policy",id:"validate-firewall-policy",level:4},{value:"FPolicy",id:"fpolicy",level:2},{value:"Data-fpolicy-client Service",id:"data-fpolicy-client-service",level:3}];function d(e){const i={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"configure-network",children:"Configure Network"})}),"\n",(0,r.jsx)(i.p,{children:"Activity Monitor requires two communication channels for ONTAP monitoring:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"ONTAP\xa0API \u2013 Activity Monitor Agent connects to ONTAP on port 80 (http) or 443 (https) for access to ONTAP API (ONTAPI/ZAPI or REST API)."}),"\n",(0,r.jsx)(i.li,{children:"FPolicy \u2013 Data LIFs of the SVM connect to Activity Monitor Agent on port 9999 for FPolicy notifications."}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"The following sections discuss network configuration required to enable API and FPolicy communication."}),"\n",(0,r.jsx)(i.h2,{id:"ontap-api",children:"ONTAP API"}),"\n",(0,r.jsx)(i.p,{children:"The ONTAP API access is mandatory; without the API access the agent will not be able to receive and translate events from FPolicy. The agent uses the API to retrieve information about the SVM:\xa0CIFS settings, list of volumes, list of LIFs. Depending on the configuration, the agent can also retrieve the state of FPolicy to ensure it is enabled; configure FPolicy and register or unregister itself."}),"\n",(0,r.jsxs)(i.p,{children:["The API access is needed either through the SVM's LIF or through the cluster management LIF with ",(0,r.jsx)(i.em,{children:"vserver tunneling"})," feature. If you want to use the vserver tunneling feature, specify the cluster management LIF's address in the \"Management LIF\"\xa0parameter in the host's settings in the Activity Monitor."]}),"\n",(0,r.jsx)(i.p,{children:"Both classic ONTAPI/ZAPI and the new REST API are supported. Starting with ONTAP\xa09.13.1, the product uses REST API by default if it is available. HTTP and HTTPS protocols are supported. For HTTPS, two modes are supported: strict and ignore errors. For the strict mode, the product allows you to disable the host name validation in case the agent cannot resolve the FQDN\xa0of the LIF."}),"\n",(0,r.jsx)(i.p,{children:"Enabling the API\xa0access varies depending on ONTAP version. The following sections list common steps on enabling the API access. Please refer to the NetApp documentation for more details."}),"\n",(0,r.jsx)(i.h3,{id:"management-http-service",children:"Management-http Service"}),"\n",(0,r.jsxs)(i.p,{children:["Starting with ONTAP 9.6, data LIFs used for HTTPS communication with the Activity Monitor are required to use a service policy that includes the ",(0,r.jsx)(i.code,{children:"management-https"})," service. This service enables HTTPS access to the LIF."]}),"\n",(0,r.jsx)(i.p,{children:"The following examples offer guidance for managing service policies, but may vary depending on the NetApp environment\u2019s specific configuration and needs."}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 1"})," \u2013 Display LIFs of the SVM. Take note of the ",(0,r.jsx)(i.em,{children:"service policy"})," name used by the LIF you want to be used for API access."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface show -vserver [SVM] -instance\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 2"})," \u2013 Check the services included in the SVM service policy"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface service-policy show -policy [POLICY_NAME]\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 3"})," \u2013 Add the ",(0,r.jsx)(i.code,{children:"management-https"})," service if it is missing"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"set -privilege advanced  \nnetwork interface service-policy add-service -service management-https -policy [POLICY_NAME] -vserver [SVM]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"set -privilege advanced  \nnetwork interface service-policy add-service -service management-https -policy default-data-files -vserver testserver\n"})}),"\n",(0,r.jsx)(i.h3,{id:"firewall-policy",children:"Firewall Policy"}),"\n",(0,r.jsx)(i.p,{children:"For ONTAP 9.5 and older, the following commands can be used to either create a new firewall policy or modify an existing policy if ONTAPI is blocked."}),"\n",(0,r.jsx)(i.h4,{id:"create-new-firewall-http-policy",children:"Create New Firewall HTTP Policy"}),"\n",(0,r.jsx)(i.p,{children:"Use the following commands with the Cluster Management LIF to create a new firewall HTTP policy:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy clone \u2011policy data \u2011vserver [ADMIN_SVM_NAME] \u2011destination-policy [FIREWALL_POLICY_NAME] \u2011destination-vserver [SVM_NAME]  \nsystem services firewall policy create \u2011vserver [SVM_NAME] \u2011policy [FIREWALL_POLICY_NAME] \u2011service http \u2011allow-list [IP_ADDRESS]/[NETMASK], [IP_ADDRESS]/[NETMASK]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy clone \u2011policy data \u2011vserver myontap \u2011destination-policy enterpriseauditorfirewall \u2011destination-vserver testserver  \nsystem services firewall policy create \u2011vserver testserver \u2011policy enterpriseauditorfirewall \u2011service http \u2011allow-list 192.168.30.15/32\n"})}),"\n",(0,r.jsx)(i.h4,{id:"create-new-firewall-https-policy",children:"Create New Firewall HTTPS Policy"}),"\n",(0,r.jsx)(i.p,{children:"Use the following commands with the Cluster Management LIF to create a new firewall HTTPS policy:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy clone \u2011policy data \u2011vserver [ADMIN_SVM_NAME] \u2011destination-policy [FIREWALL_POLICY_NAME] \u2011destination-vserver [SVM_NAME]  \nsystem services firewall policy create \u2011vserver [SVM_NAME] \u2011policy [FIREWALL_POLICY_NAME] \u2011service https \u2011allow-list [IP_ADDRESS]/[NETMASK], [IP_ADDRESS]/[NETMASK]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy clone \u2011policy data \u2011vserver myontap \u2011destination-policy enterpriseauditorfirewall \u2011destination-vserver testserver  \nsystem services firewall policy create \u2011vserver testserver \u2011policy enterpriseauditorfirewall \u2011service https \u2011allow-list 192.168.30.15/32\n"})}),"\n",(0,r.jsx)(i.h4,{id:"apply-firewall-policy-to-svm-data-lif",children:"Apply Firewall Policy to SVM Data LIF"}),"\n",(0,r.jsx)(i.p,{children:"Use the following command to modify an existing firewall policy:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface modify \u2011vserver [SVM_NAME] \u2011lif [DATA LIF NAME] \u2011firewall-policy [FIREWALL_POLICY_NAME]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface modify \u2011vserver testserver \u2011lif datal \u2011firewall-policy enterpriseauditorfirewall\n"})}),"\n",(0,r.jsxs)(i.p,{children:["For more information about creating a firewall policy and assigning it to a LIF, read the ",(0,r.jsx)(i.a,{href:"https://docs.netapp.com/us-en/ontap/networking/configure_firewall_policies_for_lifs.html",children:"Configure firewall policies for LIFs"}),(0,r.jsx)(i.a,{href:"https://docs.netapp.com/us-en/ontap/networking/configure_firewall_policies_for_lifs.html",children:" "})," article."]}),"\n",(0,r.jsx)(i.h4,{id:"validate-firewall-policy",children:"Validate Firewall Policy"}),"\n",(0,r.jsx)(i.p,{children:"Run the following command to validate the firewall policy:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy show \u2011policy [FIREWALL_POLICY_NAME] \u2011service [HTTP_HTTPS]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"system services firewall policy show \u2011policy enterpriseauditorfirewall \u2011service http\n"})}),"\n",(0,r.jsx)(i.p,{children:"Verify that the output is displayed as follows:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"validatefirewall",src:t(431487).A+"",width:"606",height:"412"})}),"\n",(0,r.jsx)(i.h2,{id:"fpolicy",children:"FPolicy"}),"\n",(0,r.jsx)(i.p,{children:"The FPolicy framework enables the collection of audit events on the ONTAP side and their transfer to the agent(s) via the designated Data LIFs. Each LIF establishes its own connection with one or several agents and sends notifications as soon as the file transaction occurs. The FPolicy connection is asynchronous and buffered; both ONTAP and Activity Monitor have techniques in place to make sure that connections are alive and working. The connection can be secured using TLS with server or mutual authentication."}),"\n",(0,r.jsx)(i.p,{children:"ONTAP cluster nodes connect to the agent on port 9999 by default. The port can be changed in the agent's settings. The agent adds this port to Windows Firewall exclusions automatically. Please ensure the port is not blocked by other firewalls between ONTAP\xa0and the agent."}),"\n",(0,r.jsx)(i.h3,{id:"data-fpolicy-client-service",children:"Data-fpolicy-client Service"}),"\n",(0,r.jsxs)(i.p,{children:["Starting with ONTAP 9.8, each data LIF of the SVM must have the ",(0,r.jsx)(i.strong,{children:"data-fpolicy-client"})," service included in its service-policy configuration. This service enables the FPolicy protocol for the LIF. Use the following commands to ensure that the service is included."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 1"})," \u2013 Display LIFs of the SVM. Take note of the ",(0,r.jsx)(i.em,{children:"service policy"})," name used by the data LIFs."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface show -vserver [SVM] -instance\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 2"})," \u2013 Check the services included in the SVM service policy"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"network interface service-policy show -policy [POLICY_NAME]\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Step 3"})," \u2013 Add the ",(0,r.jsx)(i.strong,{children:"data-fpolicy-client"})," service if it is missing"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"set -privilege advanced  \nnetwork interface service-policy add-service -service data-fpolicy-client -policy [POLICY_NAME] -vserver [SVM]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"set -privilege advanced  \nnetwork interface service-policy add-service -service data-fpolicy-client -policy default-data-files -vserver testserver\n"})})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},431487:(e,i,t)=>{t.d(i,{A:()=>n});const n=t.p+"assets/images/validatefirewall-82aaeb448425d348ce6b76a200ca15c9.webp"}}]);