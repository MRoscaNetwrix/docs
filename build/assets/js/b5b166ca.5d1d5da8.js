"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[562227],{28453:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>n});var s=o(296540);const a={},i=s.createContext(a);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function n(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:t},e.children)}},150773:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>n,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"policypak/video/leastprivilege/bestpractices/powershellblock","title":"Block PowerShell in General, Open up for specific items","description":"Powershell on desktops? Terrible idea. Except when you need it. Check out this video to see how to kill PowerShell (generally) but open it up to allow specific. PS1 scripts to run as you need them to. With Netwrix Endpoint Policy Manager (formerly PolicyPak) Least Privilege Manager, it\'s easy !","source":"@site/docs/policypak/policypak/video/leastprivilege/bestpractices/powershellblock.md","sourceDirName":"policypak/video/leastprivilege/bestpractices","slug":"/policypak/video/leastprivilege/bestpractices/powershellblock","permalink":"/docs/policypak/policypak/video/leastprivilege/bestpractices/powershellblock","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/policypak/policypak/video/leastprivilege/bestpractices/powershellblock.md","tags":[],"version":"current","frontMatter":{},"sidebar":"policyPakSidebar","previous":{"title":"Increase security by reducing rights on Open/Save dialogs","permalink":"/docs/policypak/policypak/video/leastprivilege/bestpractices/opensavedialogs"},"next":{"title":"SecureRun to block User AND System executables","permalink":"/docs/policypak/policypak/video/leastprivilege/bestpractices/securerun/usersystemexecutables"}}');var a=o(474848),i=o(28453);const r={},n="Block PowerShell in General, Open up for specific items",l={},h=[];function c(e){const t={code:"code",h1:"h1",header:"header",p:"p",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"block-powershell-in-general-open-up-for-specific-items",children:"Block PowerShell in General, Open up for specific items"})}),"\n",(0,a.jsx)(t.p,{children:"Powershell on desktops? Terrible idea. Except when you need it. Check out this video to see how to kill PowerShell (generally) but open it up to allow specific. PS1 scripts to run as you need them to. With Netwrix Endpoint Policy Manager (formerly PolicyPak) Least Privilege Manager, it's easy !"}),"\n",(0,a.jsx)(t.p,{children:"Hi. This is Jeremy Moskowitz. In this video, I'm going to show you how you can put the full smackdown on PowerShell and also open up PowerShell for very specific scenarios."}),"\n",(0,a.jsx)(t.p,{children:'I\'ve got no policy set up here with PolicyPak at this time. Just to prove a point, if I go to "Command Prompt," that works. If I type "powershell," that works. If I try to go to "Windows PowerShell" here, that works. So you can see PowerShell is enabled.'}),"\n",(0,a.jsx)(t.p,{children:"The first thing I want to do is create a policy. In fact, I'm going to create two policies that are going to put the smackdown on PowerShell. There are a couple ways you can do it. I actually think both are good. I actually have these pre-staged just to make this demo go a little bit faster."}),"\n",(0,a.jsxs)(t.p,{children:['The first one is denying PowerShell by name. So whenever you try to run anything with "',(0,a.jsx)(t.code,{children:"powersh"}),'" in the "Name," it\'s automatically going to "Deny execution." So if it has "powersh" in the name, that is going to be smacked down. That\'s thing number one. I have to reenable that guy. Let\'s go ahead and go back there and the "State" is going to be back to "Enabled." That\'s way number one.']}),"\n",(0,a.jsx)(t.p,{children:'A second and additionally powerful way to do it is to say if there\'s anything "recursive" in the "WindowsPowerShell" folder, just don\'t let that run. Just "Deny execution" on that. So that\'s two different ways. That way if somebody were to try to copy PowerShell or some other kind of way, long story short, you have a couple of different angles to turn that off right there. So that\'s killing PowerShell there.'}),"\n",(0,a.jsxs)(t.p,{children:["Let's just start and just see that that actually worked as expected. If I now run GP Update (\"",(0,a.jsx)(t.code,{children:"gpupdate"}),'"), this could happen naturally at logon. You could wait for Group Policy to process in the background. We just run alongside the Group Policy engine just like everything else runs alongside the Group Policy engine. Give this a second to finish up.']}),"\n",(0,a.jsx)(t.p,{children:'Now that that\'s done, let\'s go ahead and type "powershell" here. What happens? You can see it says, "This program is blocked by group policy." This is a system message. You might think we have something to do with AppLocker. We don\'t. This is just a standard system message.'}),"\n",(0,a.jsx)(t.p,{children:'If I were to try to now go to "Windows PowerShell" here, "This app has been blocked by your system administrator." If I were to try to run a PowerShell script that could have been malware, right click over it and select "Run with PowerShell," "This app has been blocked by your system administrator." That\'s also blocked just the way we want it to be.'}),"\n",(0,a.jsxs)(t.p,{children:["But you might have a scenario where you want a certain specific file or files to work. Here's an example: \"",(0,a.jsx)(t.code,{children:"\\\\dc2016\\share\\ITScripts"}),'." With ITScripts I have a good PowerShell that I want to run but only when I\'ve staged it here in "dc2016 > share." If I right click here and go to "Run with PowerShell," "This app has been blocked by your system administrator." It\'s still not going to work. It has been blocked by my system admin.']}),"\n",(0,a.jsxs)(t.p,{children:["So what are we're going to do? We're just going to open that up. I already have a rule staged just to make this demo go a little faster. We're saying whenever anybody tries to run \"",(0,a.jsx)(t.code,{children:"\\\\dcshare2016\\SHARE\\ITScripts\\PS \u2013 From IT"}),'," then go ahead and "Allow and log." It doesn\'t have to be elevated. It just has to run. I already have this "Disabled." Let me go ahead and check "Enabled" and turn that back on.']}),"\n",(0,a.jsxs)(t.p,{children:["That's all there is to it. You saw ten seconds ago that script wouldn't run. Let me go ahead and run GP Update (\"",(0,a.jsx)(t.code,{children:"gpupdate"}),'"). Then we\'ll finish up and we\'ll see that script will be bypassed even though generally PowerShell is shot. Let\'s go ahead and give this a second to finish up here. Now let\'s go ahead and right click over "PS \u2013 From IT" and select "Run with PowerShell." There we go. "Hello From IT Department."']}),"\n",(0,a.jsx)(t.p,{children:'But other items, like I said, if we were to try to go back to "Scripts," here\'s a random PowerShell "Malware" that I have. It\'s not really malware. If I were to "Run with PowerShell," "This app has been blocked by your system administrator."'}),"\n",(0,a.jsx)(t.p,{children:"Hopefully, this satisfies the case of taking PowerShell out of business but reenabling PowerShell for very specific scripts that you might want to stage yourself or otherwise have available for users."}),"\n",(0,a.jsx)(t.p,{children:"If you're looking to get started with PolicyPak, we want to help you to help you get started real soon. So give us a buzz or fill out a form, and we'll be in touch and we'll get you started."}),"\n",(0,a.jsx)(t.p,{children:"Thank you very much, and talk to you soon."})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);