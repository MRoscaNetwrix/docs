"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[310250],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(296540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},664508:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"config/sharepointonline/activity","title":"SharePoint Online Activity Auditing Configuration","description":"In order to collect logs and monitor SharePoint Online activity using the Netwrix Activity Monitor, it needs to be registered with Microsoft\xae Entra ID\xae (formerly Azure AD).","source":"@site/docs/accessanalyzer/config/sharepointonline/activity.md","sourceDirName":"config/sharepointonline","slug":"/config/sharepointonline/activity","permalink":"/docs/accessanalyzer/config/sharepointonline/activity","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/config/sharepointonline/activity.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"SharePoint Online Access & Sensitive Data Auditing Configuration","permalink":"/docs/accessanalyzer/config/sharepointonline/access"},"next":{"title":"SharePoint Online Target Requirements","permalink":"/docs/accessanalyzer/config/sharepointonline/overview"}}');var r=i(474848),s=i(28453);const o={},l="SharePoint Online Activity Auditing Configuration",a={},c=[{value:"Register a Microsoft Entra ID Application",id:"register-a-microsoft-entra-id-application",level:2},{value:"Grant Permissions to the Registered Application",id:"grant-permissions-to-the-registered-application",level:2},{value:"Identify the Client ID",id:"identify-the-client-id",level:2},{value:"Identify the Tenant ID",id:"identify-the-tenant-id",level:2},{value:"Generate the Client Secret Key",id:"generate-the-client-secret-key",level:2},{value:"Enable Auditing for SharePoint Online",id:"enable-auditing-for-sharepoint-online",level:2}];function d(e){const n={a:"a",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sharepoint-online-activity-auditing-configuration",children:"SharePoint Online Activity Auditing Configuration"})}),"\n",(0,r.jsx)(n.p,{children:"In order to collect logs and monitor SharePoint Online activity using the Netwrix Activity Monitor, it needs to be registered with Microsoft\xae Entra ID\xae (formerly Azure AD)."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," A user account with the Global Administrator role is required to register an app with Microsoft Entra ID."]}),"\n",(0,r.jsx)(n.p,{children:"Additional Requirement"}),"\n",(0,r.jsx)(n.p,{children:"In addition to registering the application with Microsoft Entra ID, the following is required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable Auditing for SharePoint Online"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"#enable-auditing-for-sharepoint-online",children:"Enable Auditing for SharePoint Online"})," topic for additional information."]}),"\n",(0,r.jsx)(n.p,{children:"Configuration Settings from the Registered Application"}),"\n",(0,r.jsx)(n.p,{children:"The following settings are needed from your tenant once you have registered the application:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Tenant ID \u2013 This is the Tenant ID for Microsoft Entra ID"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Client ID \u2013 This is the Application (client) ID for the registered application"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Client Secret \u2013 This is the Client Secret Value generated when a new secret is created"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," It is not possible to retrieve the value after saving the new key. It must be copied first."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Permissions for Microsoft Graph API"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Application:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Directory.Read.All \u2013 Read directory data"}),"\n",(0,r.jsx)(n.li,{children:"Sites.Read.All \u2013 Read items in all site collections"}),"\n",(0,r.jsx)(n.li,{children:"User.Read.All \u2013 Read all users' full profiles"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Permissions for Office 365 Management APIs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Application Permissions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ActivityFeed.Read \u2013 Read activity data for your organization"}),"\n",(0,r.jsx)(n.li,{children:"ActivityFeed.ReadDlp \u2013 Read DLP policy events including detected sensitive data"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"register-a-microsoft-entra-id-application",children:"Register a Microsoft Entra ID Application"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to register Activity Monitor with Microsoft Entra ID."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," The steps below are for registering an app through the Microsoft Entra admin center. These steps may vary slightly if you use a different Microsoft portal. See the relevant Microsoft documentation for additional information."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Sign in to the ",(0,r.jsx)(n.a,{href:"https://entra.microsoft.com/",children:"Microsoft Entra admin center"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," On the left navigation menu, navigate to ",(0,r.jsx)(n.strong,{children:"Identity"})," > ",(0,r.jsx)(n.strong,{children:"Applications"})," and click App registrations."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," In the top toolbar, click ",(0,r.jsx)(n.strong,{children:"New registration"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 4 \u2013"})," Enter the following information in the Register an application page:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Name \u2013 Enter a user-facing display name for the application, for example Netwrix Activity Monitor for SharePoint"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Supported account types \u2013 Select ",(0,r.jsx)(n.strong,{children:"Accounts in this organizational directory only"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Redirect URI \u2013 Set the Redirect URI to ",(0,r.jsx)(n.strong,{children:"Public client/native"}),"  (Mobile and desktop) from the drop down menu. In the text box, enter the following:"]}),"\n",(0,r.jsxs)(n.p,{children:["Urn:ietf:wg:oauth:2.0",":oob"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 5 \u2013"})," Click ",(0,r.jsx)(n.strong,{children:"Register"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The Overview page for the newly registered app opens. Review the newly created registered application. Now that the application has been registered, permissions need to be granted to it."}),"\n",(0,r.jsx)(n.h2,{id:"grant-permissions-to-the-registered-application",children:"Grant Permissions to the Registered Application"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to grant permissions to the registered application."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," The steps below are for registering an app through the Microsoft Entra admin center. These steps may vary slightly if you use a different Microsoft portal. See the relevant Microsoft documentation for additional information."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Select the newly-created, registered application. If you left the Overview page, it will be listed in the ",(0,r.jsx)(n.strong,{children:"Identity"})," > ",(0,r.jsx)(n.strong,{children:"Applications"})," > ",(0,r.jsx)(n.strong,{children:"App registrations"})," > ",(0,r.jsx)(n.strong,{children:"All applications"})," list."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," On the registered app blade, click ",(0,r.jsx)(n.strong,{children:"API permissions"})," in the Manage section."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," In the top toolbar, click ",(0,r.jsx)(n.strong,{children:"Add a permission"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 4 \u2013"})," On the Request API permissions blade, select ",(0,r.jsx)(n.strong,{children:"Microsoft Graph"})," on the Microsoft APIs tab. Select the following permissions:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Application:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Directory.Read.All \u2013 Read directory data"}),"\n",(0,r.jsx)(n.li,{children:"Sites.Read.All \u2013 Read items in all site collections"}),"\n",(0,r.jsx)(n.li,{children:"User.Read.All \u2013 Read all users' full profiles"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 5 \u2013"})," At the bottom of the page, click ",(0,r.jsx)(n.strong,{children:"Add Permissions"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 6 \u2013"})," In the top toolbar, click ",(0,r.jsx)(n.strong,{children:"Add a permission"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 7 \u2013"})," On the Request API permissions blade, select ",(0,r.jsx)(n.strong,{children:"Office 365 Management APIs"})," on the Microsoft APIs tab. Select the following permissions:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Application Permissions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ActivityFeed.Read \u2013 Read activity data for your organization"}),"\n",(0,r.jsx)(n.li,{children:"ActivityFeed.ReadDlp \u2013 Read DLP policy events including detected sensitive data"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 8 \u2013"})," At the bottom of the page, click ",(0,r.jsx)(n.strong,{children:"Add Permissions"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 9 \u2013"})," Click ",(0,r.jsx)(n.strong,{children:"Grant Admin Consent for [tenant]"}),". Then click ",(0,r.jsx)(n.strong,{children:"Yes"})," in the confirmation window."]}),"\n",(0,r.jsx)(n.p,{children:"Now that the permissions have been granted to it, the settings required for Activity Monitor need to be collected."}),"\n",(0,r.jsx)(n.h2,{id:"identify-the-client-id",children:"Identify the Client ID"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to find the registered application's Client ID."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," The steps below are for registering an app through the Microsoft Entra admin center. These steps may vary slightly if you use a different Microsoft portal. See the relevant Microsoft documentation for additional information."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Select the newly-created, registered application. If you left the Overview page, it will be listed in the ",(0,r.jsx)(n.strong,{children:"Identity"})," > ",(0,r.jsx)(n.strong,{children:"Applications"})," > ",(0,r.jsx)(n.strong,{children:"App registrations"})," > ",(0,r.jsx)(n.strong,{children:"All applications"})," list."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," Copy the ",(0,r.jsx)(n.strong,{children:"Application (client) ID"})," value."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," Save this value in a text file."]}),"\n",(0,r.jsx)(n.p,{children:"This is needed for adding a SharePoint Online host in the Activity Monitor. Next identify the Tenant ID."}),"\n",(0,r.jsx)(n.h2,{id:"identify-the-tenant-id",children:"Identify the Tenant ID"}),"\n",(0,r.jsx)(n.p,{children:"The Tenant ID is available in two locations within Microsoft Entra ID."}),"\n",(0,r.jsx)(n.p,{children:"Registered Application Overview Blade"}),"\n",(0,r.jsx)(n.p,{children:"You can copy the Tenant ID from the same page where you just copied the Client ID. Follow the steps to copy the Tenant ID from the registered application Overview blade."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Copy the Directory (tenant) ID value."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," Save this value in a text file."]}),"\n",(0,r.jsx)(n.p,{children:"This is needed for adding a SharePoint Online host in the Activity Monitor. Next generate the application\u2019s Client Secret Key."}),"\n",(0,r.jsx)(n.p,{children:"Overview Page"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to find the tenant name where the registered application resides."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," The steps below are for registering an app through the Microsoft Entra admin center. These steps may vary slightly if you use a different Microsoft portal. See the relevant Microsoft documentation for additional information."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Sign in to the ",(0,r.jsx)(n.a,{href:"https://entra.microsoft.com/",children:"Microsoft Entra admin center"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," Copy the Tenant ID value."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," Save this value in a text file."]}),"\n",(0,r.jsx)(n.p,{children:"This is needed for adding a SharePoint Online host in the Activity Monitor. Next generate the application\u2019s Client Secret Key."}),"\n",(0,r.jsx)(n.h2,{id:"generate-the-client-secret-key",children:"Generate the Client Secret Key"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to find the registered application's Client Secret, create a new key, and save its value when saving the new key."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," The steps below are for registering an app through the Microsoft Entra admin center. These steps may vary slightly if you use a different Microsoft portal. See the relevant Microsoft documentation for additional information."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," It is not possible to retrieve the value after saving the new key. It must be copied first."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," Select the newly-created, registered application. If you left the Overview page, it will be listed in the ",(0,r.jsx)(n.strong,{children:"Identity"})," > ",(0,r.jsx)(n.strong,{children:"Applications"})," > ",(0,r.jsx)(n.strong,{children:"App registrations"})," > ",(0,r.jsx)(n.strong,{children:"All applications"})," list."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," On the registered app blade, click ",(0,r.jsx)(n.strong,{children:"Certificates & secrets"})," in the Manage section."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," In the top toolbar, click ",(0,r.jsx)(n.strong,{children:"New client secret"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 4 \u2013"})," On the Add a client secret blade, complete the following:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Description \u2013 Enter a unique description for this secret"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Expires \u2013 Select the duration."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"NOTE:"})," Setting the duration on the key to expire requires reconfiguration at the time of expiration. It is best to configure it to expire in 1 or 2 years."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 5 \u2013"})," Click ",(0,r.jsx)(n.strong,{children:"Add"})," to generate the key."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CAUTION:"})," If this page is left before the key is copied, then the key is not retrievable, and this process will have to be repeated."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 6 \u2013"})," The Client Secret will be displayed in the Value column of the table. You can use the Copy to clipboard button to copy the Client Secret."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 7 \u2013"})," Save this value in a text file."]}),"\n",(0,r.jsx)(n.p,{children:"This is needed for adding a SharePoint Online host in the Activity Monitor."}),"\n",(0,r.jsx)(n.h2,{id:"enable-auditing-for-sharepoint-online",children:"Enable Auditing for SharePoint Online"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps to enable auditing for SharePoint Online so the Activity Monitor can receive events."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 1 \u2013"})," In the Microsoft Purview compliance portal at ",(0,r.jsx)(n.a,{href:"https://purview.microsoft.com/",children:"https://purview.microsoft.com"}),", go to ",(0,r.jsx)(n.strong,{children:"Solutions"})," > ",(0,r.jsx)(n.strong,{children:"Audit"}),". Or, to go directly to the Audit page at ",(0,r.jsx)(n.a,{href:"https://purview.microsoft.com/audit/auditsearch",children:"https://purview.microsoft.com/audit/auditsearch"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 2 \u2013"})," If auditing is not turned on for your organization, a banner is displayed prompting you start recording user and admin activity."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Step 3 \u2013"})," Select the ",(0,r.jsx)(n.strong,{children:"Start recording"})," user and ",(0,r.jsx)(n.strong,{children:"admin activity"})," banner."]}),"\n",(0,r.jsxs)(n.p,{children:["It may take up to 60 minutes for the change to take effect. The Activity Monitor now has SharePoint Online auditing enabled as needed to receive events. See the Microsoft ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoft-365/compliance/audit-log-enable-disable?view=o365-worldwide",children:"Turn auditing on or off"})," article for additional information on enabling or disabling auditing."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);