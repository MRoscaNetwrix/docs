"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[354645],{28453:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>l});var n=t(296540);const i={},r=n.createContext(i);function o(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:s},e.children)}},92727:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/metricscollectionqueries-c0d0056254674ff61216a5b3d8f7317c.webp"},311021:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/sethistoryretentionscripteditor-49ec3c5217cd2f7cacbb1a61e06db43c.webp"},358122:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricscollection","title":"EX\\\\_MetricsCollection Job","description":"The EX\\\\MetricsCollection Job is comprised of multiple queries that utilize the ExchangeMetrics Data Collector to process and collect the message tracking logs on the Exchange servers in the environment. These queries collect server, domain, user, and distribution list traffic including but not limited to: sent, received, journal, NDRs, and transports messages. These queries are configured to process and collect that previous 7 days of Message Tracking Logs the first time this job is run, after that it only collects the previous day unless the Enable Persistent Log State_ option has been enabled in the query.","source":"@site/docs/accessanalyzer/enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricscollection.md","sourceDirName":"enterpriseauditor/solutions/exchange/hubmetrics/collection","slug":"/enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricscollection","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricscollection","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricscollection.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":".AppletStatusCheck Job","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/exchange/hubmetrics/collection/appletstatuscheck"},"next":{"title":"EX\\\\_MetricsDetails Job","permalink":"/docs/accessanalyzer/enterpriseauditor/solutions/exchange/hubmetrics/collection/ex_metricsdetails"}}');var i=t(474848),r=t(28453);const o={},l="EX_MetricsCollection Job",c={},a=[{value:"Queries for the EX_MetricsCollection Job",id:"queries-for-the-ex_metricscollection-job",level:2},{value:"Analysis Tasks for the EX_MetrixCollection Job",id:"analysis-tasks-for-the-ex_metrixcollection-job",level:2},{value:"Exchange History Retention",id:"exchange-history-retention",level:2},{value:"Troubleshooting Data Collection",id:"troubleshooting-data-collection",level:2}];function h(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"ex_metricscollection-job",children:"EX_MetricsCollection Job"})}),"\n",(0,i.jsxs)(s.p,{children:["The EX_MetricsCollection Job is comprised of multiple queries that utilize the ExchangeMetrics Data Collector to process and collect the message tracking logs on the Exchange servers in the environment. These queries collect server, domain, user, and distribution list traffic including but not limited to: sent, received, journal, NDRs, and transports messages. These queries are configured to process and collect that previous 7 days of Message Tracking Logs the first time this job is run, after that it only collects the previous day unless the ",(0,i.jsx)(s.strong,{children:"Enable Persistent Log State"})," option has been enabled in the query."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:(0,i.jsx)(s.strong,{children:"RECOMMENDED:"})})," Run this job with the default configuration settings for all queries."]}),"\n",(0,i.jsxs)(s.p,{children:["See the ",(0,i.jsx)(s.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/datacollector/exchangemetrics/overview",children:"ExchangeMetrics Data Collector"})," topic for additional information."]}),"\n",(0,i.jsx)(s.h2,{id:"queries-for-the-ex_metricscollection-job",children:"Queries for the EX_MetricsCollection Job"}),"\n",(0,i.jsx)(s.p,{children:"The EX_MetricsCollection Job uses the ExchangeMetrics Data Collector."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"Queries for the EX_MetricsCollection Job",src:t(92727).A+"",width:"832",height:"324"})}),"\n",(0,i.jsx)(s.p,{children:"The following queries are included in the EX_MetricsCollection Job:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Server Metrics \u2013 Collects server metrics"}),"\n",(0,i.jsx)(s.li,{children:"User Metrics \u2013 Collects user metrics"}),"\n",(0,i.jsx)(s.li,{children:"Internet Traffic Metrics \u2013 Collects internet traffic metrics"}),"\n",(0,i.jsx)(s.li,{children:"Distribution List Metrics \u2013 Collects distribution list metrics"}),"\n",(0,i.jsx)(s.li,{children:"Message Size Metrics \u2013 Collects message size metrics"}),"\n",(0,i.jsx)(s.li,{children:"Delivery Time \u2013 Collects delivery times metrics"}),"\n",(0,i.jsx)(s.li,{children:"Hourly Statistics \u2013 Collects server metrics"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"analysis-tasks-for-the-ex_metrixcollection-job",children:"Analysis Tasks for the EX_MetrixCollection Job"}),"\n",(0,i.jsxs)(s.p,{children:["View the analysis tasks by navigating to the ",(0,i.jsx)(s.strong,{children:"Exchange"})," > ",(0,i.jsx)(s.strong,{children:"1. HUB Metrics"})," > ",(0,i.jsx)(s.strong,{children:"0. Collection"})," > ",(0,i.jsx)(s.strong,{children:"EX_MetricsCollection"})," > ",(0,i.jsx)(s.strong,{children:"Configure"})," node and selecting ",(0,i.jsx)(s.strong,{children:"Analysis"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"CAUTION:"})," Do not modify or deselect the selected analysis tasks. The analysis tasks are preconfigured for this job."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"Analysis Tasks for the EX_MetrixCollection Job",src:t(901722).A+"",width:"620",height:"327"})}),"\n",(0,i.jsx)(s.p,{children:"The following analysis tasks are selected by default:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Delivery Times History \u2013 Creates the SA_ExhangeMetrics_DeliveryTimes table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"DL History \u2013 Creates the SA_EX_ ExhangeMetrics_DistributionLists table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Internet Traffic History \u2013 Creates the SA_EX_ExhangeMetrics_InternetTraffic table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"4",children:["\n",(0,i.jsx)(s.li,{children:"Hourly Traffic History \u2013 Creates the SA_EX_ExhangeMetrics_HourlyTraffic table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"5",children:["\n",(0,i.jsx)(s.li,{children:"User Traffic History \u2013 Creates the SA_EX_ExhangeMetrics_UserTraffic table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"6",children:["\n",(0,i.jsx)(s.li,{children:"Message Size History \u2013 Creates the SA_EX_ExhangeMetrics_MessageSize table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"7",children:["\n",(0,i.jsx)(s.li,{children:"Server Traffic History \u2013 Creates the SA_EX_ExhangeMetrics_ServerTraffic table, accessible under the job\u2019s Results node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"8",children:["\n",(0,i.jsx)(s.li,{children:"SET HISTORY RETENTION \u2013 Sets retention period in months"}),"\n"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["By default set to retain ",(0,i.jsx)(s.strong,{children:"6 months"})]}),"\n",(0,i.jsxs)(s.li,{children:["This retention period can be modified. See the ",(0,i.jsx)(s.a,{href:"#exchange-history-retention",children:"Exchange History Retention"})," topic for additional information."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"The following analysis task deletes table data from data collection and analysis jobs. This analysis task should remain deselected unless specifically needed:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"CAUTION:"})," Do not select the ",(0,i.jsx)(s.strong,{children:"00. Deletes all Stored Data"})," option. This analysis task is for troubleshooting and cleanup only. Data will be deleted from the database."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"0",children:["\n",(0,i.jsx)(s.li,{children:"Deletes all Stored Data - LEAVE UNCHECKED \u2013 Clears all historical data"}),"\n"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["See the ",(0,i.jsx)(s.a,{href:"#troubleshooting-data-collection",children:"Troubleshooting Data Collection"})," topic for additional information"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"exchange-history-retention",children:"Exchange History Retention"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.strong,{children:"08. SET HISTORY RETENTION"})," analysis task controls the retention period for the job\u2019s data. This is why the Data Retention Period options at the global, job group, or job Properties settings are not supported for the job group. The number of months can be modified. If desired, the parameter can be set to a specified number of days. Follow these steps to modify the history retention period."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 1 \u2013"})," Navigate to the job\u2019s ",(0,i.jsx)(s.strong,{children:"Configure"})," node and select ",(0,i.jsx)(s.strong,{children:"Analysis"}),"."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"08. SET HISTORY RETENTION task in the Analysis Selection view",src:t(914154).A+"",width:"626",height:"331"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 2 \u2013"})," In the Analysis Selection view, select the ",(0,i.jsx)(s.strong,{children:"08. SET HISTORY RETENTION"})," analysis task and click ",(0,i.jsx)(s.strong,{children:"Analysis Configuration"}),". The SQL Script Editor opens."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"History Retention task in SQL Script Editor",src:t(311021).A+"",width:"708",height:"595"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 3 \u2013"})," To modify the number of months: On line 6, modify the value for the months parameter:"]}),"\n",(0,i.jsx)(s.p,{children:"Skip to Step 5."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 4 \u2013"})," To change the period parameter from months to days:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Comment out lines 4, 6, and 8 which contain the months parameter. To comment out a line add ",(0,i.jsx)(s.code,{children:"--"})," preceding it. The months parameter section should be as follows:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"--Sets Retention Period in Months  \n--Declare @Months Float  \n--To Change the numbers of months to keep, Modify this value  \n--set @Months = 6  \n--Creates RetentionPeriod to be utilize in Where Clause  \n--Set @RetentionPeriod = CAST(DATEADD(MM, -@Months, GETDATE()) AS DATE)\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Uncomment out (remove ",(0,i.jsx)(s.code,{children:"--"})," from) lines 12, 13, and 14 (which contain the days parameter). The days parameter section should be as follows:"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"If desired, modify the number of days on line 13. The default days parameter is set to 30 days."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 5 \u2013"})," Click ",(0,i.jsx)(s.strong,{children:"Save and Close"}),". The SQL Script Editor closes."]}),"\n",(0,i.jsx)(s.p,{children:"The modified history retention period is now applied during future job executions."}),"\n",(0,i.jsx)(s.h2,{id:"troubleshooting-data-collection",children:"Troubleshooting Data Collection"}),"\n",(0,i.jsx)(s.p,{children:"There might be times when it is necessary to purge the data either through dropping the tables from the database or truncating the data within the tables. This option is provided through ananalysis task that is not selected by default. Only one analysis task within a job should be enabled when the desire is to purge that database."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"CAUTION:"})," This analysis task deletes information collected or produced by jobs in this solution."]}),"\n",(0,i.jsx)(s.p,{children:"Follow these steps to troubleshoot data collection:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 1 \u2013"})," Navigate to the job\u2019s ",(0,i.jsx)(s.strong,{children:"Configure"})," node and select ",(0,i.jsx)(s.strong,{children:"Analysis"}),"."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"Troubleshooting task selection",src:t(597448).A+"",width:"612",height:"332"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 2 \u2013"})," In the Analysis Selection view, clear all default analysis tasks (if any) and select the analysis task which purges data."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:"Remember,"})," only one task should be selected."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 3 \u2013"})," In the Navigation pane, right-click the ",(0,i.jsx)(s.strong,{children:"Analysis"})," node and select ",(0,i.jsx)(s.strong,{children:"Execute Analyses"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 4 \u2013"})," After the analysis task has been executed, return to the Analysis Selection view. Deselect the analysis task which was executed and reselect the default analysis tasks (if any had been cleared in Step 2)."]}),"\n",(0,i.jsx)(s.p,{children:"The selected purge of data and tables has taken place, and the analysis tasks have been reset to the default state."})]})}function d(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},597448:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/troubleshootingtaskselection-07b2e561d82b23b48ee17f7618cd578d.webp"},901722:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/metricscollectionanalysis-20c3008f9095aec537e81f63decc2e66.webp"},914154:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/sethistoryretentiontask-d87afa25a9f84273a9e4a1336e3fba43.webp"}}]);