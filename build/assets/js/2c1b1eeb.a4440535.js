"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[50556],{28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var i=r(296540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},808965:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"enterpriseauditor/requirements/target/config/azureinformationprotection","title":"Azure Information Protection Target Requirements","description":"Microsoft\xae Azure is a cloud-based computing platform that provides a range of services, such as file storage. Azure uses Azure Information Protection (AIP) labels, a Microsoft tool used to classify and protect stored files. Access Analyzer employs the File System Solution to execute Access Auditing (FSAA) and/or Sensitive Data Discovery Auditing scans in order to find AIP Protection labels and scan protected (i.e. encrypted) files for sensitive data.","source":"@site/docs/accessanalyzer/enterpriseauditor/requirements/target/config/azureinformationprotection.md","sourceDirName":"enterpriseauditor/requirements/target/config","slug":"/enterpriseauditor/requirements/target/config/azureinformationprotection","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/target/config/azureinformationprotection","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/enterpriseauditor/requirements/target/config/azureinformationprotection.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"Azure Files Target Requirements","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/target/config/azurefiles"},"next":{"title":"Azure SQL Auditing Configuration","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/target/config/azuresqlaccess"}}');var s=r(474848),t=r(28453);const o={},c="Azure Information Protection Target Requirements",l={},a=[{value:"Workflow for Scanning AIP\xa0Labels",id:"workflow-for-scanning-aiplabels",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Rights Management Service Client Installation",id:"rights-management-service-client-installation",level:2},{value:"Create a Service Principal Account using PowerShell",id:"create-a-service-principal-account-using-powershell",level:2},{value:"Enable the Account as an AIP Super User using PowerShell",id:"enable-the-account-as-an-aip-super-user-using-powershell",level:2},{value:"Add User to the AIP Role in Microsoft\xae Azure",id:"add-user-to-the-aip-role-in-microsoft-azure",level:2},{value:"Access Analyzer Configurations",id:"access-analyzer-configurations",level:2},{value:"Azure Connection Profile",id:"azure-connection-profile",level:3},{value:"Configure FSAA Data Collector",id:"configure-fsaa-data-collector",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"azure-information-protection-target-requirements",children:"Azure Information Protection Target Requirements"})}),"\n",(0,s.jsx)(n.p,{children:"Microsoft\xae Azure is a cloud-based computing platform that provides a range of services, such as file storage. Azure uses Azure Information Protection (AIP) labels, a Microsoft tool used to classify and protect stored files. Access Analyzer employs the File System Solution to execute Access Auditing (FSAA) and/or Sensitive Data Discovery Auditing scans in order to find AIP Protection labels and scan protected (i.e. encrypted) files for sensitive data."}),"\n",(0,s.jsx)(n.p,{children:"This document provides information needed to properly configure access required by Access Analyzer to successfully scan for Azure Information Protection labels in a targeted environment."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"NOTE:"})," Access Analyzer does not scan for AIP Marking labels, only Protection labels."]}),"\n",(0,s.jsx)(n.h2,{id:"workflow-for-scanning-aiplabels",children:"Workflow for Scanning AIP\xa0Labels"}),"\n",(0,s.jsx)(n.p,{children:"Before the Access Analyzer File System solution can scan for Azure Information Protection (AIP) labels, certain prerequisites are required both in Access Analyzer and Azure environments."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#rights-management-service-client-installation",children:"Rights Management Service Client Installation"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#create-a-service-principal-account-using-powershell",children:"Create a Service Principal Account using PowerShell"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#enable-the-account-as-an-aip-super-user-using-powershell",children:"Enable the Account as an AIP Super User using PowerShell"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#add-user-to-the-aip-role-in-microsoft-azure",children:"Add User to the AIP Role in Microsoft\xae Azure"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#azure-information-protection-target-requirements",children:"Azure Information Protection Target Requirements"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Enable settings in FSAA Data Collector in Access Analyzer."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["See the FileSystemAccess Data Collector section in the ",(0,s.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/filesystem/overview",children:"File System Solution"})," topic for additional information"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Ensure the following prerequisites are met before configuring AIP\xa0scanning:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Microsoft Entra ID Admin credentials"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The PowerShell ",(0,s.jsx)(n.code,{children:"Install-Module"})," command requires:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PowerShell 5.0 (Run as Administrator)"}),"\n",(0,s.jsx)(n.li,{children:"Windows Server 2016and later"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Active Directory Rights Management Services Client 2.1 installed on the server where the FSAA applet or proxy is being run"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"rights-management-service-client-installation",children:"Rights Management Service Client Installation"}),"\n",(0,s.jsx)(n.p,{children:"The Rights Management Service Client must be installed on the applet servers where FSAA\xa0is running. This may be the local Access Analyzer\xa0server, a Proxy server, or a File Server running in applet mode."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"To install the Rights Management Service Client 2.1 on the server where the scan is taking place, go to the Microsoft download center:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=38396",children:"https://www.microsoft.com/en-us/download/details.aspx?id=38396"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"RECOMMENDED:"})})," Read the System Requirements and Install Instructions provided by Microsoft to complete the installation."]}),"\n",(0,s.jsx)(n.h2,{id:"create-a-service-principal-account-using-powershell",children:"Create a Service Principal Account using PowerShell"}),"\n",(0,s.jsx)(n.p,{children:"Follow the steps to create a service principal account with a symmetric key to connect to AIP:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"NOTE:"})," All PowerShell commands should be run in order through PowerShell as an Admin."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 1 \u2013"})," Open up PowerShell (Administrator)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 2 \u2013"})," Install and import MsOnline module:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Install-Module MsOnline  \nImport-Module MsOnline\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 3 \u2013"})," Connect to Azure with the ",(0,s.jsx)(n.code,{children:"Connect-MsolService"})," command. Enter the Azure credentials in the ",(0,s.jsx)(n.strong,{children:"Sign in to your account"})," window that displays from Microsoft."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 4 \u2013"})," Once successfully connected to Azure, create a service principal with the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"New-MsolServicePrincipal\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the ",(0,s.jsx)(n.strong,{children:"DisplayName"})," of the new service principal name. (For example, AIP_EnterpriseAuditor)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 5 \u2013"})," Take note and save the ",(0,s.jsx)(n.strong,{children:"Symmetric Key"})," and ",(0,s.jsx)(n.strong,{children:"AppPrincipalID"})," to be used in later steps."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"CAUTION:"})," Do not lose the symmetric key. It is not retrievable again once the PowerShell window is closed."]}),"\n",(0,s.jsx)(n.p,{children:"The service principal account with the proper key has been created."}),"\n",(0,s.jsx)(n.h2,{id:"enable-the-account-as-an-aip-super-user-using-powershell",children:"Enable the Account as an AIP Super User using PowerShell"}),"\n",(0,s.jsx)(n.p,{children:"Follow the steps to enable the Service Principal Account in AIP as a Super User:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"NOTE:"})," All PowerShell commands should be run in order through PowerShell as an Admin."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 1 \u2013"})," In PowerShell, install Microsoft Azure Active Directory Rights Manager (AIPService) module:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Install-Module AIPService  \nImport-Module AIPService\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 2 \u2013"})," Connect to Azure using the ",(0,s.jsx)(n.code,{children:"Connect-AIPService"})," command and supply Azure credentials in the ",(0,s.jsx)(n.strong,{children:"Sign in to your account"})," window that displays from Microsoft."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 3 \u2013"})," Add the service principal to the Azure AD\xa0Rights Management service super users, using the AppPrincipalID\xa0saved from the steps in the ",(0,s.jsx)(n.a,{href:"#create-a-service-principal-account-using-powershell",children:"Create a Service Principal Account using PowerShell"})," section:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Add-AipServiceSuperUser-ServicePrincipalID <AppPrincipalID>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 4 \u2013"})," Enable the DisplayName account using the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Enable-AIPServiceSuperUserFeature\n"})}),"\n",(0,s.jsx)(n.p,{children:"The Service Principal Account is now added to the Rights Management service as a Super User, and the Super User feature is enabled."}),"\n",(0,s.jsx)(n.h2,{id:"add-user-to-the-aip-role-in-microsoft-azure",children:"Add User to the AIP Role in Microsoft\xae Azure"}),"\n",(0,s.jsx)(n.p,{children:"In Microsoft Azure, add the Account to the Azure Information Protection Administrator Role."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 1 \u2013"})," Log into ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"http://portal.azure.com",children:"http://portal.azure.com"})})," with Azure credentials and select ",(0,s.jsx)(n.strong,{children:"Microsoft Entra ID"})," from the list of resources on the left-hand pane."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 2 \u2013"})," Navigate to ",(0,s.jsx)(n.strong,{children:"Roles and Administrators"}),". On the Administrative Roles page, select the ",(0,s.jsx)(n.strong,{children:"Azure Information Protection Administrator"})," role."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 3 \u2013"})," Use the ",(0,s.jsx)(n.strong,{children:"Add Assignment"})," button to display the Add assignments pane. Search for the name of the new service principal account (the ",(0,s.jsx)(n.strong,{children:"DisplayName"})," entered in PowerShell) and add it to the list of assignments."]}),"\n",(0,s.jsx)(n.p,{children:"The Service Principal Account is now successfully added to the Azure Information Protection Administrator role."}),"\n",(0,s.jsx)(n.h2,{id:"access-analyzer-configurations",children:"Access Analyzer Configurations"}),"\n",(0,s.jsx)(n.p,{children:"Before Access Analyzer can scan for AIP labels, two configurations must be done prior to the initial scan."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#azure-connection-profile",children:"Azure Connection Profile "})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#configure-fsaa-data-collector",children:"Configure FSAA Data Collector"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"azure-connection-profile",children:"Azure Connection Profile"}),"\n",(0,s.jsxs)(n.p,{children:["To collect tags for files protected with Azure Information Protection, an Azure connection profile must be configured in Access Analyzer before an FSAA scan runs. See the ",(0,s.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/settings/overview",children:"Global Settings"})," topic for additional information on how to set up a connection profile at the global level."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 1 \u2013"})," In Access Analyzer, add a credential for an Azure Active Directory account type to the existing Connection Profile used for File System scanning. Supply the Client ID field with the ",(0,s.jsx)(n.strong,{children:"AppPrincipalID"})," and the Key field with the ",(0,s.jsx)(n.strong,{children:"Symmetric key"})," created upon creation of the new service principal."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 2 \u2013"})," At the job level, apply the connection profile that contains both the Microsoft Entra ID credential and credentials required for File System scanning under the ",(0,s.jsx)(n.strong,{children:"Jobs"})," > [",(0,s.jsx)(n.strong,{children:"Job"}),"] > ",(0,s.jsx)(n.strong,{children:"Settings"})," > ",(0,s.jsx)(n.strong,{children:"Connection"})," node."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Step 3 \u2013"})," Ensure that the job is configured correctly before running a scan. See the ",(0,s.jsx)(n.a,{href:"#configure-fsaa-data-collector",children:"Configure FSAA Data Collector"})," topic for additional information."]}),"\n",(0,s.jsx)(n.p,{children:"An Azure Connection Profile has now been successfully created for an FSAA scan."}),"\n",(0,s.jsx)(n.h3,{id:"configure-fsaa-data-collector",children:"Configure FSAA Data Collector"}),"\n",(0,s.jsx)(n.p,{children:"In Access Analyzer, configure the FSAA Data Collector wizard pages to scan files protected by Azure Information Protection. This can be done for both FSAA\xa0System Scans and SEEK\xa0System Scans. In the FSAA\xa0Data Collector Wizard, configure the following menus to scan for AIP\xa0protection labels:"}),"\n",(0,s.jsx)(n.p,{children:"For FSAA\xa0System Scans:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scan Server Selection \u2013 Choose the server that scanning is executed on. Target the server that has the Rights Management Service Client 2.1 installed where the applet is running."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"This may be a proxy server, file server (applet mode), or the local Access Analyzer\xa0console depending on scan configuration"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Scan Settings \u2013 Select the ",(0,s.jsx)(n.strong,{children:"Enable scanning of files protected by Azure Information Protection"})," checkbox to add AIP files to the scan criteria"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Azure Tenant Mapping page \u2013 Add the ",(0,s.jsx)(n.strong,{children:"AppPrincipalID"})," (App ID) and the ",(0,s.jsx)(n.strong,{children:"Domain Name"})," or ",(0,s.jsx)(n.strong,{children:"Tenant ID"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Remember,"})," the Azure Tenant Mapping page is only visible when the ",(0,s.jsx)(n.strong,{children:"Enable scanning of files protected by Azure Information Protection"})," checkbox is selected on the Scan Settings page."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Default Scoping Options"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["File Details tab \u2013 ",(0,s.jsx)(n.strong,{children:"Include files protected by Azure Information Protection (AIP)"})]}),"\n",(0,s.jsxs)(n.li,{children:["File Properties (Folder Summary) \u2013 ",(0,s.jsx)(n.strong,{children:"Include AIP Protected Files"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scoping Options \u2013 if needed, scope to a specific subset of resources on a selected host"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"For SEEK\xa0System Scans:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scan Server Selection \u2013 Choose the server that scanning is executed on. Target the server that has the Rights Management Service Client 2.1 installed where the applet is running."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"This may be a proxy server, file server (applet mode), or the local Access Analyzer\xa0console depending on scan configuration"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Scan Settings \u2013 Select the ",(0,s.jsx)(n.strong,{children:"Enable scanning of files protected by Azure Information Protection"})," checkbox to add AIP files to the scan criteria"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Azure Tenant Mapping page \u2013 Add the ",(0,s.jsx)(n.strong,{children:"AppPrincipalID"})," (App ID) and the ",(0,s.jsx)(n.strong,{children:"Domain Name"})," or ",(0,s.jsx)(n.strong,{children:"Tenant ID"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Remember,"})," the Azure Tenant Mapping page is only visible when the ",(0,s.jsx)(n.strong,{children:"Enable scanning of files protected by Azure Information Protection"})," checkbox is selected on the Scan Settings page."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Scoping Options \u2013 if needed, scope to a specific subset of resources on a selected host"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Sensitive Data Settings \u2013 Select ",(0,s.jsx)(n.strong,{children:"Decrypt Files Protected by Azure Information Protection"}),". This page only applies for SEEK\xa0scans."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See the FileSystemAccess Data Collector section in the ",(0,s.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/solutions/filesystem/overview",children:"File System Solution"})," topic for additional information on these scoping options."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);