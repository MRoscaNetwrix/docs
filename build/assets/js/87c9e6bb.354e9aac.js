"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[354289],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var i=t(296540);const o={},r=i.createContext(o);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},161758:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"auditor/configuration/microsoft365/exchangeonline/manualconfig","title":"Configure Exchange Online State-in-Time Modern Authentication Manually","description":"This topic contains general requirements for Exchange Online State-in-Time and Auto Audit for mailboxes Modern Authentication, configuration steps, including the ExchangeOnlineManagement PowerShell module installation.","source":"@site/docs/auditor/auditor/configuration/microsoft365/exchangeonline/manualconfig.md","sourceDirName":"auditor/configuration/microsoft365/exchangeonline","slug":"/auditor/configuration/microsoft365/exchangeonline/manualconfig","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/manualconfig","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/auditor/auditor/configuration/microsoft365/exchangeonline/manualconfig.md","tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Assigning Application Permissions Using Manifest","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/manifest"},"next":{"title":"Access Exchange Online Using Modern Authentication","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth"}}');var o=t(474848),r=t(28453);const l={},a="Configure Exchange Online State-in-Time Modern Authentication Manually",c={},s=[{value:"Requirements for Exchange Online Modern Authentication",id:"requirements-for-exchange-online-modern-authentication",level:2},{value:"Install the ExchangeOnlineManagement PowerShell Module",id:"install-the-exchangeonlinemanagement-powershell-module",level:2},{value:"Configure Exchange Online Modern Authentication Manually",id:"configure-exchange-online-modern-authentication-manually",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"configure-exchange-online-state-in-time-modern-authentication-manually",children:"Configure Exchange Online State-in-Time Modern Authentication Manually"})}),"\n",(0,o.jsx)(n.p,{children:"This topic contains general requirements for Exchange Online State-in-Time and Auto Audit for mailboxes Modern Authentication, configuration steps, including the ExchangeOnlineManagement PowerShell module installation."}),"\n",(0,o.jsx)(n.p,{children:"Review the following:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#Requirements-for-Exchange-Online-Modern-Authentication",children:"Requirements for Exchange Online Modern Authentication"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#Install-the-ExchangeOnlineManagement-PowerShell-Module",children:"Install the ExchangeOnlineManagement PowerShell Module"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#Configure-Exchange-Online-Modern-Authentication-Manually",children:"Configure Exchange Online Modern Authentication Manually"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"requirements-for-exchange-online-modern-authentication",children:"Requirements for Exchange Online Modern Authentication"}),"\n",(0,o.jsx)(n.p,{children:"General Requirements"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Windows Management Framework for your OS: ",(0,o.jsx)(n.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=54616",children:"Windows Management Framework 5.1"})]}),"\n",(0,o.jsxs)(n.li,{children:[".NET Framework 4.7.1 and above: ",(0,o.jsx)(n.a,{href:"https://dotnet.microsoft.com/download/dotnet-framework/net471",children:"Download .NET Framework 4.7.1"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE:"}),"  If you have the FIPS option enabled you should proceed to Manual Exchange Online pre-configuration. See the ",(0,o.jsx)(n.a,{href:"#Configure-Exchange-Online-Modern-Authentication-Manually",children:"Configure Exchange Online Modern Authentication Manually"}),"section for additional information."]}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to enable Exchange Online Auto Audit for mailboxes with Modern Authentication (automatic mode)."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Install the ExchangeOnlineManagement Powershell module and dependencies (Nget package provider). Refer to the following Microsoft article for more information: ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps",children:"About the Exchange Online PowerShell V2 module"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Generate the self-signed certificate."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Install the certificate to the ",(0,o.jsx)(n.em,{children:"CurrentUser/My certificate"})," folder for the Local System account."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 4 \u2013"})," Install the certificate to the Microsoft Entra ID cloud application"]}),"\n",(0,o.jsx)(n.h2,{id:"install-the-exchangeonlinemanagement-powershell-module",children:"Install the ExchangeOnlineManagement PowerShell Module"}),"\n",(0,o.jsx)(n.p,{children:"This section will be helpful for any case below:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"You encountered errors related to the ExchangeOnlineManagement PowerShell module"}),"\n",(0,o.jsx)(n.li,{children:"You have the FIPS policy enabled"}),"\n",(0,o.jsx)(n.li,{children:"You want to install the module manually"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to install the module."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Install the Windows Management Framework for your OS: ",(0,o.jsx)(n.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=54616",children:"Windows Management Framework 5.1"})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Install ",(0,o.jsx)(n.strong,{children:"Nuget Package Provider"})," version 3.1 and above. Open ",(0,o.jsx)(n.strong,{children:"Windows PowerShell"})," and execute the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Install-PackageProvider Nuget -MinimumVersion 2.8.5.201 -Scope AllUsers\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Install the  ExchangeOnlineManagement Powershell module. Open ",(0,o.jsx)(n.strong,{children:"Windows PowerShell"})," and execute the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Install-Module ExchangeOnlineManagement\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Review the following Microsoft technical article for more information: ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps",children:"About the Exchange Online PowerShell V2 module"})]}),"\n",(0,o.jsxs)(n.p,{children:["See next: ",(0,o.jsx)(n.a,{href:"#Configure-Exchange-Online-Modern-Authentication-Manually",children:"Configure Exchange Online Modern Authentication Manually"})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE:"})," If you encountered errors executing the ",(0,o.jsx)(n.code,{children:"Install-PackageProvider"})," cmdlet try to force PowerShell into TLS 1.2 mode and try again:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[System.Net.ServicePointManager]:SecurityProtocol = [System.Net.SecurityProtocolType] 'Ssl3 , Tls12'\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE:"})," If you getting ",(0,o.jsx)(n.em,{children:'"No match was found for the specified search criteria..."'})," message on the ",(0,o.jsx)(n.code,{children:"Install-Module ExchangeOnlineManagement"})," execution, try to register default repository:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Register-PSRepository -Default\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configure-exchange-online-modern-authentication-manually",children:"Configure Exchange Online Modern Authentication Manually"}),"\n",(0,o.jsx)(n.p,{children:"If you encountered errors from Netwrix Auditor during the automatic configuration of the certificate, complete the following steps."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," In Netwrix Auditor, find your Exchange Online monitoring plan."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Click Update to force data collection."]}),"\n",(0,o.jsx)(n.p,{children:"If the error still persists, or you want to pre-configure the work with certificate, follow the instructions below:"}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to install a certificate."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Get your certificate or generate a self-signed certificate. The name must be ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"Netwrix_Auditor_MFA_<your_tenant_name>"})})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Save the certificate to the ",(0,o.jsx)(n.em,{children:"CurrentUser/My certificate"})," folder for the Local System account."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Upload the certificate to the application selected in your monitoring plan or configure it automatically with Netwrix Auditor."]}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to generate a self-signed certificate."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Open Windows PowerShell as an Administrator and run the following commands:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# Create certificate  \n$mycert = New-SelfSignedCertificate -DnsName "example.com" -CertStoreLocation "cert:\\LocalMachine\\My" -NotAfter (Get-Date).AddYears(1) -KeySpec KeyExchange  \n# Export certificate to .pfx file  \n$mycert | Export-PfxCertificate -FilePath mycert.pfx -Password $(ConvertTo-SecureString -String "your_password" -Force -AsPlainText)  \n# Export certificate to .cer file  \n$mycert | Export-Certificate -FilePath mycert.cer\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Replace the ",(0,o.jsx)(n.code,{children:"DnsName "}),"parameter value with your certificate name (",(0,o.jsx)(n.code,{children:"Netwrix_Auditor_MFA_<your_tenant_name>"}),")."]}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to install the certificate to the CurrentUser/My certificate folder."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Download ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/sysinternals/downloads/psexec",children:"PsExec"})," to run Windows PowerShell session under the LocalSystem account;"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Run Windows PowerShell as an Administrator, navigate to to PsExec.exe installation directory (use the 'CD' command), if necessary, and run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:".\\PsExec.exe -i -s powershell.exe\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Verify that you are logged in as a Local System account. Run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"whoami\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 4 \u2013"})," Import the certificate. Run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Import-PfxCertificate -FilePath <path to your certificate> -CertStoreLocation\xa0  \n'Cert:\\CurrentUser\\My' -Password (ConvertTo-SecureString -String \"your_password\" -AsPlainText -Force)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Where ",(0,o.jsx)(n.code,{children:"path_to_certificate"})," is the full path to the certificate file."]}),"\n",(0,o.jsx)(n.p,{children:"You can also install the certificate with the '.cer' extension to the Microsoft Entra ID Portal or Netwrix Auditor will set it automatically during establishing a PowerShell connection with Exchange Online."})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);