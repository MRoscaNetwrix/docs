"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[812879],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var t=o(296540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},375394:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"policypak/troubleshooting/clientsideextension/syspreperror","title":"SYSPREP Error with Endpoint Policy Manager Client-Side Extension","description":"When updating the gold .wim file used for OS imaging, you may encounter the following error when attempting to SYSPREP a system with the Endpoint Policy Manager CSE 24.2.3799 or later installed.","source":"@site/docs/policypak/policypak/troubleshooting/clientsideextension/syspreperror.md","sourceDirName":"policypak/troubleshooting/clientsideextension","slug":"/policypak/troubleshooting/clientsideextension/syspreperror","permalink":"/docs/policypak/policypak/troubleshooting/clientsideextension/syspreperror","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/policypak/policypak/troubleshooting/clientsideextension/syspreperror.md","tags":[],"version":"current","frontMatter":{},"sidebar":"policyPakSidebar","previous":{"title":"How to Rollback CSE version from newer to older using PowerShell","permalink":"/docs/policypak/policypak/troubleshooting/clientsideextension/rollback"},"next":{"title":"Set and Manage the Uninstallation Password for Endpoint Policy Manager Client-Side Extension","permalink":"/docs/policypak/policypak/troubleshooting/clientsideextension/uninstallpassword"}}');var r=o(474848),i=o(28453);const s={},a="SYSPREP Error with Endpoint Policy Manager Client-Side Extension",l={},p=[];function c(e){const n={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sysprep-error-with-endpoint-policy-manager-client-side-extension",children:"SYSPREP Error with Endpoint Policy Manager Client-Side Extension"})}),"\n",(0,r.jsx)(n.p,{children:"When updating the gold .wim file used for OS imaging, you may encounter the following error when attempting to SYSPREP a system with the Endpoint Policy Manager CSE 24.2.3799 or later installed."}),"\n",(0,r.jsx)(n.p,{children:"Problem:"}),"\n",(0,r.jsx)(n.p,{children:"The SYSPREP output may display an error similar to the following:\nExpected image state is IMAGE_STATE_GENERALIZE_RESEAL_TO_OOBE.\nActual image state is IMAGE_STATE_Complete."}),"\n",(0,r.jsx)(n.p,{children:"In setupcat.log you\u2019ll find the following error:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"javascript:void(0);",children:"Copy"})}),"\n",(0,r.jsx)(n.p,{children:"setupcat.log error"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Info SYSPRP Entering SysprepGeneralizeValidate (Appx) - validating whether all apps are also provisioned.  \nError SYSPRP Package PPLPMSparsePackage_1.0.0.0_neutral__gd0ndz5rvp7t0 was installed for a user, but not  \nprovisioned for all users. This package will not function properly in the sysprep image.  \nError SYSPRP Failed to remove apps for the current user: 0x80073cf2.  \nError SYSPRP Exit code of RemoveAllApps thread was 0x3cf2.\xa0  \n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cause:"}),"\n",(0,r.jsx)(n.p,{children:"PPLPMSparsePackage_1.0.0.0_neutral__gd0ndz5rvp7t0 is a UWP appx package recently added to support the Windows 11 context menu. However, it cannot be provisioned due to SYSPREP demands. If this package is absent, the Windows 11 modern menu will not contain Endpoint Policy Manager commands. However, the classic context menu works as expected."}),"\n",(0,r.jsx)(n.p,{children:"Resolution:"}),"\n",(0,r.jsx)(n.p,{children:"To fix the error please remove the LPM appx package prior to SYSPREP with the following PowerShell command:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"javascript:void(0);",children:"Copy"})}),"\n",(0,r.jsx)(n.p,{children:"Remove LPM appx package"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Get-appxpackage *pplpm* | remove-appxpackage\n"})}),"\n",(0,r.jsx)(n.p,{children:"At the first logon, Windows 11 will not have Endpoint Policy Manager menus, but they should appear at the second login."}),"\n",(0,r.jsxs)(n.p,{children:["See the Microsoft article ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/troubleshoot/windows-client/installing-updates-features-roles/sysprep-fails-remove-or-update-store-apps",children:"Sysprep fails remove or update store apps"})," for more information."]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);