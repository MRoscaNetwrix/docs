"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[772657],{28453:(e,s,r)=>{r.d(s,{R:()=>t,x:()=>c});var n=r(296540);const o={},i=n.createContext(o);function t(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),n.createElement(i.Provider,{value:s},e.children)}},470069:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"config/netappcmode/access","title":"NetApp Data ONTAP Cluster-Mode Access & Sensitive Data Auditing Configuration","description":"This topic provides instructions for configuring NetApp Data ONTAP Cluster-Mode devices.","source":"@site/docs/accessanalyzer/config/netappcmode/access.md","sourceDirName":"config/netappcmode","slug":"/config/netappcmode/access","permalink":"/docs/accessanalyzer/config/netappcmode/access","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/config/netappcmode/access.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"Provision FPolicy Account","permalink":"/docs/accessanalyzer/config/netapp7mode/provisionactivity"},"next":{"title":"NetApp Data ONTAP Cluster-Mode Activity Auditing Configuration","permalink":"/docs/accessanalyzer/config/netappcmode/activity"}}');var o=r(474848),i=r(28453);const t={},c="NetApp Data ONTAP Cluster-Mode Access & Sensitive Data Auditing Configuration",a={},l=[{value:"CIFS Method 1 Credential Configuration",id:"cifs-method-1-credential-configuration",level:2},{value:"Configure Data LIF\xa0to Allow HTTPS\xa0Traffic",id:"configure-data-lifto-allow-httpstraffic",level:3},{value:"CIFS Method 2 Credential Configuration",id:"cifs-method-2-credential-configuration",level:2},{value:"NFSv3 Credential Configuration",id:"nfsv3-credential-configuration",level:2},{value:"Troubleshooting NFSv3 Export Access",id:"troubleshooting-nfsv3-export-access",level:3}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"netapp-data-ontap-cluster-mode-access--sensitive-data-auditing-configuration",children:"NetApp Data ONTAP Cluster-Mode Access & Sensitive Data Auditing Configuration"})}),"\n",(0,o.jsx)(s.p,{children:"This topic provides instructions for configuring NetApp Data ONTAP Cluster-Mode devices."}),"\n",(0,o.jsx)(s.h2,{id:"cifs-method-1-credential-configuration",children:"CIFS Method 1 Credential Configuration"}),"\n",(0,o.jsx)(s.p,{children:"Configuring access to CIFS\xa0shares using FPolicy and ONTAP\xa0API\xa0for Access Analyzer requires the following:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Configure Data LIF\xa0to Allow HTTPS\xa0Traffic"}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"/docs/accessanalyzer/config/netappcmode/configureemptyfpolicy",children:"Configure Empty FPolicy"})}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["See the ",(0,o.jsx)(s.a,{href:"#cifs-method-2-credential-configuration",children:"CIFS Method 2 Credential Configuration"})," topic for an alternative method."]}),"\n",(0,o.jsx)(s.h3,{id:"configure-data-lifto-allow-httpstraffic",children:"Configure Data LIF\xa0to Allow HTTPS\xa0Traffic"}),"\n",(0,o.jsx)(s.p,{children:"As of NetApp Clustered ONTAP 9.6, users can assign service policies (instead of LIF roles) to LIFs that determine the kind of traffic that is supported for the LIFs."}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Starting with ONTAP 9.5, ONTAP supports service policies"}),"\n",(0,o.jsx)(s.li,{children:"Starting with ONTAP 9.6, LIF roles are deprecated and service policies are supported for all types of services"}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["For users running ONTAP 9.6+, data LIFs used for HTTPS communication with Access Analyzer are required to use a LIF service policy that includes the ",(0,o.jsx)(s.code,{children:"management-https"})," service. Without this service applied to a data LIF\u2019s service policy, HTTPS communication will not be possible."]}),"\n",(0,o.jsx)(s.p,{children:"The following examples offer guidance for managing service policies, but may vary depending on the NetApp environment\u2019s specific configuration and needs."}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to display available services:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface service show\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to create a service policy (example includes NFS, CIFS, and HTTPS traffic):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface service-policy create -vserver [SVM_NAME] -policy [SERVICE_POLICY_NAME] -services [LIST_OF_SERVICES_COMMA-SEPARARTED] -allowed-addresses [IP_CIDR_NOTATION]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example with the NFS, CIFS, and HTTPS protocols being allowed:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface service-policy create -vserver testserver -policy new_service_policy -services data-nfx,data-cifs,management-https,data-core -allowed-addresses 0.0.0.0/0\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to verify if the service policy was properly created:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface service-policy show\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to add the created service policy to an existing data LIF:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface modify -vserver [SVM_NAME] -lif [LIF_NAME] -service-policy [SERVICE_POLICY_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"network interface modify -vserver testserver -lif lif_1 -service-policy new_service_policy\n"})}),"\n",(0,o.jsx)(s.p,{children:"A service policy can only be used by LIFs in the same SVM that is specified when creating the service policy."}),"\n",(0,o.jsx)(s.h2,{id:"cifs-method-2-credential-configuration",children:"CIFS Method 2 Credential Configuration"}),"\n",(0,o.jsxs)(s.p,{children:["Configuring access to CIFS shares using the special C$ share is an alternative least privileged access option for NetApp Data ONTAP Cluster-Mode devices v9.0+. See the ",(0,o.jsx)(s.a,{href:"#cifs-method-1-credential-configuration",children:"CIFS Method 1 Credential Configuration"})," topic for an alternative method."]}),"\n",(0,o.jsx)(s.p,{children:"The following permissions are required:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Group membership in the Backup Operators group on either the file system proxy server for Proxy Mode scans or the Access Analyzer server for Local Mode scans (to get a high integrity token)"}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Group membership in the NetApp SVM's Power Users group (to enumerate shares)"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Use the following command to add the Service Account to BUILTIN\\Power Users:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:'cifs users-and-groups local-group add-members \u2011group-name "BUILTIN\\Power Users" \u2011member-names [DOMAIN_USER] \u2011vserver [SVM_NAME]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Group membership in the NetApp SVM's Backup Operators group (to bypass NTFS permissions)"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"NetApp SVM's SeBackupPrivilege needs to be applied to this group"}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"This group must have read-only access to the SVM's C$ share"}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Use the following command to add the Service Account to BUILTIN\\Backup Operators:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:'cifs users-and-groups local-group add-members \u2011group-name "BUILTIN\\Backup Operators" \u2011member-names [DOMAIN_USER] \u2011vserver [SVM_NAME]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"If an ACE does not already exist for a specific user/group on an SVM's c$ share, then it needs to be added with the desired rights (No_access, Read, Change, or Full_Control). To check the current ACE for a user or group on each SVM's c$ share, the following ONTAP CLI command should be used at the cluster management level."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver cifs share access-control show -share c$\n"})}),"\n",(0,o.jsx)(s.p,{children:"The output will list each SVM's ACL for its c$ share. For example:"}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{alt:"ONTAP CLI Command Output Example",src:r(890628).A+"",width:"824",height:"143"})}),"\n",(0,o.jsx)(s.p,{children:"If the desired ACE does not exist on an SVM's c$ share, then one can be created with the following command:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver cifs share access-control create -share c$ -user-or-group [USER_OR_GROUP_NAME] -permission Read -vserver [SVM_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"If an existing ACE needs to be modified, the following command should be used:"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"CAUTION:"})," The following command will overwrite an existing ACE. For example, it is possible to downgrade a user with Full_Control to Read, or vice versa."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver cifs share access-control modify -share c$ -user-or-group [USER_OR_GROUP_NAME] -permission Read -vserver [SVM_NAME]\n"})}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"NOTE:"})," If users would prefer to avoid permissioning C$, then there is an alternative. Users can instead give the SVM's Backup Operators group read-only access to each share to be scanned."]}),"\n",(0,o.jsx)(s.p,{children:"In order to utilize Access Analyzer\u2019s LAT Preservation (Last Access Time) feature during sensitive data scans and metadata tag collection, applying ONTAP\u2019s SeRestorePrivilege to the service account is also required."}),"\n",(0,o.jsx)(s.p,{children:"As an alternative to membership in BUILTIN\\Backup Operators, SeBackupPrivilege can be directly applied to a user via the NetApp command line."}),"\n",(0,o.jsx)(s.p,{children:"The following commands can be used to grant these permissions to the service account to be used for scanning by Access Analyzer."}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to add SeBackupPrivilege to the Service Account (or a BUILTIN Group):"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"cifs users-and-groups privilege add-privilege \u2011user-or-group-name [USER_OR_GROUP_NAME] \u2011privileges SeBackupPrivilege \u2011vserver [SVM_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to add the Service Account to BUILTIN\\Power Users:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:'cifs users-and-groups local-group add-members \u2011group-name "BUILTIN\\Power Users" \u2011member-names [DOMAIN_USER] \u2011vserver [SVM_NAME]\n'})}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to add the Service Account to BUILTIN\\Backup Operators:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:'cifs users-and-groups local-group add-members \u2011group-name "BUILTIN\\Backup Operators" \u2011member-names [DOMAIN_USER] \u2011vserver [SVM_NAME]\n'})}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to verify the results from the previous commands:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"cifs users-and-groups privilege show \u2011vserver [SVM_NAME] \u2011user-or-group-name [USER_OR_GROUP_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to give the Service Account Read-only Access to NetApp SVM's c$ Share:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"cifs share access-control create \u2011vserver [SVM_NAME] \u2011share c$ \u2011user-or-group [USER_OR_GROUP_NAME] \u2011permission Read\n"})}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"NOTE:"}),' In the previous command, "create" needs to be replaced with "modify" if the CIFS share ACE already exists for the share/user combination.']}),"\n",(0,o.jsx)(s.p,{children:"Use the following commands to verify the results from the previous command:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"cifs share access-control show \u2011vserver [SVM_NAME] \u2011share c$\n"})}),"\n",(0,o.jsx)(s.h2,{id:"nfsv3-credential-configuration",children:"NFSv3 Credential Configuration"}),"\n",(0,o.jsx)(s.p,{children:"The following is a list of example commands that can be used to configure a NetApp export policy to scan a volume via NFSv3 using the Access Analyzer File System Solution."}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"CAUTION:"})," The export policy for a volume's parent (ex. the SVM's root volume), or the export policy for a qtree's parent, must have access rights that are equal or wider in scope to the export policy for the target volume/qtree. If Access Analyzer cannot access all segments of a target volume/qtree's junction path, then NFS access will be denied."]}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to create an export policy:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver export-policy create \u2011vserver [SVM_NAME] \u2011policyname [EXPORT_POLICY_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver export-policy create \u2011vserver testserver \u2011policyname testNFS\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to add a rule to the previous export policy, using the nfsv3, auth_sys (aka auth_unix), and superuser properties:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver export-policy rule create \u2011vserver [SVM_NAME] \u2011policyname [EXPORT_POLICY_NAME] \u2011clientmatch [IP_CIDR_NOTATION] \u2011rorule sys \u2011rwrule sys \u2011superuser sys -protocol nfs3\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver export-policy rule create \u2011vserver testserver \u2011policyname testNFS \u2011clientmatch 0.0.0.0/0 \u2011rorule sys \u2011rwrule sys \u2011superuser sys -protocol nfs3\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to show each volume\u2019s export policy:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"volume show \u2011vserver [SVM_NAME] \u2011fields policy\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"volume show \u2011vserver testserver \u2011fields policy\n"})}),"\n",(0,o.jsx)(s.p,{children:"Use the following command to change a volume\u2019s export policy:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"volume modify \u2011vserver [SVM_NAME] \u2011volume [VOLUME_NAME] \u2011policy [EXPORT_POLICY_NAME]\n"})}),"\n",(0,o.jsx)(s.p,{children:"Example:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"volume modify \u2011vserver testserver \u2011volume testVolume \u2011policy testNFS\n"})}),"\n",(0,o.jsx)(s.h3,{id:"troubleshooting-nfsv3-export-access",children:"Troubleshooting NFSv3 Export Access"}),"\n",(0,o.jsx)(s.p,{children:"If Access Analyzeris not discovering the expected NFS export, it is possible that the export policy is not properly configured to allow the Access Analyzer server or proxy server IP Address to mount the NFS export. One step in troubleshooting this issue is to confirm a Unix client (or WSL for Windows) in the same IP range as the Access Analyzer server or proxy server can mount the NFS export."}),"\n",(0,o.jsx)(s.p,{children:"Run the following command from a Unix host to verify the NFS mount is available:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"showmount \u2011e [NFS_HOSTNAME_OR_IP]\n"})}),"\n",(0,o.jsxs)(s.p,{children:["If the NFS export is returned as a result of the previous command, then Access Analyzer should also be able to mount it. If not, it may be necessary to run the following command on the NetApp SVM to get the NFS export to be returned by the ",(0,o.jsx)(s.code,{children:"showmount"})," command:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"vserver nfs modify \u2011vserver [SVM_NAME] \u2011showmount enabled\n"})})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},890628:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/accesscifsmethod2-891e72e8005ea2c8153343f0036b88d8.webp"}}]);