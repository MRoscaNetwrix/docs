"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[408197],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var t=o(296540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},516737:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"usercube/integration-guide/network-configuration/proxy/index","title":"Proxy Server","description":"Identity Manager\xa0server or agent can be configured to go through a proxy server to access internal or external web resources.","source":"@site/docs/usercube/usercube/integration-guide/network-configuration/proxy/index.md","sourceDirName":"usercube/integration-guide/network-configuration/proxy","slug":"/usercube/integration-guide/network-configuration/proxy/","permalink":"/docs/usercube/usercube/integration-guide/network-configuration/proxy/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/usercube/usercube/integration-guide/network-configuration/proxy/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"userCubeSidebar","previous":{"title":"Password Management","permalink":"/docs/usercube/usercube/integration-guide/network-configuration/password-management/"},"next":{"title":"Server Configuration","permalink":"/docs/usercube/usercube/integration-guide/network-configuration/server-configuration/"}}');var r=o(474848),i=o(28453);const s={},l="Proxy Server",a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Proxy Related Environment Variables",id:"proxy-related-environment-variables",level:2},{value:"HTTPS_PROXY",id:"https_proxy",level:3},{value:"Do not do",id:"do-not-do",level:4},{value:"Authenticated proxy",id:"authenticated-proxy",level:4},{value:"NO_PROXY",id:"no_proxy",level:3},{value:"Do not do",id:"do-not-do-1",level:4},{value:"Where to Define Proxy Environment Variables",id:"where-to-define-proxy-environment-variables",level:2},{value:"Testing the Proxy Configuration",id:"testing-the-proxy-configuration",level:2},{value:"Using Powershell 5",id:"using-powershell-5",level:3},{value:"Using Powershell Core",id:"using-powershell-core",level:3},{value:"Known errors when proxy is not properly configured",id:"known-errors-when-proxy-is-not-properly-configured",level:3},{value:"Reference Documentation",id:"reference-documentation",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"proxy-server",children:"Proxy Server"})}),"\n",(0,r.jsx)(n.p,{children:"Identity Manager\xa0server or agent can be configured to go through a proxy server to access internal or external web resources."}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"A Identity Manager agent often needs to access internal or external systems using the HTTP protocol. It may easily be configured to use a proxy server through which all or part of the HTTP traffic will be routed."}),"\n",(0,r.jsx)(n.h2,{id:"proxy-related-environment-variables",children:"Proxy Related Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"The proxy configuration is based on a set of standard dotnet environment variables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HTTPS_PROXY"}),": the proxy server used on HTTPS requests."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"NO_PROXY"}),": a comma-separated list of hostnames that should be excluded from proxying."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The dotnet environment does not rely on the OS-wide proxy configuration.\nIt is mandatory to use the above-mentioned environment variables to configure the proxy."}),"\n",(0,r.jsx)(n.h3,{id:"https_proxy",children:"HTTPS_PROXY"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable may be the hostname or IP address, optionally followed by a colon and port number, or it may be an http URL, optionally including a username and password for ",(0,r.jsx)(n.a,{href:"#Proxy-Server",children:"\nProxy Server\n"}),"authentication."]}),"\n",(0,r.jsxs)(n.p,{children:["The URL must start with ",(0,r.jsx)(n.code,{children:"http"}),", ",(0,r.jsx)(n.strong,{children:"not https"}),", and cannot include any text after the hostname, IP, or port."]}),"\n",(0,r.jsx)(n.p,{children:"This example shows various ways to properly configure a proxy server using Powershell:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n# A hostname with port (recommended syntax)\n$env:HTTPS_PROXY="proxy.contoso.com:6060"\n# A hostname without port\n$env:HTTPS_PROXY="proxy.contoso.com"\n# An IP address with port\n$env:HTTPS_PROXY="10.65.1.1:6060"\n# A URL with port:\n# Warning: Even if we want to route HTTPS traffic, we MUST give a URL with http scheme.\n# Warning: Do not add trailing slash.\n$env:HTTPS_PROXY="http://proxy.contoso.com:6060"\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["We recommend using the ",(0,r.jsx)(n.code,{children:"<hostname>:<port>"})," syntax since it is not misleading.\nWe discourage using the ",(0,r.jsx)(n.code,{children:"http://<hostname>:<port>"})," syntax since it is not intuitive to indicate the ",(0,r.jsx)(n.code,{children:"http"})," scheme to route ",(0,r.jsx)(n.code,{children:"https"})," traffic.\nHowever, if you decide to use this syntax, do not forget to include a comment stating that ",(0,r.jsx)(n.code,{children:"http"})," scheme is mandatory at the configuration level, even if it will not be used at runtime."]}),"\n",(0,r.jsx)(n.h4,{id:"do-not-do",children:"Do not do"}),"\n",(0,r.jsxs)(n.p,{children:["This example shows the wrong ways to initialize the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable.\nThe environment variable will be ",(0,r.jsx)(n.strong,{children:"silently ignored"})," and the traffic will not be routed through the proxy."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n# WRONG: A URL with https scheme\n$env:HTTPS_PROXY="https://proxy.contoso.com:6060"\n# WRONG: A URL with text after the port number\n$env:HTTPS_PROXY="http://proxy.contoso.com:6060/"\n# WRONG: A URL with text after the hostname\n$env:HTTPS_PROXY="http://proxy.contoso.com/"\n\n'})}),"\n",(0,r.jsx)(n.h4,{id:"authenticated-proxy",children:"Authenticated proxy"}),"\n",(0,r.jsxs)(n.p,{children:["When the proxy server needs the user to be authenticated, the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable can include the username and password as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n# A URL to authenticate to the proxy with login=mylogin and password=mypassword\n$env:HTTPS_PROXY="http://mylogin:mypassword@proxy.contoso.com:6060"\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"no_proxy",children:"NO_PROXY"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"NO_PROXY"}),' environment variable is a comma-separated list of hostnames that should be excluded from proxying.\nTo exclude all subdomains ("wildcard" exclusion), domains in the ',(0,r.jsx)(n.code,{children:"NO_PROXY"})," list need to be prefixed with a dot (",(0,r.jsx)(n.code,{children:"."}),"), which is standard, but not particularly well documented. ",(0,r.jsxs)(n.strong,{children:["Do not use the star (",(0,r.jsx)(n.code,{children:"*"}),") prefix !!!"]})]}),"\n",(0,r.jsx)(n.p,{children:"This example shows various ways to exclude domains from proxying:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n# Exclude only www.google.com:\n# www.google.com: will not go through the proxy\n# maps.google.com: will go through the proxy\n$env:NO_PROXY="www.google.com"\n# Exclude only www.google.com and www.microsoft.com:\n$env:NO_PROXY="www.google.com,www.microsoft.com"\n# Exclude all google.com and all microsoft.com subdomains:\n# Do not prepend the domain name with a \'*\'\n# www.google.com: will not go through the proxy\n# maps.google.com: will not go through the proxy\n# www.microsoft.com: will not go through the proxy\n$env:NO_PROXY=".google.com,.microsoft.com"\n\n'})}),"\n",(0,r.jsx)(n.h4,{id:"do-not-do-1",children:"Do not do"}),"\n",(0,r.jsxs)(n.p,{children:["This example shows the wrong ways to initialize the ",(0,r.jsx)(n.code,{children:"NO_PROXY"})," environment variable."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\n# WRONG: starting with '*' to indicate a wildcard exclusion\n# Only the domain exactly named *.contoso.com will be excluded from proxying,\n# which means there is no exclusion configured.\n$env:NO_PROXY=\"*.contoso.com\"\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"where-to-define-proxy-environment-variables",children:"Where to Define Proxy Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"The proxy configuration is based on a set of standard dotnet environment variables, they can be defined in various places according to the practices in place in your organization:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"At OS level"}),"\n",(0,r.jsx)(n.li,{children:"At user level: for the user running the Identity Manager server or agent"}),"\n",(0,r.jsxs)(n.li,{children:["At IIS level: in the application ",(0,r.jsx)(n.code,{children:"web.config"})," file"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Note that when creating an environment variable in IIS ",(0,r.jsx)(n.code,{children:"web.config"})," file, all child processes created by the IIS application will inherit from this environment variables.\nFor example, while running the Identity Manager\xa0agent all tasks started by the agent will inherit the proxy environment variables."]}),"\n",(0,r.jsxs)(n.p,{children:["This example shows how to configure the proxy in the IIS ",(0,r.jsx)(n.code,{children:"web.config"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n<configuration>  <system.webServer>    <aspNetCore processPath="dotnet" arguments="./Usercube-Server.dll" stdoutLogEnabled="false" stdoutLogFile="../Temp/stdout-server.log" hostingModel="inprocess">      <environmentVariables>\n        <environmentVariable name="HTTPS_PROXY" value="proxy.contoso.com:6060"/>        <environmentVariable name="NO_PROXY" value=".google.com"/>\n      </environmentVariables>...\n    </aspNetCore>  </system.webServer></configuration>\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"testing-the-proxy-configuration",children:"Testing the Proxy Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To test the proxy configuration for the dotnet environment, it is advised to use Powershell 5 or Powershell Core."}),"\n",(0,r.jsx)(n.p,{children:"In the following examples, you may adapt the proxy hostname/port and the URL to test."}),"\n",(0,r.jsx)(n.h3,{id:"using-powershell-5",children:"Using Powershell 5"}),"\n",(0,r.jsxs)(n.p,{children:["To test that a Identity Manager agent using a proxy server can reach the Identity Manager server:\nGo to the ",(0,r.jsx)(n.code,{children:"<USERCUBE_HOME>/Runtime"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n$env:HTTPS_PROXY="proxy.contoso.com"\n./Usercube-Invoke-Job.exe --api-url https://contoso.usercube.com/ --api-client-id Job --api-secret secret -j UnknownJob\n\n# Given the credentials are valid, you should get an exception as follows:\n# ---\x3e System.Exception: Job: UnknownJob is not found\n# This exception shows that the server has been reached and that the job identifier is not known.\n# The proxy is properly configured !!!\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Do not use"})," Invoke-WebRequest or Test-NetConnection to test the proxy configuration.\nIn Powershell 5, these tools are using a different network stack from dotnet environment and are using the OS-wide proxy settings.\nThey will ignore the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable"]}),"\n",(0,r.jsx)(n.h3,{id:"using-powershell-core",children:"Using Powershell Core"}),"\n",(0,r.jsx)(n.p,{children:"Powershell Core is based on the same network stack as dotnet environment. The proxy configuration can be tested using the Invoke-WebRequest and Test-NetConnection tools. If tests are successful using Invoke-WebRequest, they will be successful too if the same environment variables are provided to the Identity Manager server or agent."}),"\n",(0,r.jsxs)(n.p,{children:["Powershell Core will only take the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable into account if it was created before the Powershell Core process was started."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\n# Create the environment variable in this Powershell Core process.\n# This variable will not alter the proxy configuration of this process.\n$env:HTTPS_PROXY="proxy.contoso.com"\n# Start a child Powershell Core process which will inherit from the HTTPS_PROXY environment variable.\n# This variable will alter the proxy configuration of this child process.\npwsh\nInvoke-WebRequest https://contoso.usercube.com/\n# The result should display an HTTP 200 response from the Usercube server.\n\n# Go back to the parent Powershell parent process.\nexit\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"known-errors-when-proxy-is-not-properly-configured",children:"Known errors when proxy is not properly configured"}),"\n",(0,r.jsxs)(n.p,{children:["When the proxy environment variables does not match the expected format, they will be ",(0,r.jsx)(n.strong,{children:"silently"})," ignored."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," is ignored, the network stack will try to directly access public URL's without going through the proxy."]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"NO_PROXY"})," is ignored, the internal traffic will be routed through the proxy."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"When testing the proxy configuration, if you get one of the following error message:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:" No such host is known."})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"H\ufffdte inconnu"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["It means that the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," is not set or does not match the expected format. The HTTP client tries to directly resolve the public hostname instead of resolving the proxy hostname."]}),"\n",(0,r.jsxs)(n.p,{children:["Review the ",(0,r.jsx)(n.code,{children:"HTTPS_PROXY"})," value, check that it does not:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["use the ",(0,r.jsx)(n.code,{children:"https"})," scheme"]}),"\n",(0,r.jsxs)(n.li,{children:["include trailing slashes or characters after the hostname",":port"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reference-documentation",children:"Reference Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.net.http.httpclient.defaultproxy?view=net-8.0&viewFallbackFrom=netcore-8.0#httpclientdefaultproxy",children:"HttpClient.DefaultProxy"}),": reference for environment variables."]}),"\n",(0,r.jsxs)(n.li,{children:["NO_PROXY: ",(0,r.jsx)(n.a,{href:"https://stackoverflow.com/a/62663469",children:"unofficial documentation"})," for wildcard domain exclusion"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);