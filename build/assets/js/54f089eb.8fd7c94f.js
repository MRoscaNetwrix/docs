"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[316746],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(296540);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},690211:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"enterpriseauditor/requirements/solutions/entraid/entraroles","title":"Microsoft Entra Roles Auditing Configuration","description":"Access Analyzer can scan for Microsoft Entra roles information. It scans:","source":"@site/docs/accessanalyzer/enterpriseauditor/requirements/solutions/entraid/entraroles.md","sourceDirName":"enterpriseauditor/requirements/solutions/entraid","slug":"/enterpriseauditor/requirements/solutions/entraid/entraroles","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/solutions/entraid/entraroles","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/enterpriseauditor/requirements/solutions/entraid/entraroles.md","tags":[],"version":"current","frontMatter":{},"sidebar":"accessAnalyzerSidebar","previous":{"title":"Dropbox Solution","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/solutions/dropbox"},"next":{"title":"Entra ID Solution","permalink":"/docs/accessanalyzer/enterpriseauditor/requirements/solutions/entraid"}}');var t=s(474848),i=s(28453);const o={},a="Microsoft Entra Roles Auditing Configuration",c={},l=[{value:"Permissions",id:"permissions",level:2},{value:"Microsoft Entra ID Registered Application",id:"microsoft-entra-id-registered-application",level:2},{value:"Grant Permissions to the Registered Application",id:"grant-permissions-to-the-registered-application",level:2},{value:"Create Custom Role with Resource Manager Permissions",id:"create-custom-role-with-resource-manager-permissions",level:2},{value:"Assign the Custom Role to the App Registration",id:"assign-the-custom-role-to-the-app-registration",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"microsoft-entra-roles-auditing-configuration",children:"Microsoft Entra Roles Auditing Configuration"})}),"\n",(0,t.jsx)(n.p,{children:"Access Analyzer can scan for Microsoft Entra roles information. It scans:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Microsoft Entra ID (formerly Azure AD)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," A user account with the Global Administrator role is required to register an app with Microsoft Entra ID."]}),"\n",(0,t.jsx)(n.p,{children:"Data Collector"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/datacollector/entra/overview",children:"Entra Data Collector"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configuration Settings from the Registered Application"}),"\n",(0,t.jsx)(n.p,{children:"The following settings are needed from your tenant once you have registered the application:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Client ID \u2013 This is the Application (client) ID for the registered application"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Key \u2013 This is the Client Secret Value generated when a new secret is created"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"CAUTION:"})," It is not possible to retrieve the value after saving the new key. It must be copied first."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," It is recommended to use the same registered application for the Access and Entra roles auditing configurations. In this case, these values are only needed once for the tenant. See the ",(0,t.jsx)(n.a,{href:"#microsoft-entra-id-registered-application",children:"Microsoft Entra ID Registered Application"})," topic\xa0for additional information."]}),"\n",(0,t.jsx)(n.h2,{id:"permissions",children:"Permissions"}),"\n",(0,t.jsx)(n.p,{children:"The following permissions are required for Microsoft Entra Roles auditing:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Microsoft Graph API Application permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RoleManagement.Read.Directory"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Resource Manager permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/roleAssignments/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/roleDefinitions/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/resources/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/resources/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/resourceGroups/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/providerOperations/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Management/managementGroups/read"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"microsoft-entra-id-registered-application",children:"Microsoft Entra ID Registered Application"}),"\n",(0,t.jsxs)(n.p,{children:["You must have a registered application to assign the required permissions to. It is recommended to use the same registered application that is used for access auditing using the AzureADInventory data collector. See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/config/entraid/access#register-a-microsoft-entra-id-application",children:"Register a Microsoft Entra ID Application"})," topic for additional information on registering an application."]}),"\n",(0,t.jsxs)(n.p,{children:["The Client ID\xa0and Key for the registered application are required for the Access Analyzer connection profile. If, as recommended, you are using a single registered application for the tenant, then you do not need to add an additional user credential in the connection profile. If you create a separate registered application for Entra roles auditing, then the Client ID\xa0and Key for this must be added to the connection profile as an additional Azure Active Directory user credential. See the ",(0,t.jsx)(n.a,{href:"/docs/accessanalyzer/enterpriseauditor/admin/datacollector/azureadinventory/configurejob",children:"Microsoft Entra ID Connection Profile & Host List"})," topic for additional information."]}),"\n",(0,t.jsx)(n.p,{children:"Once you have the registered application, the next step is to grant it the required permissions for the Entra data collector."}),"\n",(0,t.jsx)(n.h2,{id:"grant-permissions-to-the-registered-application",children:"Grant Permissions to the Registered Application"}),"\n",(0,t.jsx)(n.p,{children:"Follow the steps to grant the required permissions to the registered application."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 1 \u2013"})," Log in to ",(0,t.jsx)(n.a,{href:"https://portal.azure.com/",children:"Azure Portal"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 2 \u2013"})," Navigate to the ",(0,t.jsx)(n.strong,{children:"App registrations"})," > ",(0,t.jsx)(n.strong,{children:"All applications"})," list for your tenant, and select your registered application."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 3 \u2013"})," On the registered app blade, click ",(0,t.jsx)(n.strong,{children:"API permissions"})," in the Manage section."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 4 \u2013"})," In the top toolbar, click ",(0,t.jsx)(n.strong,{children:"Add a permission"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 5 \u2013"})," On the Request API permissions blade, select ",(0,t.jsx)(n.strong,{children:"Microsoft Graph"})," on the Microsoft APIs tab. Select the following permissions:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Under Application Permissions, select:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RoleManagement.Read.Directory"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 6 \u2013"})," At the bottom of the page, click ",(0,t.jsx)(n.strong,{children:"Add Permissions"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 7 \u2013"})," Click ",(0,t.jsx)(n.strong,{children:"Grant Admin Consent for [tenant]"}),". Then click ",(0,t.jsx)(n.strong,{children:"Yes"})," in the confirmation window."]}),"\n",(0,t.jsx)(n.p,{children:"The permissions have been granted to the registered application. Next, you need to create a custom role and assign the necessary resource manager permissions."}),"\n",(0,t.jsx)(n.h2,{id:"create-custom-role-with-resource-manager-permissions",children:"Create Custom Role with Resource Manager Permissions"}),"\n",(0,t.jsx)(n.p,{children:"Follow the steps to create the required custom role and assign the necessary permissions."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 1 \u2013"})," In Azure portal, navigate to ",(0,t.jsx)(n.strong,{children:"Management groups"})," within the Microsoft Entra tenant."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You can either use the search bar or select ",(0,t.jsx)(n.strong,{children:"All services"})," on the navigation menu to find the Management groups dashboard."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 2 \u2013"})," Select the ",(0,t.jsx)(n.strong,{children:"Tenant Root Group"})," to navigate to the Overview page of the management group."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"RECOMMENDED:"})})," It is recommended to create this custom role at the root management group level. This ensures that all of necessary information on the Microsoft Entra environment is collected. Creating the custom role on a lower level management group can result in missing data."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 3 \u2013"})," Navigate to ",(0,t.jsx)(n.strong,{children:"Access Control (IAM)"})," on the left side menu."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 4 \u2013"})," On the Access Control (IAM) panel, click ",(0,t.jsx)(n.strong,{children:"Add"})," and then select ",(0,t.jsx)(n.strong,{children:"Add custom role"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 5 \u2013"})," On the Create a custom role page, enter a role name. Optionally, add a description for the custom role."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 6 \u2013"})," Select the Permissions tab, then click ",(0,t.jsx)(n.strong,{children:"Add permissions"})," and assign the following permissions:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/roleAssignments/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/roleDefinitions/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/resources/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/resources/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Resources/subscriptions/resourceGroups/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Authorization/providerOperations/read"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Management/managementGroups/read"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Alternatively, you can edit the JSON to assign the permissions. To do so, go to the JSON\xa0tab and edit the permissions section of the JSON to be the following:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'"permissions": [  \n\xa0\xa0\xa0\xa0{  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"actions": [  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Authorization/roleAssignments/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Authorization/roleDefinitions/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Resources/resources/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Resources/subscriptions/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Resources/subscriptions/resources/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Resources/subscriptions/resourceGroups/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Authorization/providerOperations/read",  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Microsoft.Management/managementGroups/read"  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0],  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"notActions": [],  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"dataActions": [],  \n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"notDataActions": []  \n\xa0\xa0\xa0\xa0}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"RECOMMENDED:"})})," After editing the JSON, go back to the Permissions tab and verify the list of permissions."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 7 \u2013"})," Once the permissions are configured, click ",(0,t.jsx)(n.strong,{children:"Create"})," on the Review + create tab to finish creating the custom role."]}),"\n",(0,t.jsx)(n.p,{children:"Now that you have created the custom role with the necessary permissions, you must assign this custom role to the registered application."}),"\n",(0,t.jsx)(n.h2,{id:"assign-the-custom-role-to-the-app-registration",children:"Assign the Custom Role to the App Registration"}),"\n",(0,t.jsx)(n.p,{children:"Follow the steps to assign the custom role to your registered application."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 1 \u2013"})," Navigate back to Access Control (IAM) in the Tenant Root Group."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 2 \u2013"})," On the Access control (IAM) panel, click ",(0,t.jsx)(n.strong,{children:"Add"})," and select ",(0,t.jsx)(n.strong,{children:"Add role assignment"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 3 \u2013"})," On the Add role assignment page, select the newly created role and click ",(0,t.jsx)(n.strong,{children:"Next"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"You can use the search bar to easily find the custom role."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 4 \u2013"})," On the Members tab, select the Assign access to option as ",(0,t.jsx)(n.strong,{children:"User, group, or service principal"}),". Then, click ",(0,t.jsx)(n.strong,{children:"Select members"})," and search for your registered application. Select the application from the list and click ",(0,t.jsx)(n.strong,{children:"Select"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step 5 \u2013"})," On the Review + assign tab, click ",(0,t.jsx)(n.strong,{children:"Review + assign"})," to complete the role assignment."]}),"\n",(0,t.jsx)(n.p,{children:"The registered application has now been configured with all the necessary permissions for Entra roles scans."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);