"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[198842],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var i=t(296540);const o={},r=i.createContext(o);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},424393:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"auditor/configuration/microsoft365/exchangeonline/permissions","title":"Permissions for Exchange Online Auditing","description":"Auditor allows you to audit Office 365 organizations that have established modern authentication as their identity management approach, including support for multi-factor authentication (MFA). To learn more about modern authentication, refer to the following Microsoft article: What is modern authentication.","source":"@site/docs/auditor/auditor/configuration/microsoft365/exchangeonline/permissions.md","sourceDirName":"auditor/configuration/microsoft365/exchangeonline","slug":"/auditor/configuration/microsoft365/exchangeonline/permissions","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/permissions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/auditor/auditor/configuration/microsoft365/exchangeonline/permissions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Exchange Online","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/overview"},"next":{"title":"Exchange Online Ports","permalink":"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/ports"}}');var o=t(474848),r=t(28453);const a={},s="Permissions for Exchange Online Auditing",c={},l=[{value:"Configure the Microsoft Entra ID App for Auditing Exchange Online",id:"configure-the-microsoft-entra-id-app-for-auditing-exchange-online",level:2},{value:"Non-owner Mailbox Access Audit Configuration",id:"non-owner-mailbox-access-audit-configuration",level:2},{value:"Non-owner Mailbox Access Audit: Manual Configuration",id:"non-owner-mailbox-access-audit-manual-configuration",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"permissions-for-exchange-online-auditing",children:"Permissions for Exchange Online Auditing"})}),"\n",(0,o.jsxs)(n.p,{children:["Auditor allows you to audit Office 365 organizations that have established modern authentication as their identity management approach, including support for ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks",children:"multi-factor authentication (MFA)"}),". To learn more about modern authentication, refer to the following Microsoft article: ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/office365/enterprise/hybrid-modern-auth-overview#what-is-modern-authentication",children:"What is modern authentication"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"In this scenario, Netwrix Auditor will access the cloud-based infrastructure via Microsoft Graph and other modern APIs, being authenticated through a pre-configured Microsoft Entra ID (formerly Azure AD) application with appropriate access permissions. So, you should register an Microsoft Entra ID app and provide its settings to Auditor when configuring a monitored item."}),"\n",(0,o.jsx)(n.h2,{id:"configure-the-microsoft-entra-id-app-for-auditing-exchange-online",children:"Configure the Microsoft Entra ID App for Auditing Exchange Online"}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to use a data collecting account with modern authentication."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Create a Microsoft Entra ID app that will be used for modern authentication. See the ",(0,o.jsx)(n.a,{href:"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth#create-and-register-a-new-app-in-microsoft-entra-id",children:"Create and Register a New App in Microsoft Entra ID"})," topic for additional information."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE:"})," After you start a new monitoring plan and select a data source in the first step, you will be asked to enter a default data collection account. However, this step is not needed for Exchange Online as it cannot be used. Thus, there is no need to grant any permissions to this account. Instead, you will need to configure a modern authentication app and give the necessary permissions there."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," Grant required permissions to that application. See the ",(0,o.jsx)(n.a,{href:"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth#grant-required-permissions",children:"Grant Required Permissions"})," topic for additional information."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Grant required roles to that application. See the ",(0,o.jsx)(n.a,{href:"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth#grant-required-roles",children:"Grant Required Roles"})," topic for additional information."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 4 \u2013"})," Configure client secret for that application. See the ",(0,o.jsx)(n.a,{href:"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth#configure-client-secret",children:"Configure Client Secret"})," topic for additional information."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 5 \u2013"})," Obtain tenant ID \u2013 you will need it when configuring a monitored item (Office 365 tenant) settings. See the ",(0,o.jsx)(n.a,{href:"/docs/auditor/auditor/configuration/microsoft365/exchangeonline/modernauth#obtain-the-tenant-name",children:"Obtain the Tenant Name"})," topic for additional information."]}),"\n",(0,o.jsx)(n.h2,{id:"non-owner-mailbox-access-audit-configuration",children:"Non-owner Mailbox Access Audit Configuration"}),"\n",(0,o.jsx)(n.p,{children:"To prepare for non-owner mailbox access auditing in the Exchange Online organization, you will need to take several configuration steps, creating a Microsoft Entra ID app with the required permissions and instructing this app to automatically apply the necessary audit settings."}),"\n",(0,o.jsx)(n.p,{children:"Follow the steps to configure a non-owner mailbox access audit."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Install the ",(0,o.jsx)(n.strong,{children:"Exchange Online PowerShell V3"})," module. There are three versions in the repository: 3.0.0, 3.1.0 and 3.2.0."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE:"})," Make sure you are using the version specified in the ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/app-only-auth-powershell-v2?view=exchange-ps",children:"App-only authentication for unattended scripts in Exchange Online PowerShell and Security & Compliance PowerShell "}),"Microsoft article."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"})," In the ",(0,o.jsx)(n.strong,{children:"Microsoft Entra ID admin center"}),", create and register an Microsoft Entra ID app, as described in the related ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/connect-to-exchange-online-powershell?view=exchange-ps",children:"Connect to Exchange Online PowerShell "}),"Microsoft article."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," At the top of the ",(0,o.jsx)(n.strong,{children:"Request API permissions"})," pane, click the ",(0,o.jsx)(n.strong,{children:"APIs my organization uses"})," tab and search for ",(0,o.jsx)(n.em,{children:"Office 365 Exchange Online"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 4 \u2013"})," Click on the ",(0,o.jsx)(n.em,{children:"Office 365 Exchange Online"})," entry in the list of apps found."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 5 \u2013"}),"\nProceed with adding the permissions for this app: select ",(0,o.jsx)(n.strong,{children:"Application permissions"})," and then select ",(0,o.jsx)(n.strong,{children:"Exchange.ManageAsApp"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 6 \u2013"})," Grant admin consent to the tenant (that is, for the Office 365 organization whose audit data will be collected by the newly registered app).\nGo to the ",(0,o.jsx)(n.strong,{children:"new app settings > API permissions"})," and click ",(0,o.jsx)(n.strong,{children:"Grant admin consent for"}),"_",(0,o.jsx)(n.code,{children:"<tenant name>"}),"_.\nWhen prompted to confirm granting, click ",(0,o.jsx)(n.strong,{children:"Yes"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 7 \u2013"})," Go to ",(0,o.jsx)(n.strong,{children:"Azure Active Directory"})," \u2014 ",(0,o.jsx)(n.strong,{children:"Roles and administrators"})," and assign ",(0,o.jsx)(n.strong,{children:"Exchange Administrator"})," role."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 8 \u2013"})," Download the PowerShell script for certificate creation, as provided in the ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/app-only-auth-powershell-v2?view=exchange-ps#generate-a-self-signed-certificate",children:"Generate a self-signed certificate "}),"Microsoft article."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 9 \u2013"})," To create a self-signed certificate to be used by the app, run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'.\\Create-SelfSignedCertificate.ps1 -CommonName "MyCompanyName" -StartDate 2020-04-01 -EndDate 2022-04-01\n'})}),"\n",(0,o.jsx)(n.p,{children:"where:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CommonName"})," \u2014 specify ",(0,o.jsx)(n.em,{children:'"Netwrix Auditor"'})]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"StartDate"})," \u2014 set to current date"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"EndDate"})," \u2014 set to 2 years from now"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 10 \u2013"})," When prompted to specify a password, click ",(0,o.jsx)(n.strong,{children:"Enter"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 11 \u2013"})," Go to ",(0,o.jsx)(n.strong,{children:"Manage > Certificates & secrets"}),", click ",(0,o.jsx)(n.strong,{children:"Upload certificate"})," and upload the_.crt_ file you have just created."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"certificates_secrets_thumb_0_0",src:t(426573).A+"",width:"1305",height:"666"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 12 \u2013"})," To create Exchange Online connection session, you can provide certificate file path or thumbprint. If you want to use a file path, run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Connect-ExchangeOnline -CertificateFilePath "full_path_to_certificate"   \n-AppID "yourAppId" -Organization "Office365_tenant_name"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Application (client ID) can be found in the ",(0,o.jsx)(n.strong,{children:"Overview"})," page."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"tenant_id_thumb_0_0",src:t(865927).A+"",width:"1455",height:"649"})}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Connect-ExchangeOnline -CertificateFilePath "C:\\Path\\MyCompanyName1.pfx"   \n-AppId "402b12a2-fb2b-4222-8f54-5596def1" -Organization "myorganization123.onmicrosoft.com"\n'})}),"\n",(0,o.jsx)(n.p,{children:"You can use certificate thumbprint instead of file path. For that, import the certificate to the local certificate store, using the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Import-PfxCertificate -FilePath "path_to_pfx_certificate" -CertStoreLocation Cert:\\CurrentUser\\My\n'})}),"\n",(0,o.jsx)(n.p,{children:"Then run the command like following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Connect-ExchangeOnline -CertificateThumbprint 6AE\u04105A82911\u0410\u0410\u04103F76FEE149B7B52\u041070DDFD88 -AppId a14a 822d-f228-412b-9222-281de23   \n-Organization myorganization123.onmicrosoft.com\n"})}),"\n",(0,o.jsx)(n.p,{children:"Finally, run the following command to end the session:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Disconnect-ExchangeOnline -Confirm:$false\n"})}),"\n",(0,o.jsx)(n.p,{children:"To automate the process described above, you can create a a script comprising the corresponding commands and schedule its launch."}),"\n",(0,o.jsx)(n.h2,{id:"non-owner-mailbox-access-audit-manual-configuration",children:"Non-owner Mailbox Access Audit: Manual Configuration"}),"\n",(0,o.jsx)(n.p,{children:"If you plan to manually apply the audit settings required to audit non-owner mailbox access in Exchange Online organization, you will need to create a remote PowerShell session to Exchange Online. Follow the steps to do so."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 1 \u2013"})," Install the Exchange Online PowerShell V2 module as described in the ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps",children:"About the Exchange Online PowerShell module"})," Microsoft article."]}),"\n",(0,o.jsx)(n.p,{children:"Make sure to install the latest version."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 2 \u2013"}),"  Launch PowerShell and connect to Exchange Online, as described in the ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell-v2?view=exchange-ps",children:"About the Exchange Online PowerShell module"})," Microsoft article."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Step 3 \u2013"})," Run the cmdlet, depending on the mailboxes you plan to audit (all mailboxes or selected individual mailbox):"]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"For"}),(0,o.jsx)(n.th,{children:"Command"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"All"}),(0,o.jsx)(n.td,{children:"Execute the following cmdlet:  Get-ExoMailbox -PropertySets Minimum -RecipientTypeDetails UserMailbox,SharedMailbox,EquipmentMailbox,LinkedMailbox,RoomMailbox"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Selected"}),(0,o.jsxs)(n.td,{children:["Execute the following cmdlet:  Set-Mailbox -Identity ",(0,o.jsx)(n.code,{children:"{0}"})," -AuditEnabled $true \u2013AuditAdmin Update,Copy,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create \u2013AuditDelegate Update,Move,MoveToDeletedItems,SoftDelete,HardDelete,FolderBind,SendAs,SendOnBehalf,Create  Where the ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"{0}"})}),' character must be replaced with any of the following:   - Display Name. Example: "Michael Jones" - Domain\\User. Example: enterprise.local\\MJones - Email address. Example: ',(0,o.jsx)(n.a,{href:"mailto:analyst@enterprise.onmicrosoft.com",children:"analyst@enterprise.onmicrosoft.com"})," - GUID. Example: ",(0,o.jsx)(n.code,{children:"{c43a7694-ba06-46d2-ac9b-205f25dfb32d}"})," - LegacyExchangeDN. Example: /o=EnterpriseDev/ou=Exchange Administrative Group(FYDIBOHF23SPDLT)/cn=Recipients/cn=97da560450c942aba     81b2da46c60858a-analyst - SamAccountName. Example: MANAG58792-1758064122 - (DN) Distinguished name. Example: CN=MJones,CN=Users,DC=enterprisedc1,DC=enterprise,DC=local - User ID or User Principal Name. Example: ",(0,o.jsx)(n.a,{href:"mailto:MJones@enterprise.onmicrosoft.com",children:"MJones@enterprise.onmicrosoft.com"}),"   If you are going to audit multiple individual mailboxes, run the cmdlet for each mailbox you need."]})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},426573:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/certificates_secrets_thumb_0_0-092852cf4b6ba65a12da5cea1be578d5.webp"},865927:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/tenant_id_thumb_0_0-2f4201fcba3bf919c2474710363c8047.webp"}}]);