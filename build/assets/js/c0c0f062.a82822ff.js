"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[249141],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(296540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},645092:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/agent-server-communication-26215e31acdbf7549f69612bf057b1e9.webp"},680360:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"usercube/integration-guide/architecture/how-tos/protect-agent-server-communication/index","title":"Protect Agent/Server Communication","description":"This guide shows how to set up a secured authentication system between Identity Manager\'s agent and server.","source":"@site/docs/usercube/usercube/integration-guide/architecture/how-tos/protect-agent-server-communication/index.md","sourceDirName":"usercube/integration-guide/architecture/how-tos/protect-agent-server-communication","slug":"/usercube/integration-guide/architecture/how-tos/protect-agent-server-communication/","permalink":"/docs/usercube/usercube/integration-guide/architecture/how-tos/protect-agent-server-communication/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/usercube/usercube/integration-guide/architecture/how-tos/protect-agent-server-communication/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"userCubeSidebar","previous":{"title":"Architecture","permalink":"/docs/usercube/usercube/integration-guide/architecture/"},"next":{"title":"On-Premises Environment","permalink":"/docs/usercube/usercube/integration-guide/architecture/on-prem/"}}');var r=t(474848),s=t(28453);const o={},c="Protect Agent/Server Communication",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Configuration details",id:"configuration-details",level:3},{value:"Protect Agent/Server Communication",id:"protect-agentserver-communication-1",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"protect-agentserver-communication",children:"Protect Agent/Server Communication"})}),"\n",(0,r.jsx)(n.p,{children:"This guide shows how to set up a secured authentication system between Identity Manager's agent and server."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Identity Manager provides a simple way to protect the communication between agent and server, using OpenID Connect."}),"\n",(0,r.jsxs)(n.p,{children:["First, make sure to understand the OpenID protocol. For example, ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc",children:"see Microsoft's documentation on the matter"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The idea, when sending data from the agent to the server, is the following:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"the agent decrypts its own data which was encrypted with the agent-side certificate;"}),"\n",(0,r.jsx)(n.li,{children:"the agent calls the server, and sends its HTTPS-encrypted message;"}),"\n",(0,r.jsx)(n.li,{children:"the server receives and decrypts the message, before encrypting it again with its own encryption certificate configured by Identity Manager."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Schema: Agent/Server Communication",src:t(645092).A+"",width:"4095",height:"1585"})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-details",children:"Configuration details"}),"\n",(0,r.jsxs)(n.p,{children:["The server must be configured, in its ",(0,r.jsx)(n.code,{children:"appsettings.json"}),", with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"an encryption certificate with the private and public keys, in order to be able to send signed tokens."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The agent must be configured, in its ",(0,r.jsx)(n.code,{children:"appsettings.json"}),", with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"an encryption certificate with at least the server's public key, in order to be able to verify the tokens sent by the server;"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"another encryption certificate meant to encrypt specific files such as logs or temporary files;"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"an SSL encryption certificate for the HTTPS connection."}),"\n",(0,r.jsx)(n.p,{children:"The SSL certificate is required when working in an on-premises environment. In a SaaS environment, Identity Manager provides it."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In order to give to the agent the right permissions, the XML configuration must specify an ",(0,r.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/toolkit/xml-configuration/access-control/openidclient/",children:"OpenIdClient"})," linked to its hashed secret, and to a Identity Manager profile."]}),"\n",(0,r.jsx)(n.h2,{id:"protect-agentserver-communication-1",children:"Protect Agent/Server Communication"}),"\n",(0,r.jsx)(n.p,{children:"Protect agent/server communication by proceeding as follows:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Make sure that both the agent and server configurations specify an encryption certificate. See the ",(0,r.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/network-configuration/agent-configuration/appsettings/",children:"Application Settings"})," for additional information."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\nappsettings.json\n\n{\n  "IdentityServer": {\n      "X509KeyFilePath": "./Usercube.pfx",\n      "X509KeyFilePassword": "secret"\n  },\n  ...\n}\n\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Make sure that the agent is also configured with its own encryption certificate. See the ",(0,r.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/network-configuration/agent-configuration/appsettings/",children:"Application Settings"})," for additional information."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\nappsettings.json\n\n{\n  "EncryptionCertificate": {\n      "File": "./Usercube-Files.pfx",\n      "Password": "secret",\n      "EncryptFile": true\n  },\n  ...\n}\n\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure an ",(0,r.jsx)(n.code,{children:"OpenIdClient"}),", both on agent side in ",(0,r.jsx)(n.code,{children:"appsettings.agent.json"})," with the non-hashed secret and on server side in the XML configuration with the secret hashed by the ",(0,r.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/executables/references/new-openidsecret/",children:"\nUsercube-New-OpenIDSecret\n"})," executable. See the ",(0,r.jsx)(n.a,{href:"/docs/usercube/usercube/integration-guide/toolkit/xml-configuration/access-control/openidclient/",children:"\nOpenIdClient\n"})," for additional information."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"For example on agent side:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\nappsettings.agent.json\n\n{\n  "OpenId": {\n      "OpenIdClients": {\n          "Job": "newSecret"\n      },\n      ...\n  }\n  ...\n}\n\n'})}),"\n",(0,r.jsx)(n.p,{children:"And on server side:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\n./Usercube-New-OpenIDSecret.exe --client-secret secret\n\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:'<OpenIdClient Identifier="Job" HashedSecret="K7gNU3sdo+OL0wNhqoVWhr3g6s1xYv72ol/pe/Unols=" DisplayName_L1="Permissions for jobs" Profile="Administrator" />'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{})}),"\n"]}),"\n"]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);