<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-threatprevention docs-version-current docs-doc-page docs-doc-id-threatprevention/requirements/dbmaintenance" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Database Maintenance Feature Requirements | Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.yourcompany.com/img/Logo_RGB.svg"><meta data-rh="true" name="twitter:image" content="https://docs.yourcompany.com/img/Logo_RGB.svg"><meta data-rh="true" property="og:url" content="https://docs.yourcompany.com/docs/threatprevention/threatprevention/requirements/dbmaintenance"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-threatprevention-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-threatprevention-current"><meta data-rh="true" property="og:title" content="Database Maintenance Feature Requirements | Documentation"><meta data-rh="true" name="description" content="All operations to configure database maintenance on the Database Maintenance Window are executed by the Enterprise Manager. Therefore, either the SQL Server account supplied during Threat Prevention installation or the Windows account configured to run the Enterprise Manager (for Windows Authentication to the SQL Server) must have enough rights to execute the Database Maintenance feature."><meta data-rh="true" property="og:description" content="All operations to configure database maintenance on the Database Maintenance Window are executed by the Enterprise Manager. Therefore, either the SQL Server account supplied during Threat Prevention installation or the Windows account configured to run the Enterprise Manager (for Windows Authentication to the SQL Server) must have enough rights to execute the Database Maintenance feature."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yourcompany.com/docs/threatprevention/threatprevention/requirements/dbmaintenance"><link data-rh="true" rel="alternate" href="https://docs.yourcompany.com/docs/threatprevention/threatprevention/requirements/dbmaintenance" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yourcompany.com/docs/threatprevention/threatprevention/requirements/dbmaintenance" hreflang="x-default"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"><link rel="stylesheet" href="/assets/css/styles.4cbdd69d.css">
<script src="/assets/js/runtime~main.a42836f1.js" defer="defer"></script>
<script src="/assets/js/main.3131faef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/branding/logo.svg" alt="Netwrix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/branding/logo.svg" alt="Netwrix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Products</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/1secure">1Secure</a></li><li><a class="dropdown__link" href="/docs/accessanalyzer">Access Analyzer</a></li><li><a class="dropdown__link" href="/docs/accessinformationcenter">Access Information Center</a></li><li><a class="dropdown__link" href="/docs/activitymonitor">Activity Monitor</a></li><li><a class="dropdown__link" href="/docs/auditor">Auditor</a></li><li><a class="dropdown__link" href="/docs/changetracker">Change Tracker</a></li><li><a class="dropdown__link" href="/docs/dataclassification">Data Classification</a></li><li><a class="dropdown__link" href="/docs/groupid">Group ID</a></li><li><a class="dropdown__link" href="/docs/passwordpolicyenforcer">Password Policy Enforcer</a></li><li><a class="dropdown__link" href="/docs/passwordreset">Password Reset</a></li><li><a class="dropdown__link" href="/docs/passwordsecure">Password Secure</a></li><li><a class="dropdown__link" href="/docs/policypak">PolicyPak</a></li><li><a class="dropdown__link" href="/docs/privilegesecure">Privilege Secure</a></li><li><a class="dropdown__link" href="/docs/recoveryforactivedirectory">Recovery for Active Directory</a></li><li><a class="dropdown__link" href="/docs/strongpointfornetsuite">StrongPoint for NetSuite</a></li><li><a class="dropdown__link" href="/docs/strongpointforsalesforce">StrongPoint for Salesforce</a></li><li><a class="dropdown__link" href="/docs/strongpointnetsuiteflashlight">StrongPoint NetSuite Flashlight</a></li><li><a class="dropdown__link" href="/docs/strongpointsalesforceflashlight">StrongPoint Salesforce Flashlight</a></li><li><a class="dropdown__link" href="/docs/threatmanager">Threat Manager</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/threatprevention">Threat Prevention</a></li><li><a class="dropdown__link" href="/docs/usercube">UserCube</a></li><li><a class="dropdown__link" href="/docs/usercube_saas">UserCube SaaS</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="http://github.com/netwrix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/threatprevention/config/activedirectory/threatprevention">config</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/threatprevention/">Threat Prevention</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/threatprevention/threatprevention/admin/agents/deploy/installing">threatprevention</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/admin/agents/deploy/installing">admin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/api/collections">api</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/eperestsite/accountmanagement">eperestsite</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/gettingstarted">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/install/adminconsole">install</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/overview">Netwrix Threat Prevention v7.5 Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/reportingmodule/configuration/integrations/activedirectorysync">reportingmodule</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/adminconsole">requirements</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/adminconsole">Remote Administration Console Machine Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/agent">Agent Server Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/agentnas">NAS Device Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/application">Application Server Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/dbmaintenance">Database Maintenance Feature Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/eperestsite">EPE Rest Site Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/overview">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/ports">Firewall Ports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/reportingserver">Reporting Module Server Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/requirements/sqlserver">SQL Server Requirements</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/siemdashboard/overview">siemdashboard</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/solutions/activedirectory">solutions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/threatprevention/threatprevention/troubleshooting/agentcommunication">troubleshooting</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/threatprevention/threatprevention/whatsnew">What&#x27;s New</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">threatprevention</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">requirements</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Database Maintenance Feature Requirements</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Database Maintenance Feature Requirements</h1></header>
<p>All operations to configure database maintenance on the <a href="/docs/threatprevention/threatprevention/admin/configuration/databasemaintenance/overview">Database Maintenance Window</a> are executed by the Enterprise Manager. Therefore, either the SQL Server account supplied during Threat Prevention installation or the Windows account configured to run the Enterprise Manager (for Windows Authentication to the SQL Server) must have enough rights to execute the Database Maintenance feature.</p>
<p><strong>NOTE:</strong> If the account used to run Database Maintenance is changed, it is necessary to manually delete the DBMaintenance SQL Agent Job in the SQL Server Management Studio.</p>
<p>Permissions Summary</p>
<p>The database user must have the following rights to run Database Maintenance:</p>
<ul>
<li>Read/Write permissions in the NVMonitorData database</li>
<li>Read/Write permissions in the NVMonitorConfig database</li>
<li>Query SQL Agent status</li>
<li>Create/Delete/Modify SQL Agent job</li>
<li>Query Database size information</li>
<li>Execute sp_updatestats for the NVMonitorData database</li>
<li>Create Server Link</li>
</ul>
<p>Database Permissions</p>
<p>The following rights are required to run database maintenance:</p>
<ul>
<li>
<p>In the master database:</p>
<ul>
<li>VIEW SERVER STATE permission</li>
<li>ALTER ANY LOGIN permission</li>
<li>ALTER ANY LINKED SERVER permission</li>
</ul>
</li>
<li>
<p>In the msdb database:</p>
<ul>
<li>SQLAgentOperatorRole role</li>
<li>Permission to select from msdb.dbo.sysjobs</li>
</ul>
</li>
<li>
<p>In the NVMonitorConfig database:</p>
<ul>
<li>db_datareader role</li>
<li>db_datawriter role</li>
</ul>
</li>
<li>
<p>In the NVMonitorData database:</p>
<ul>
<li>
<p>Be owner of this database</p>
<p><strong>NOTE:</strong> There is a least privilege option for this requirement. See the <a href="#Less-Privilege-Model-for-NVMonitorData-Database-Permission">Less Privilege Model for NVMonitorData Database Permission</a> topic for additional information.</p>
</li>
</ul>
</li>
</ul>
<p>See the <a href="/docs/threatprevention/threatprevention/admin/overview#database-components">Database Components</a> topic for a discussion of these databases.</p>
<p>Archive Database Permissions</p>
<p>If the <strong>Move</strong> option is selected on the <a href="/docs/threatprevention/threatprevention/admin/configuration/databasemaintenance/archive">Archive Data</a> tab of the Database Maintenance window, an additional account must be provided for the destination server/database. This account must have rights to:</p>
<ul>
<li>Create the database on the specified server</li>
<li>Modify the schema</li>
<li>Read/write data from the archive database</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="less-privilege-model-for-nvmonitordata-database-permission">Less Privilege Model for NVMonitorData Database Permission<a href="#less-privilege-model-for-nvmonitordata-database-permission" class="hash-link" aria-label="Direct link to Less Privilege Model for NVMonitorData Database Permission" title="Direct link to Less Privilege Model for NVMonitorData Database Permission">​</a></h2>
<p><strong>NOTE:</strong> If this less privileged model is used, then the last step in the Database Maintenance process, executing sp_updatestats, will fail. However, all other steps in the process will complete successfully and all data will be deleted/moved as configured.</p>
<p>If it is not possible to grant the ‘user’ owner rights to the NVMonitorData database, grant the following instead:</p>
<ul>
<li>db_datareader role</li>
<li>db_datawriter role</li>
<li>ALTER ON SCHEMA :: dbo</li>
<li>Execute</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample-script-to-grant-database-maintenance-rights">Sample Script to Grant Database Maintenance Rights<a href="#sample-script-to-grant-database-maintenance-rights" class="hash-link" aria-label="Direct link to Sample Script to Grant Database Maintenance Rights" title="Direct link to Sample Script to Grant Database Maintenance Rights">​</a></h2>
<p>Here is a sample script to give the necessary rights for Database Maintenance.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*  Script creates user with a set of minimum required rights to run   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*  Database Maintenance in StealthINTERCEPT (now Threat Prevention) product version 4.1 or newer  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*  Prerequisites: Corresponding Windows account must already exist  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">declare @usr varchar (50) = &#x27;DomainName\UserName&#x27;;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">declare   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@q varchar(8000),  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@id int;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin -- CLEAN   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use NVMonitorData;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if exists(select 1 from sys.database_principals where name = @usr)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_dropuser [&#x27; + @usr +&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use NVMonitorConfig;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if exists(select 1 from sys.database_principals where name = @usr)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_dropuser [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use master;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if exists(select 1 from sys.database_principals where name = @usr)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_dropuser [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use msdb;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if exists(select 1 from msdb.sys.database_principals where name = @usr)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_dropuser [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if exists(select * from master.sys.server_principals where name = @usr)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while(1=1)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @id = null;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select @id=session_id from master.sys.dm_exec_sessions where login_name = @usr;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if @id is null  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">break;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;kill &#x27;+ cast(@id as varchar);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(&#x27;drop login [&#x27; + @usr + &#x27;]&#x27;);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;CREATE LOGIN [&#x27; + @usr + &#x27;] FROM WINDOWS WITH DEFAULT_DATABASE = [NVMonitorData]&#x27;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use master;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;CREATE USER [&#x27; + @usr + &#x27;] FOR LOGIN [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT VIEW SERVER STATE TO [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT ALTER ANY LOGIN TO [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT ALTER ANY LINKED SERVER TO [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use msdb;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;CREATE USER [&#x27;+ @usr + &#x27;] FOR LOGIN [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_addrolemember &#x27;&#x27;SQLAgentOperatorRole&#x27;&#x27;,[&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT select ON msdb.dbo.sysjobs TO [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use NVMonitorConfig;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Uncomment next line on error: The login already has an account under a different user name.  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- exec sp_changedbowner &#x27;sa&#x27;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;CREATE USER [&#x27; + @usr + &#x27;] FOR LOGIN [&#x27; + @usr + &#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_addrolemember &#x27;&#x27;db_datareader&#x27;&#x27;,[&#x27;+@usr+&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_addrolemember &#x27;&#x27;db_datawriter&#x27;&#x27;,[&#x27;+@usr+&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use NVMonitorData;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* To use this list of DB permissions the issue with &#x27;sp_updatestats&#x27; should be resolved first  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Uncomment next line on error: The login already has an account under a different user name.  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- exec sp_changedbowner &#x27;sa&#x27;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;CREATE USER [&#x27; + @usr + &#x27;] FOR LOGIN [&#x27; + @usr + &#x27;];&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_addrolemember &#x27;&#x27;db_datareader&#x27;&#x27;,[&#x27;+@usr+&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;exec sp_addrolemember &#x27;&#x27;db_datawriter&#x27;&#x27;,[&#x27;+@usr+&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT ALTER ON SCHEMA::dbo TO [&#x27;+ @usr +&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;GRANT EXECUTE TO [&#x27;+ @usr +&#x27;]&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set @q = &#x27;ALTER AUTHORIZATION ON DATABASE::NVMonitorData TO [&#x27; + @usr + &#x27;]&#x27;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(@q);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>CAUTION:</strong> Errors may occur if this script designates an existing user for granting Less Privilege Model permissions for database maintenance. This happens because the user is directed to be dropped and subsequently recreated.</p>
<p><em><strong>RECOMMENDED:</strong></em> Rather than using this script as it is, create a dedicated role for this user with required permission based on the recommended best practices.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/threatprevention/threatprevention/requirements/dbmaintenance.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/threatprevention/threatprevention/requirements/application"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Application Server Requirements</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/threatprevention/threatprevention/requirements/eperestsite"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">EPE Rest Site Requirements</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#less-privilege-model-for-nvmonitordata-database-permission" class="table-of-contents__link toc-highlight">Less Privilege Model for NVMonitorData Database Permission</a></li><li><a href="#sample-script-to-grant-database-maintenance-rights" class="table-of-contents__link toc-highlight">Sample Script to Grant Database Maintenance Rights</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>