<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-accessanalyzer docs-version-current docs-doc-page docs-doc-id-config/netappcmode/configurefpolicy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Configure FPolicy | Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.yourcompany.com/img/Logo_RGB.svg"><meta data-rh="true" name="twitter:image" content="https://docs.yourcompany.com/img/Logo_RGB.svg"><meta data-rh="true" property="og:url" content="https://docs.yourcompany.com/docs/accessanalyzer/config/netappcmode/configurefpolicy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-accessanalyzer-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-accessanalyzer-current"><meta data-rh="true" property="og:title" content="Configure FPolicy | Documentation"><meta data-rh="true" name="description" content="Activity Monitor relies on the NetApp FPolicy framework for monitoring of file access events on Storage Virtual Machines (SVM). FPolicy needs to be configured for each SVM."><meta data-rh="true" property="og:description" content="Activity Monitor relies on the NetApp FPolicy framework for monitoring of file access events on Storage Virtual Machines (SVM). FPolicy needs to be configured for each SVM."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yourcompany.com/docs/accessanalyzer/config/netappcmode/configurefpolicy"><link data-rh="true" rel="alternate" href="https://docs.yourcompany.com/docs/accessanalyzer/config/netappcmode/configurefpolicy" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yourcompany.com/docs/accessanalyzer/config/netappcmode/configurefpolicy" hreflang="x-default"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"><link rel="stylesheet" href="/assets/css/styles.4cbdd69d.css">
<script src="/assets/js/runtime~main.a42836f1.js" defer="defer"></script>
<script src="/assets/js/main.3131faef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/branding/logo.svg" alt="Netwrix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/branding/logo.svg" alt="Netwrix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Products</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/1secure">1Secure</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/accessanalyzer">Access Analyzer</a></li><li><a class="dropdown__link" href="/docs/accessinformationcenter">Access Information Center</a></li><li><a class="dropdown__link" href="/docs/activitymonitor">Activity Monitor</a></li><li><a class="dropdown__link" href="/docs/auditor">Auditor</a></li><li><a class="dropdown__link" href="/docs/changetracker">Change Tracker</a></li><li><a class="dropdown__link" href="/docs/dataclassification">Data Classification</a></li><li><a class="dropdown__link" href="/docs/groupid">Group ID</a></li><li><a class="dropdown__link" href="/docs/passwordpolicyenforcer">Password Policy Enforcer</a></li><li><a class="dropdown__link" href="/docs/passwordreset">Password Reset</a></li><li><a class="dropdown__link" href="/docs/passwordsecure">Password Secure</a></li><li><a class="dropdown__link" href="/docs/policypak">PolicyPak</a></li><li><a class="dropdown__link" href="/docs/privilegesecure">Privilege Secure</a></li><li><a class="dropdown__link" href="/docs/recoveryforactivedirectory">Recovery for Active Directory</a></li><li><a class="dropdown__link" href="/docs/strongpointfornetsuite">StrongPoint for NetSuite</a></li><li><a class="dropdown__link" href="/docs/strongpointforsalesforce">StrongPoint for Salesforce</a></li><li><a class="dropdown__link" href="/docs/strongpointnetsuiteflashlight">StrongPoint NetSuite Flashlight</a></li><li><a class="dropdown__link" href="/docs/strongpointsalesforceflashlight">StrongPoint Salesforce Flashlight</a></li><li><a class="dropdown__link" href="/docs/threatmanager">Threat Manager</a></li><li><a class="dropdown__link" href="/docs/threatprevention">Threat Prevention</a></li><li><a class="dropdown__link" href="/docs/usercube">UserCube</a></li><li><a class="dropdown__link" href="/docs/usercube_saas">UserCube SaaS</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="http://github.com/netwrix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/accessanalyzer/config/activedirectory/access">config</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/activedirectory/access">activedirectory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/dellcelerravnx/access">dellcelerravnx</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/dellpowerscale/activity">dellpowerscale</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/dellunity/access">dellunity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/entraid/access">entraid</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/exchangeonline/access">exchangeonline</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/hitachi/activity">hitachi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/nasuni/access">nasuni</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/netapp7mode/access">netapp7mode</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/access">netappcmode</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/access">NetApp Data ONTAP Cluster-Mode Access &amp; Sensitive Data Auditing Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/activity">NetApp Data ONTAP Cluster-Mode Activity Auditing Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/configureemptyfpolicy">Configure Empty FPolicy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/configurefirewall">Configure Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/configurefpolicy">Configure FPolicy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/overview">NetApp Data ONTAP Cluster-Mode Target Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/accessanalyzer/config/netappcmode/provisionactivity">Provision ONTAP Account</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/nutanix/access">nutanix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/qumulo/activity">qumulo</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/sharepoint/access">sharepoint</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/sharepointonline/access">sharepointonline</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/accessanalyzer/config/windowsfile/access">windowsfile</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/accessanalyzer/enterpriseauditor/admin/action/activedirectory/operations/computerdetails">enterpriseauditor</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/accessanalyzer/">Access Analyzer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/accessanalyzer/stealthaudit/install_guides/mapi_cdo_install/appendix">stealthaudit</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">config</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">netappcmode</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configure FPolicy</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configure FPolicy</h1></header>
<p>Activity Monitor relies on the NetApp FPolicy framework for monitoring of file access events on Storage Virtual Machines (SVM). FPolicy needs to be configured for each SVM.</p>
<p>There are two ways to configure FPolicy:</p>
<ul>
<li>Activity Monitor agent can facilitate the <a href="#automatic-configuration-of-fpolicy">Automatic Configuration of FPolicy</a> for the monitored SVM using the ONTAP API. This mode is simple, but does not allow you to exclude certain volumes or shares of the SVM from being monitored. It also requires additional permissions to create and modify FPolicy.</li>
<li>Another option is to <a href="#manually-configure-fpolicy">Manually Configure FPolicy</a> for each SVM. This mode allows you to fine tune FPolicy by excluding certain volumes or shares from being monitored. It also reduces product permissions.</li>
</ul>
<p>Regardless of the chosen approach for FPolicy configuration, one also needs to perform extra steps if the FPolicy communication has to be secured with TLS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls-authentication-options">TLS Authentication Options<a href="#tls-authentication-options" class="hash-link" aria-label="Direct link to TLS Authentication Options" title="Direct link to TLS Authentication Options">​</a></h2>
<p>There are two TLS FPolicy Authentication options that can be used:</p>
<ul>
<li>
<p>TLS, server authentication – Server only authentication</p>
<ul>
<li>A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. The Server Certificate PEM file needs to be saved locally on the Activity Monitor Console server.</li>
<li>For manual FPolicy configuration, the Server Certificate needs to be installed on the SVM, and then server-authentication set.</li>
<li>For automatic FPolicy configuration, the Activity Monitor manages installation of the Server Certificate.</li>
</ul>
</li>
<li>
<p>TLS, mutual authentication – Mutual authentication</p>
<ul>
<li>A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. The Server Certificate PEM file needs to be saved locally on the Activity Monitor Console server.</li>
<li>A certificate (Client Certificate) for the SVM needs to be copied to a PEM file and saved locally on the Activity Monitor Console server.</li>
<li>For manual FPolicy configuration, the Server Certificate needs to be installed on the SVM and then mutual-authentication set.</li>
<li>For automatic FPolicy configuration, mutual-authentication set before the configuration process. The Activity Monitor manages installation of both certificates.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-server-certificate">Generate Server Certificate<a href="#generate-server-certificate" class="hash-link" aria-label="Direct link to Generate Server Certificate" title="Direct link to Generate Server Certificate">​</a></h3>
<p>A certificate (Server Certificate) for the Agent server needs to be generated and copied to a PEM file. This is required for both of the TLS authentication options.</p>
<p>The PEM file must contain both Public Key and Private Key parts. A certificate may be self-signed or issued by a certification authority. Below are the steps for generation of a self-signed certificate using OpenSSL toolkit.</p>
<p>Use the following command on the agent server to create the Server Certificate and copy it to a .pem file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl.exe req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes -subj &quot;/CN=[ACTIVITY_AGENT_SERVER_NAME]&quot;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy cert.pem+key.pem [CERTIFICATE_FILE_NAME.pem]  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">del cert.pem key.pem .rnd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl.exe req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes -subj &quot;/CN=testagentserver&quot;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy cert.pem+key.pem agentkey.pem  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">del cert.pem key.pem .rnd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example <code> agentkey.pem</code> would be used as the Server Certificate. Save the Server Certificate locally on the Activity Monitor Console server.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-pem-file-for-client-certificate">Create PEM File for Client Certificate<a href="#create-pem-file-for-client-certificate" class="hash-link" aria-label="Direct link to Create PEM File for Client Certificate" title="Direct link to Create PEM File for Client Certificate">​</a></h3>
<p>A certificate (Client Certificate) for the SVM needs to be copied to a PEM file. This is required for the TLS, mutual authentication option. Follow the steps to create the PEM file for the Client Certificate.</p>
<p><strong>Step 1 –</strong> On the SVM , use the following command to show the security certificate details:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate show -vserver [SVM_NAME] -type server instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate show -vserver testserver -type server instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Step 2 –</strong> Copy the security certificate details into a text file and copy the public key to a PEM file. The following variables from security details will be needed to set mutual-authentication during Part 6 of manual configuration and prior to automatic configuration:</p>
<ul>
<li>SVM</li>
<li>Common Name</li>
<li>Certificate Serial</li>
<li>Public Key Certificate</li>
</ul>
<p><strong>Step 3 –</strong> Copy the value of Public Key Certificate field to a PEM file. The value spans multiple lines, starts with &quot;<code>----BEGIN CERTIFICATE-----</code>&quot; and ends with &quot;<code>-----END CERTIFICATE-----</code>&quot;.</p>
<p>The Client Certificate PEM file has been created.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-store">Persistent Store<a href="#persistent-store" class="hash-link" aria-label="Direct link to Persistent Store" title="Direct link to Persistent Store">​</a></h2>
<p>For ONTAP 9.15.1 and later, enabling the Persistent Store feature is recommended regardless of the chosen FPolicy configuration approach. The Persistent Store provides resilience and predictable latency in scenarios such as network delays or bursts of activity events. The feature uses a dedicated volume for each SVM as a staging buffer before events are sent to the agent.</p>
<p>Persistent Store requires the following parameters:</p>
<ul>
<li>Volume name – If the volume does not exist, it will be created automatically (recommended).</li>
<li>Initial volume size – Specifies the starting size of the volume.</li>
<li>Autosize mode – Options include Off, Grow, or Grow/Shrink.</li>
</ul>
<p>The size depends on the time duration for which you want to persist the events and the rate of events. For example, if you want 30 minutes of events to persist in an SVM with a capacity of 5000 events per second and the average event record size of 0.6 KB, the required volume size is <code>5000 * 30 * 60 * 0.6 KB = 5400000 KB ≈ 5 GB</code>.</p>
<p><strong>NOTE:</strong> To find the approximate event rate, use the FPolicy counter <code>requests_dispatched_rate</code>.</p>
<p><strong>NOTE:</strong> For the Persistent Store to automatically create a volume, the SVM must have at least one local tier (aggregate) assigned.</p>
<p>To check that the SVM has assigned local tiers, use the following command:</p>
<p>vserver show -vserver [SVM_NAME] -fields aggr-list</p>
<p>The command shows currently local tiers. If no tiers are assigned, &quot;-&quot; is displayed.</p>
<p>To assign local tiers to the SVM use the following command:</p>
<p>vserver add-aggregates -vserver [SVM_NAME] -aggregates [AGGREGATE_LIST]</p>
<p>Example:</p>
<p>vserver add-aggregates -vserver testserver -aggregates aggr1,aggr2</p>
<p><strong>NOTE:</strong> This command is available to cluster administrators at the admin privilege level.</p>
<p>It is recommended to allow the volume to be created automatically. In this case, the FPolicy subsystem manages the volume, maintains the directory structure, and protects it from accidental deletion by marking it as not mountable.</p>
<p>If you choose to create the volume manually, ensure the following:</p>
<ul>
<li>The volume is not mounted and has no junction point.</li>
<li>The snapshot policy for the volume is set to none.</li>
</ul>
<p>For additional and up-to-date recommendations on volumes for the Persistent Store, refer to the NetApp documentation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manually-configure-fpolicy">Manually Configure FPolicy<a href="#manually-configure-fpolicy" class="hash-link" aria-label="Direct link to Manually Configure FPolicy" title="Direct link to Manually Configure FPolicy">​</a></h2>
<p>This section describes how to manually configure FPolicy. Manual configuration of the FPolicy is recommended if the policy needs to be scoped to monitor select volumes or shares. It is necessary to create several FPolicy components and then enable the FPolicy. See the sections corresponding to each part of this list:</p>
<ul>
<li>
<p>Part 1: Install Server Certificate on the SVM (only if using TLS authentication)</p>
<ul>
<li>This is only needed if using either of the TLS, … authentication options.</li>
</ul>
</li>
<li>
<p>Part 2: Create External Engine</p>
<ul>
<li>The External Engine defines how FPolicy makes and manages connections to external FPolicy servers like Activity Monitor Agent.</li>
</ul>
</li>
<li>
<p>Part 3: Create FPolicy Events</p>
<ul>
<li>An FPolicy event defines which protocol(s) to monitor and which file access events to monitor.</li>
</ul>
</li>
<li>
<p>Part 4: Create Persistent Store (only if Persistent Store is used. RECOMMENDED)</p>
<ul>
<li>A Persistent Store is used as a temporary on-disk storage before the events are sent to Activity Monitor Agent.</li>
</ul>
</li>
<li>
<p>Part 5: Create FPolicy Policy</p>
<ul>
<li>The FPolicy policy associates the other three FPolicy components and allows for the designation of a privileged FPolicy user</li>
<li>If running the Access Auditing (FSAA), Activity Auditing (FSAC), and/or Sensitive Data Discovery Auditing scans, then this is the user account credential to be added to the Access Analyzer Connection Profile.</li>
</ul>
</li>
<li>
<p>Part 6: Create FPolicy Scope</p>
<ul>
<li>The FPolicy scope creates the filters necessary to perform scans on specific shares or volumes.</li>
</ul>
</li>
<li>
<p>Part 7: Set TLS Authentication (optional)</p>
<ul>
<li>This is only needed if using either of the TLS authentication options.</li>
</ul>
</li>
<li>
<p>Part 8: Enable the FPolicy</p>
<ul>
<li>Once the FPolicy is enabled, the Activity Monitor Agent can be configured to monitor the SVM.</li>
</ul>
</li>
<li>
<p>Part 9: Connect FPolicy Server / Agent to Cluster Node (optional)</p>
<ul>
<li>This is only needed if there is an issue with connection to the Cluster node or for troubleshooting a disconnection issue.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-install-server-certificate-on-the-svm">Part 1: Install Server Certificate on the SVM<a href="#part-1-install-server-certificate-on-the-svm" class="hash-link" aria-label="Direct link to Part 1: Install Server Certificate on the SVM" title="Direct link to Part 1: Install Server Certificate on the SVM">​</a></h3>
<p>If using the TLS authentication options, it is necessary to install the Server Certificate on the SVM.</p>
<p>Use the following command to install the Server Certificate:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate install type client-ca -vserver [SVM_NAME]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate install type client-ca -vserver testserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command will ask you to provide a public certificate. Copy the public key from the Server Certificate PEM file, i.e. the block starting with &quot;<code>-----BEGIN CERTIFICATE-----</code>&quot; and ending with &quot;<code>-----END CERTIFICATE-----</code>&quot;. Paste the block to the terminal window.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-1-server-certificate-install">Validate Part 1: Server Certificate Install<a href="#validate-part-1-server-certificate-install" class="hash-link" aria-label="Direct link to Validate Part 1: Server Certificate Install" title="Direct link to Validate Part 1: Server Certificate Install">​</a></h4>
<p>Run the following command to validate the Server Certificate is installed:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate show -vserver [SVM_NAME] -commonname [ACTIVITY_AGENT_SERVER_NAME] -type client-ca instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">security certificate show -vserver testserver -commonname testagentserver -type client-ca instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-create-external-engine">Part 2: Create External Engine<a href="#part-2-create-external-engine" class="hash-link" aria-label="Direct link to Part 2: Create External Engine" title="Direct link to Part 2: Create External Engine">​</a></h3>
<p>The External Engine defines how FPolicy makes and manages connections to external FPolicy servers.</p>
<p>IMPORTANT:</p>
<ul>
<li>
<p>The <code>-primary-servers</code> must be the server or servers hosting the Activity Monitor Agent.</p>
</li>
<li>
<p>If intending to use the Activity Monitor with Access Analyzer, then the primary server must also be the proxy server from which the Access Analyzer Access Auditing (FSAC) scans are running, e.g. the Access Analyzer Console server for local mode or the proxy server if running in any of the proxy mode options.</p>
</li>
<li>
<p>The following values are required:</p>
<ul>
<li><code>engine-name StealthAUDITEngine</code>, the names of the external engine object can be customized (see below).</li>
<li><code>port 9999</code>, Port number can be customized, but it is recommended to use 9999.</li>
<li><code>extern-engine-type asynchronous</code></li>
<li><code>ssl-option no-auth</code></li>
<li><code>send-buffer-size 6291456</code>, for ONTAP 9.10+ use <code>send-buffer-size 8388608</code></li>
</ul>
</li>
</ul>
<p><strong>CAUTION:</strong> All parameters are case sensitive.</p>
<p>Use the following command to create the external engine:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set -privilege advanced  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine create -vserver [SVM_NAME] -engine-name StealthAUDITEngine -primary-servers [IP_ADDRESS,…] -port 9999 -extern-engine-type asynchronous -ssl-option no-auth -send-buffer-size 6291456</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set -privilege advanced  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine create -vserver testserver -engine-name StealthAUDITEngine -primary-servers 192.168.30.15 -port 9999 -extern-engine-type asynchronous -ssl-option no-auth -send-buffer-size 6291456</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-2-external-engine-creation">Validate Part 2: External Engine Creation<a href="#validate-part-2-external-engine-creation" class="hash-link" aria-label="Direct link to Validate Part 2: External Engine Creation" title="Direct link to Validate Part 2: External Engine Creation">​</a></h4>
<p>Run the following command to validate the creation of the external engine:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy policy external-engine show -vserver [SVM_NAME] -engine-name StealthAUDITEngine -instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verify that the output is displayed as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy policy external-engine show -vserver svm0 -engine-name StealthAUDITEngine -instance  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy policy external-engine show)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                Vserver: svm0  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 Engine: StealthAUDITEngine  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Primary FPolicy Servers: 192.168.11.35  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Port Number of FPolicy Service: 9999  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Secondary FPolicy Servers: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   External Engine Type: asynchronous  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SSL Option for External Communication: no-auth  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             FQDN or Custom Common Name: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           Serial Number of Certificate: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Certificate Authority: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Is Resiliency Feature Enabled: false  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Maximum Notification Retention Duration: 3m  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Directory for Notification Storage: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 External Engine Format: xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relevant NetApp Documentation: To learn more about creating an external engine, please visit the NetApp website and read the <a href="https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-external-engine-create.html" target="_blank" rel="noopener noreferrer">vserver fpolicy policy external-engine create</a> article.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-create-fpolicy-event">Part 3: Create FPolicy Event<a href="#part-3-create-fpolicy-event" class="hash-link" aria-label="Direct link to Part 3: Create FPolicy Event" title="Direct link to Part 3: Create FPolicy Event">​</a></h3>
<p>An event defines which protocol to monitor and which file access events to monitor.</p>
<p>IMPORTANT:</p>
<ul>
<li>
<p>The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored.</p>
</li>
<li>
<p>Access Analyzer and the Activity Monitor are capable of monitoring both NFS and CIFS. However, it is necessary to create separate events for each protocol.</p>
</li>
<li>
<p>The following values are required:</p>
<ul>
<li>
<p><code>event-name</code></p>
<ul>
<li>For CIFS shares – <code> StealthAUDITScreeningCifs</code> for successful events; <code>StealthAUDITScreeningFailedCifs</code> for failed events.</li>
<li>For NFS shares – <code>StealthAUDITScreeningNfsV3, StealthAUDITScreeningNfsV4</code> for successful events; <code>StealthAUDITScreeningFailedNfsV3, StealthAUDITScreeningFailedNfsV4</code> for failed events.<br>
<!-- -->The names of the event objects can be customized (see <a href="#customization-of-fpolicy-object-names">Customization of FPolicy Object Names</a>).</li>
</ul>
</li>
<li>
<p><code>volume-operation true</code></p>
</li>
<li>
<p><code>protocol</code> – one of the following <code>cifs</code>, <code>nfsv3</code>, <code>nfsv4</code></p>
</li>
<li>
<p><code>monitor-fileop-failure</code> – <code>true </code>or <code>false</code>, indicates whether failed file operations are reported.</p>
</li>
</ul>
</li>
<li>
<p>Limiting the file operations to be monitored is an excellent way to limit the performance impact the FPolicy will have on the NetApp device. The file operations from which to choose are below with additional filter options:</p>
<ul>
<li>
<p><code>create</code> – File create operations</p>
</li>
<li>
<p><code>create_dir</code> – Directory create operations</p>
</li>
<li>
<p><code>close</code> – File close operations</p>
<ul>
<li>Enable this operation for NFSv4 to capture all read operations</li>
</ul>
</li>
<li>
<p><code>delete</code> – File delete operations</p>
</li>
<li>
<p><code>delete_dir</code> – Directory delete operations</p>
</li>
<li>
<p><code>link</code> – Link operations</p>
</li>
<li>
<p><code>open</code> – File open operations for CIFS protocol</p>
<ul>
<li>
<p><code>open-with-delete-intent</code> – Limits notification to only when an attempt is made to open a file with the intent to delete it, according to the <code>FILE_DELETE_ON_CLOSE</code> flag specification</p>
<p><strong>NOTE:</strong> File open operations are only supported with the <code>open-with-delete-intent</code> filter applied.</p>
</li>
</ul>
</li>
<li>
<p><code>read</code> – File read operations</p>
<ul>
<li><code>first-read</code> – Limits notification to only first read operations for CIFS protocol. For ONTAP 9.2+, this filter can be used for both CIFS and NFS protocols.</li>
</ul>
</li>
<li>
<p><code>rename</code>– File rename operations</p>
</li>
<li>
<p><code>rename_dir</code>– Directory rename operations</p>
</li>
<li>
<p><code>setattr</code> – Set attribute operations and permission changes. The following filters are available for ONTAP 9.0+ to limit events to permission changes only:</p>
<ul>
<li>
<p>CIFS:</p>
<ul>
<li><code>setattr-with-owner-change</code></li>
<li><code>setattr-with-group-change</code></li>
<li><code>setattr-with-sacl-change</code></li>
<li><code>setattr-with-dacl-change</code></li>
</ul>
</li>
<li>
<p>NFSv3:</p>
<ul>
<li><code>setattr-with-owner-change</code></li>
<li><code>setattr-with-group-change</code></li>
<li><code>setattr-with-mode-change</code></li>
</ul>
</li>
<li>
<p>NFSv4:</p>
<ul>
<li><code>setattr-with-owner-change</code></li>
<li><code>setattr-with-group-change</code></li>
<li><code>setattr-with-mode-change</code></li>
<li><code>setattr-with-sacl-change</code></li>
<li><code>setattr-with-dacl-change</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>symlink</code> – Symbolic link operations</p>
</li>
<li>
<p><code>write</code> – File write operations</p>
<ul>
<li><code>first-write</code> – Limits notification to only first write operations for CIFS protocol. For ONTAP 9.2+, this filter can be used for both CIFS and NFS protocols.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>For failed/denied events, the list of supported file operations is limited to the following values:</p>
<ul>
<li>CIFS: <code>open</code></li>
<li>NFSv3: <code>create, create_dir, read, write, delete, delete_dir, rename, rename_dir, setattr, link</code></li>
<li>NFSv4: <code>open, create, create_dir, read, write, delete, delete_dir, rename, rename_dir, setattr, link</code></li>
</ul>
</li>
</ul>
<p><strong>CAUTION:</strong> All parameters are case sensitive.</p>
<p>Use the following command to create the FPolicy event for CIFS protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningCifs -volume-operation true -protocol cifs -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningCifs -volume-operation true -protocol cifs -file-operations create,create_dir,delete,delete_dir,open,read,write,rename,rename_dir,setattr -filters first-read,first-write,open-with-delete-intent,setattr-with-owner-change,setattr-with-group-change,setattr-with-sacl-change,setattr-with-dacl-change</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following command to create the FPolicy event for NFSv3 protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningNfsV3 -volume-operation true -protocol nfsv3 -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningNfsV3 -volume-operation true -protocol nfsv3 -file-operations create,create_dir,delete,delete_dir,read,write,rename,rename_dir,setattr,link,symlink -filters first-read,first-write,setattr-with-owner-change,setattr-with-group-change,setattr-with-mode-change</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following command to create the FPolicy event for NFSv4 protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver [SVM_NAME] -event-name StealthAUDITScreeningNfsV4 -volume-operation true -protocol nfsv4 -file-operations [COMMA_SEPARATED_FILE_OPERATIONS] -filters [COMMA_SEPARATED_FILTERS]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy event create -vserver testserver -event-name StealthAUDITScreeningNfsV4 -volume-operation true -protocol nfsv4 -file-operations create,create_dir,delete,delete_dir,read,write,rename,rename_dir,setattr,link,symlink,close -filters setattr-with-group-change,setattr-with-mode-change,setattr-with-sacl-change,setattr-with-dacl-change</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-3-fpolicy-event-creation">Validate Part 3: FPolicy Event Creation<a href="#validate-part-3-fpolicy-event-creation" class="hash-link" aria-label="Direct link to Validate Part 3: FPolicy Event Creation" title="Direct link to Validate Part 3: FPolicy Event Creation">​</a></h4>
<p>Run the following command to validate the creation of the FPolicy event:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy policy event show -vserver [SVM_NAME] -event-name [StealthAUDITScreeningCifs or StealthAUDITScreeningNfsV3 or StealthAUDITScreeningNfsV4 or ...] -instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy policy event show -vserver [SVM_NAME] -event-name StealthAUDITScreeningCifs -instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verify that the output is displayed as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy policy event show -vserver svm0 -event-name StealthAUDITScreeningCifs  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy policy event show)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 Vserver: svm0  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   Event: StealthAUDITScreeningCifs  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                Protocol: cifs  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         File Operations: create, create_dir, delete,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          delete_dir, open, read, write,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          rename, rename_dir, setattr  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 Filters: first-read, first-write,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          open-with-delete-intent,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          setattr-with-owner-change,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          setattr-with-group-change,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          setattr-with-sacl-change,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          setattr-with-dacl-change,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          setattr-with-mode-change  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Send Volume Operation Notifications: true  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send Failed File Operation Notifications: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relevant NetApp Documentation: To learn more about creating an event, please visit the NetApp website and read the <a href="https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-event-create.html" target="_blank" rel="noopener noreferrer">vserver fpolicy policy event create</a> article.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-4-create-persistent-store">Part 4: Create Persistent Store<a href="#part-4-create-persistent-store" class="hash-link" aria-label="Direct link to Part 4: Create Persistent Store" title="Direct link to Part 4: Create Persistent Store">​</a></h3>
<p>The Persistent Store provides a temporary on-disk storage for activity events before they are sent to Activity Monitor Agent. The Persistent Store is optional but recommended for ONTAP 9.15.1 and later versions.</p>
<p>IMPORTANT:</p>
<ul>
<li>
<p>Persistent Store is supported for ONTAP 9.15.1 and later versions.</p>
</li>
<li>
<p>The SVM used must be the one hosting the CIFS or NFS shares to be monitored.</p>
</li>
<li>
<p>There is no need to use an existing volume. A new volume will be created automatically and managed by the FPolicy subsystem.</p>
</li>
<li>
<p>The volume size depends on the duration for which the events persist and the event rate. For example, if you want 30 minutes of events to persist in an SVM with a capacity of 5000 events/second and the average event record size of 0.6 KB, the required volume size is <code>5000 * 30 * 60 * 0.6 KB = 5400000 KB ≈ 5 GB</code>.</p>
</li>
<li>
<p>For the Persistent Store to create a volume automatically, at least one local tier (aggregate) must be assigned to the SVM. Use <code>vserver add-aggregates</code> to assign local tiers.</p>
<p>The following values are required:</p>
<ul>
<li>
<p><code>vserver</code> – The name of the SVM where you want to create the Persistent Store.</p>
</li>
<li>
<p><code>persistent-store</code> – The name of the Persistent Store object.</p>
<ul>
<li>The default name is <code>StealthAUDITPersistentStore</code>.<br>
<!-- -->The names of the event objects can be customized (see <a href="#customization-of-fpolicy-object-names">Customization of FPolicy Object Names</a>).</li>
</ul>
</li>
<li>
<p><code>volume</code> – The name of the volume used for event storage.</p>
<ul>
<li>If the volume does not exist, it will be automatically created on an assigned local tier. This is recommended.</li>
</ul>
</li>
<li>
<p><code>size</code> – The initial size of the volume. The format is <code>&lt;integer&gt;[KB|MB|GB]</code>.</p>
</li>
</ul>
<p>The following values are optional:</p>
<ul>
<li><code>autosize-mode</code> – Specifies the auto size behavior for the volume. Options include <code>off</code> (default), <code>grow</code>, or <code>grow_shrink</code>.</li>
</ul>
</li>
</ul>
<p><strong>CAUTION:</strong> All parameters are case sensitive.</p>
<p>Use the following command to create the Persistent Store:</p>
<p>vserver fpolicy persistent-store create -vserver [SVM_NAME] -persistent-store [STORE_NAME] -volume [VOLUME_NAME] -size [SIZE] -autosize-mode [AUTOSIZE]</p>
<p>Example:</p>
<p>vserver fpolicy persistent-store create -vserver testserver -persistent-store StealthAUDITPersistentStore -volume testserver_ps_vol -size 5GB -autosize-mode grow_shrink</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-4-create-persistent-store">Validate Part 4: Create Persistent Store<a href="#validate-part-4-create-persistent-store" class="hash-link" aria-label="Direct link to Validate Part 4: Create Persistent Store" title="Direct link to Validate Part 4: Create Persistent Store">​</a></h4>
<p>Run the following command to validate the creation of the Persistent Store:</p>
<p>vserver fpolicy persistent-store show -vserver [SVM_NAME] -persistent-store StealthAUDITPersistentStore -instance</p>
<p>Ensure that the output is displayed as follows:</p>
<p>cluster1::&gt; vserver fpolicy persistent-store show -vserver testserver -persistent-store StealthAUDITPersistentStore -instance<br>
<!-- -->Vserver: testserver<br>
<!-- -->Persistent Store Name: StealthAUDITPersistentStore<br>
<!-- -->Volume name of the Persistent store: testserver_ps_vol<br>
<!-- -->Size of the Persistent Store: 5GB<br>
<!-- -->Autosize Mode for the Volume: grow_shrink</p>
<p>Visit the NetApp website and see the <a href="https://docs.netapp.com/us-en/ontap-cli/vserver-fpolicy-persistent-store-create.html" target="_blank" rel="noopener noreferrer">vserver fpolicy persistent store create</a> article for additional information about creating a Persistent Store.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-5-create-fpolicy-policy">Part 5: Create FPolicy Policy<a href="#part-5-create-fpolicy-policy" class="hash-link" aria-label="Direct link to Part 5: Create FPolicy Policy" title="Direct link to Part 5: Create FPolicy Policy">​</a></h3>
<p>The FPolicy policy associates the other three FPolicy components and allows for the designation of a privileged FPolicy user, or the provisioned FPolicy account. If running the Access Auditing (FSAA), Activity Auditing (FSAC), and/or Sensitive Data Discovery Auditing scans in Access Analyzer, then this is also the user account credential to be added to the Access Analyzer Connection Profile.</p>
<p>IMPORTANT:</p>
<ul>
<li>
<p>To monitor both CIFS and NFS protocols, two FPolicy Event were created. Multiple events can be included in the FPolicy policy.</p>
</li>
<li>
<p>The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored.</p>
</li>
<li>
<p>The External Engine, FPolicy Event, Persistent Store used in this command must be configuration objects created in the preceding steps.</p>
<p>The following values are required:</p>
<ul>
<li><code>vserver</code> – The name of SVM.</li>
<li><code>policy-name StealthAUDIT</code> – The name of the policy object can be customized (see <a href="#customization-of-fpolicy-object-names">Customization of FPolicy Object Names</a>).</li>
<li><code>engine</code> – The name of the External Engine created in <a href="#part-2-create-external-engine">Part 2: Create External Engine</a>.</li>
<li><code>events</code> – A list of FPolicy Event objects created in <a href="#part-3-create-fpolicy-event">Part 3: Create FPolicy Event</a>.</li>
<li><code>persistent-store</code> – The name of the Persistent Store created in <a href="#part-4-create-persistent-store">Part 4: Create Persistent Store</a>. Required only if the Persistent Store is used.</li>
</ul>
<p>The following values are required for Access Analyzer integration:</p>
<ul>
<li><code>privileged-user-name</code> – Must be a provisioned FPolicy account.</li>
<li><code>allow-privileged-access</code> – Set to yes.</li>
</ul>
</li>
</ul>
<p><strong>CAUTION:</strong> All parameters are case sensitive.</p>
<p>Use the following command to create the FPolicy policy to monitor both CIFS and NFS protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningCifs,StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\DOMAINUSER]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningCifs,StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\user1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following command to create the FPolicy policy to monitor only CIFS protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningCifs -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\DOMAINUSER]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningCifs -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\user1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following command to create the FPolicy policy to monitor only NFS protocols:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver [SVM_NAME] -policy-name StealthAUDIT -events StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name [DOMAIN\DOMAINUSER]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy create -vserver testserver -policy-name StealthAUDIT -events StealthAUDITScreeningNfsV3,StealthAUDITScreeningNfsV4 -engine StealthAUDITEngine -persistent-store StealthAUDITPersistentStore -is-mandatory false -allow-privileged-access yes -privileged-user-name example\user1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-5-fpolicy-policy-creation">Validate Part 5: FPolicy Policy Creation<a href="#validate-part-5-fpolicy-policy-creation" class="hash-link" aria-label="Direct link to Validate Part 5: FPolicy Policy Creation" title="Direct link to Validate Part 5: FPolicy Policy Creation">​</a></h4>
<p>Run the following command to validate the creation of the FPolicy policy:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy policy show -vserver [SVM_NAME] -policy-name StealthAUDIT -instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy policy show -instance  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy policy show)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Vserver: svm0  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         Policy: StealthAUDIT  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Events to Monitor: StealthAUDITScreeningCifs,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 StealthAUDITScreeningFailedCifs,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 StealthAUDITScreeningNfsV3,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 StealthAUDITScreeningFailedNfsV3,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 StealthAUDITScreeningNfsV4,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 StealthAUDITScreeningFailedNfsV4  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 FPolicy Engine: StealthAUDITEngine  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Is Mandatory Screening Required: false  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Allow Privileged Access: no  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Name for Privileged Access: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Is Passthrough Read Enabled: false  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Persistent Store Name: -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relevant NetApp Documentation: To learn more about creating a policy, please visit the NetApp website and read the <a href="https://docs.netapp.com/us-en/ontap-cli/vserver-fpolicy-policy-create.html" target="_blank" rel="noopener noreferrer">vserver fpolicy policy create</a> article.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-6-create-fpolicy-scope">Part 6: Create FPolicy Scope<a href="#part-6-create-fpolicy-scope" class="hash-link" aria-label="Direct link to Part 6: Create FPolicy Scope" title="Direct link to Part 6: Create FPolicy Scope">​</a></h3>
<p>The FPolicy scope creates the filters necessary to perform scans on specific shares or volumes. It is possible to set the scope to monitor all volumes or all shares by replacing the volume/share name variable [SVM_NAME] in the command with an asterisk (*).</p>
<p>IMPORTANT:</p>
<ul>
<li>The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored.</li>
<li>It is not necessary to specify both volumes and shares. One or the other is sufficient.</li>
<li>If you want to monitor everything, set the &quot;<code>volumes-to-include</code>&quot; value to &quot;<code>*</code>&quot;.</li>
</ul>
<p>Use the following command to create the FPolicy scope by specifying volume(s):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy scope create -vserver [SVM_NAME] -policy-name StealthAUDIT -volumes-to-include [VOLUME_NAME],[VOLUME_NAME]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy scope create -vserver testserver -policy-name StealthAUDIT -volumes-to-include samplevolume1,samplevolume2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following command to create the FPolicy scope by specifying share(s):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy scope create -vserver [SVM_NAME] -policy-name StealthAUDIT -shares-to-include [SHARE_NAME],[SHARE_NAME]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy scope create -vserver testserver -policy-name StealthAUDIT -shares-to-include sampleshare1,sampleshare2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-6-fpolicy-scope-creation">Validate Part 6: FPolicy Scope Creation<a href="#validate-part-6-fpolicy-scope-creation" class="hash-link" aria-label="Direct link to Validate Part 6: FPolicy Scope Creation" title="Direct link to Validate Part 6: FPolicy Scope Creation">​</a></h4>
<p>Run the following command to validate the FPolicy scope creation:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy policy scope show -instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy policy scope show -instance  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy policy scope show)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   Vserver: svm0  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Policy: StealthAUDIT  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Shares to Include: *  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Shares to Exclude: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Volumes to Include: *  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Volumes to Exclude: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export Policies to Include: *  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export Policies to Exclude: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File Extensions to Include: -  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File Extensions to Exclude: -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relevant NetApp Documentation: To learn more about creating scope, please visit the NetApp website and read the <a href="https://docs.netapp.com/us-en/ontap-cli-9141/vserver-fpolicy-policy-scope-create.html" target="_blank" rel="noopener noreferrer">vserver fpolicy policy scope create</a> article.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-7-set-tls-authentication">Part 7: Set TLS Authentication<a href="#part-7-set-tls-authentication" class="hash-link" aria-label="Direct link to Part 7: Set TLS Authentication" title="Direct link to Part 7: Set TLS Authentication">​</a></h3>
<p>If using the TLS authentication options, it is necessary to set authentication for the type of authentication.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-server-authentication">Set Server-Authentication<a href="#set-server-authentication" class="hash-link" aria-label="Direct link to Set Server-Authentication" title="Direct link to Set Server-Authentication">​</a></h4>
<p>Use the following command to set server-authentication:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy externalengine modify -vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option server-auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy externalengine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option server-auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-mutual-authentication">Set Mutual-Authentication<a href="#set-mutual-authentication" class="hash-link" aria-label="Direct link to Set Mutual-Authentication" title="Direct link to Set Mutual-Authentication">​</a></h4>
<p>Use the following command to set mutual-authentication:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine modify ‑vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name [COMMON_NAME] -certificate-serial [CERTIFICATE_SERIAL] -certificate-ca [CERTIFICATE_AUTHORITY]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name testserver -certificate-serial 461AC46521B31321330EBBE4321AC51D -certificate-ca &quot;VeriSign Universal Root Certification Authority&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-mutual-authentication-is-set">Validate Mutual-Authentication Is Set<a href="#validate-mutual-authentication-is-set" class="hash-link" aria-label="Direct link to Validate Mutual-Authentication Is Set" title="Direct link to Validate Mutual-Authentication Is Set">​</a></h4>
<p>Run the following command to confirm mutual-authentication is set:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine show -fields ssl-option</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-8-enable-the-fpolicy">Part 8: Enable the FPolicy<a href="#part-8-enable-the-fpolicy" class="hash-link" aria-label="Direct link to Part 8: Enable the FPolicy" title="Direct link to Part 8: Enable the FPolicy">​</a></h3>
<p>The FPolicy must be enabled before the Activity Monitor Agent can be configured to monitor the SVM.</p>
<p>IMPORTANT:</p>
<ul>
<li>The SVM used must be the SVM hosting the CIFS or NFS shares to be monitored.</li>
</ul>
<p>Use the following command to enable the FPolicy:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy enable -vserver [SVM_NAME] -policy-name StealthAUDIT -sequence-number [INTEGER]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy enable -vserver testserver -policy-name StealthAUDIT -sequence-number 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-8-fpolicy-enabled">Validate Part 8: FPolicy Enabled<a href="#validate-part-8-fpolicy-enabled" class="hash-link" aria-label="Direct link to Validate Part 8: FPolicy Enabled" title="Direct link to Validate Part 8: FPolicy Enabled">​</a></h4>
<p>Run the following command to validate the FPolicy scope creation:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy show  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    show                             show-enabled  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    show-engine                      show-passthrough-read-connection  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy show  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy show)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      Sequence  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vserver       Policy Name               Number  Status   Engine  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------- ----------------------- --------  -------- ---------  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svm0          StealthAUDIT                  10  on       StealthAU  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                         DITEngine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relevant NetApp Documentation: To learn more about enabling a policy, please visit the NetApp website and read the <a href="https://docs.netapp.com/us-en/ontap-cli-9121//vserver-fpolicy-enable.html" target="_blank" rel="noopener noreferrer">vserver fpolicy enable</a> article.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-9-connect-fpolicy-server--agent-to-cluster-node">Part 9: Connect FPolicy Server / Agent to Cluster Node<a href="#part-9-connect-fpolicy-server--agent-to-cluster-node" class="hash-link" aria-label="Direct link to Part 9: Connect FPolicy Server / Agent to Cluster Node" title="Direct link to Part 9: Connect FPolicy Server / Agent to Cluster Node">​</a></h3>
<p>Manually connecting the FPolicy server (or Agent server) to the Cluster Node is only needed if there is an issue with connection to the Cluster Node or for troubleshooting a disconnection issue.</p>
<p>Use the following command to connect the <code>StealthAUDITEngine</code> that belongs to the <code>StealthAUDIT</code> policy to all Cluster Nodes:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">policy engine-connect -vserver [SVM_NAME] -policy-name StealthAUDIT -node *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">policy engine-connect -vserver testserver -policy-name StealthAUDIT -node *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-part-9-connection-to-cluster-node">Validate Part 9: Connection to Cluster Node<a href="#validate-part-9-connection-to-cluster-node" class="hash-link" aria-label="Direct link to Validate Part 9: Connection to Cluster Node" title="Direct link to Validate Part 9: Connection to Cluster Node">​</a></h4>
<p>Run the following command to validate connection to the Cluster Node:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fpolicy show-engine -vserver [SVM_NAME] -policy-name StealthAUDIT -node *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Ontap915::&gt; fpolicy show-engine -vserver svm0 -policy-name StealthAUDIT -node *  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (vserver fpolicy show-engine)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   FPolicy           Server         Server  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vserver Policy Name   Node         Server            Status         Type  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------- ------------- ------------ ----------------- -------------- -----------  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svm0    StealthAUDIT  Ontap915-01  192.168.11.35     disconnected   primary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automatic-configuration-of-fpolicy">Automatic Configuration of FPolicy<a href="#automatic-configuration-of-fpolicy" class="hash-link" aria-label="Direct link to Automatic Configuration of FPolicy" title="Direct link to Automatic Configuration of FPolicy">​</a></h2>
<p>The Activity Monitor can automatically configure FPolicy on the targeted SVM. The FPolicy created will monitor file system activity from all volumes and shares of the SVM. This feature can be enabled using the <strong>Configure FPolicy. Create or modify FPolicy objects if needed</strong> checkbox on the FPolicy page in the monitored host&#x27;s properties in the Activity Monitor.</p>
<p>Starting ONTAP 9.15.1 and later versions, it is recommended to enable the Persistent Store feature that stores events on disk before they are sent to the Activity Monitor Agent. This reduces client-side latency and increases resilience during network delays or bursts of activity. To enable the Persistent Store, specify a volume name and size on the Persistent Store tab of the FPolicy page in the monitored host properties. The volume will be automatically created if it does not already exist. See the <a href="#persistent-store">Persistent Store</a> topic for additional information on the recommended volume size.</p>
<p>If using the TLS, mutual authentication option, you will need to create the PEM file for the Client Certification, which is needed during the monitored host configuration in the Activity Monitor. It will also be necessary to set mutual authentication on the SVM.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-tls-mutual-authentication">Set TLS Mutual-Authentication<a href="#set-tls-mutual-authentication" class="hash-link" aria-label="Direct link to Set TLS Mutual-Authentication" title="Direct link to Set TLS Mutual-Authentication">​</a></h3>
<p>If using the TLS, mutual authentication options, it is necessary to set authentication.</p>
<p>Use the following command to set mutual-authentication:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine modify -vserver [SVM_NAME] -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name [COMMON_NAME] -certificate-serial [CERTIFICATE_SERIAL] -certificate-ca [CERTIFICATE_AUTHORITY]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine modify -vserver testserver -engine-name StealthAUDITEngine -ssl-option mutual-auth -certificate-common-name testserver -certificate-serial 461AC46521B31321330EBBE4321AC51D -certificate-ca &quot;VeriSign Universal Root Certification Authority&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validate-mutual-authentication">Validate: Mutual-Authentication<a href="#validate-mutual-authentication" class="hash-link" aria-label="Direct link to Validate: Mutual-Authentication" title="Direct link to Validate: Mutual-Authentication">​</a></h4>
<p>Run the following command to confirm mutual-authentication is set:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vserver fpolicy policy external-engine show -fields ssl-option</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="customization-of-fpolicy-object-names">Customization of FPolicy Object Names<a href="#customization-of-fpolicy-object-names" class="hash-link" aria-label="Direct link to Customization of FPolicy Object Names" title="Direct link to Customization of FPolicy Object Names">​</a></h2>
<p>Activity Monitor uses the following FPolicy object names by default:</p>
<ul>
<li>Policy name – <code>StealthAUDIT</code></li>
<li>External Engine name – <code>StealthAUDITEngine</code></li>
<li>CIFS Event name – <code>StealthAUDITScreeningCifs</code></li>
<li>NFS v3 Event name – <code>StealthAUDITScreeningNfsV3</code></li>
<li>NFS v4 Event name – <code>StealthAUDITScreeningNfsV4</code></li>
<li>Failed CIFS Event name – <code>StealthAUDITScreeningFailedCifs</code></li>
<li>Failed NFS v3 Event name – <code>StealthAUDITScreeningFailedNfsV3</code></li>
<li>Failed NFS v4 Event name – <code>StealthAUDITScreeningFailedNfsV4</code></li>
<li>Persistent Store name – <code>StealthAUDITPersistentStore</code></li>
</ul>
<p>These names can be customized in the monitored host&#x27;s settings in the Activity Monitor. It can be useful in two scenarios:</p>
<ul>
<li>You want the names to match the company policies;</li>
<li>You want to configure FPolicy manually using your custom names, but also want to leverage the &quot;Enable and Connect FPolicy&quot; feature of the Activity Monitor, so that the product ensures that FPolicy stays enabled and connected at all times.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/accessanalyzer/config/netappcmode/configurefpolicy.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/accessanalyzer/config/netappcmode/configurefirewall"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configure Network</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/accessanalyzer/config/netappcmode/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">NetApp Data ONTAP Cluster-Mode Target Requirements</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tls-authentication-options" class="table-of-contents__link toc-highlight">TLS Authentication Options</a><ul><li><a href="#generate-server-certificate" class="table-of-contents__link toc-highlight">Generate Server Certificate</a></li><li><a href="#create-pem-file-for-client-certificate" class="table-of-contents__link toc-highlight">Create PEM File for Client Certificate</a></li></ul></li><li><a href="#persistent-store" class="table-of-contents__link toc-highlight">Persistent Store</a></li><li><a href="#manually-configure-fpolicy" class="table-of-contents__link toc-highlight">Manually Configure FPolicy</a><ul><li><a href="#part-1-install-server-certificate-on-the-svm" class="table-of-contents__link toc-highlight">Part 1: Install Server Certificate on the SVM</a></li><li><a href="#part-2-create-external-engine" class="table-of-contents__link toc-highlight">Part 2: Create External Engine</a></li><li><a href="#part-3-create-fpolicy-event" class="table-of-contents__link toc-highlight">Part 3: Create FPolicy Event</a></li><li><a href="#part-4-create-persistent-store" class="table-of-contents__link toc-highlight">Part 4: Create Persistent Store</a></li><li><a href="#part-5-create-fpolicy-policy" class="table-of-contents__link toc-highlight">Part 5: Create FPolicy Policy</a></li><li><a href="#part-6-create-fpolicy-scope" class="table-of-contents__link toc-highlight">Part 6: Create FPolicy Scope</a></li><li><a href="#part-7-set-tls-authentication" class="table-of-contents__link toc-highlight">Part 7: Set TLS Authentication</a></li><li><a href="#part-8-enable-the-fpolicy" class="table-of-contents__link toc-highlight">Part 8: Enable the FPolicy</a></li><li><a href="#part-9-connect-fpolicy-server--agent-to-cluster-node" class="table-of-contents__link toc-highlight">Part 9: Connect FPolicy Server / Agent to Cluster Node</a></li></ul></li><li><a href="#automatic-configuration-of-fpolicy" class="table-of-contents__link toc-highlight">Automatic Configuration of FPolicy</a><ul><li><a href="#set-tls-mutual-authentication" class="table-of-contents__link toc-highlight">Set TLS Mutual-Authentication</a></li></ul></li><li><a href="#customization-of-fpolicy-object-names" class="table-of-contents__link toc-highlight">Customization of FPolicy Object Names</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>