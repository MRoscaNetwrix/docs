---
title: Database Stored Procedures
sidebar_label: Stored Procedures
description: Database stored procedures for maintenance operations including archiving, cleanup, and performance optimization tasks.
---

# Stored Procedures

The table contains a list of the stored procedures Threat Prevention uses on its SQL Server
databases. See the [Database Maintenance Window](/docs/threatprevention/7.5/admin/configuration/databasemaintenance/overview.md) topic for additional information.

| Name                     | When Threat Prevention Uses the Procedure                                                                                     | What the Stored Procedure Does                                                                                                                                                                                                                                                                                                                                                                               |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| DeleteAuthAnalytics      | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance for Authentication Analytics.     | This stored procedure deletes “old” data from the database in the following tables: - A_Login - A_Login2Policy - AR_BruteForceAttacks - AR_UserAccountHackingAttacks - AR_HorizontalMovementAttacks - AR_BadUserIdByUser - AR_BadUserIdByHost - AR_BreachedPassword - AR_ConcurrentLogins - AR_DiamondPAC - AR_EventTracker - AR_ImpersonationLogins - AR_GoldenTickets - AR_KerberosWeakEncryption          |
| DeleteByPolicy           | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance for selected policies.            | This stored procedure deletes “old” data from the database in the following tables: - NvEvent - NvEvent_EventTracker - AttributeValue - OldAttributeValue - EventPolicy - E_LDAP - E_LDAP_EventTracker - E_LDAP2Policy                                                                                                                                                                                       |
| DeleteFSAnalytics        | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance File System Analytics.            | This stored procedure deletes “old” data from the database in the following tables: - A_FS - A_FS2Policy - AR_FilesPerUser - AR_EventTracker                                                                                                                                                                                                                                                                 |
| Delete LDAP              | Called from the SQL Agent job if the “Delete” operation is selected for database maintenance for the LDAP Event Type.         | This stored procedure deletes “old” data from the database in the following tables: - E_LDAP - E_LDAP_EventTracker - E_LDAP2Policy                                                                                                                                                                                                                                                                           |
| DeleteNvEventByEventType | Called from the SQL Agent job if the “Delete” operation is selected for database maintenance for all Event Types except LDAP. | This stored procedure deletes “old” data from the database in the following tables: - NvEvent - NvEvent_EventTracker - AttributeValue - OldAttributeValue - EventPolicy                                                                                                                                                                                                                                      |
| MoveAuthAnalytics        | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for Authentication Analytics.       | This stored procedure moves “old” data from one database to another in the following tables: - A_Login - A_Login2Policy - AR_BruteForceAttacks - AR_UserAccountHackingAttacks - AR_HorizontalMovementAttacks - AR_BadUserIdByUser - AR_BadUserIdByHost - AR_BreachedPassword - AR_ConcurrentLogins - AR_DiamondPAC - AR_EventTracker - AR_ImpersonationLogins - AR_GoldenTickets - AR_KerberosWeakEncryption |
| MoveByPolicy             | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for selected policies.              | This stored procedure moves “old” database from one database to another in the following tables: - NvEvent - NvEvent_EventTracker - AttributeValue - OldAttributeValue - EventPolicy - E_LDAP - E_LDAP_EventTracker - E_LDAP2Policy                                                                                                                                                                          |
| MoveFSAnalytics          | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for File System Analytics.          | This stored procedure moves “old” data from one database into another in the following tables: - A_FS - A_FS2Policy - AR_FilesPerUser - AR_EventTracker                                                                                                                                                                                                                                                      |
| Move LDAP                | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for LDAP Event Type.                | This stored procedure moves “old” data from one database into another in the following tables: - E_LDAP - E_LDAP_EventTracker - E_LDAP2Policy                                                                                                                                                                                                                                                                |
| MoveNvEventsByEventType  | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for all Event Types except LDAP.    | This stored procedure moves “old” data from one database to another in the following tables: - NvEvent - NvEvent_EventTracker - AttributeValue - OldAttributeValue - EventPolicy                                                                                                                                                                                                                             |
| RdbPolicyCopy            | Called from the SQLAgent job if the “Move” operation is selected for database maintenance.                                    | This stored procedure creates a copy of the RdbPolicy table in the target database.                                                                                                                                                                                                                                                                                                                          |
