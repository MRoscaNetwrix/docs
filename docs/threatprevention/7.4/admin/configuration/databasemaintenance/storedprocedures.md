---
title: "Stored Procedures"
description: "Stored Procedures"
sidebar_position: 40
---

# Stored Procedures

The table contains a list of the stored procedures Threat Prevention uses on its SQL Server
databases. See the
[Database Maintenance Window](/docs/threatprevention/7.4/admin/configuration/databasemaintenance/overview.md)
topic for additional information.

| Name                     | When Threat Prevention Uses the Procedure                                                                                     | What the Stored Procedure Does                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DeleteAuthAnalytics      | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance for Authentication Analytics.     | This stored procedure deletes “old” data from the database in the following tables: <ul><li>A_Login</li><li>A_Login2Policy</li><li>AR_BruteForceAttacks</li><li>AR_UserAccountHackingAttacks</li><li>AR_HorizontalMovementAttacks</li><li>AR_BadUserIdByUser</li><li>AR_BadUserIdByHost</li><li>AR_BreachedPassword</li><li>AR_ConcurrentLogins</li><li>AR_DiamondPAC</li><li>AR_EventTracker</li><li>AR_ImpersonationLogins</li><li>AR_GoldenTickets</li><li>AR_KerberosWeakEncryption</li></ul>          |
| DeleteByPolicy           | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance for selected policies.            | This stored procedure deletes “old” data from the database in the following tables: <ul><li>NvEvent</li><li>NvEvent_EventTracker</li><li>AttributeValue</li><li>OldAttributeValue</li><li>EventPolicy</li><li>E_LDAP</li><li>E_LDAP_EventTracker</li><li>E_LDAP2Policy</li></ul>                                                                                                                                                                                                                           |
| DeleteFSAnalytics        | Called from the SQLAgent job if the “Delete” operation is selected for database maintenance File System Analytics.            | This stored procedure deletes “old” data from the database in the following tables: <ul><li>A_FS</li><li>A_FS2Policy</li><li>AR_FilesPerUser</li><li>AR_EventTracker</li></ul>                                                                                                                                                                                                                                                                                                                             |
| Delete LDAP              | Called from the SQL Agent job if the “Delete” operation is selected for database maintenance for the LDAP Event Type.         | This stored procedure deletes “old” data from the database in the following tables: <ul><li>E_LDAP</li><li>E_LDAP_EventTracker</li><li>E_LDAP2Policy</li></ul>                                                                                                                                                                                                                                                                                                                                             |
| DeleteNvEventByEventType | Called from the SQL Agent job if the “Delete” operation is selected for database maintenance for all Event Types except LDAP. | This stored procedure deletes “old” data from the database in the following tables: <ul><li>NvEvent</li><li>NvEvent_EventTracker</li><li>AttributeValue</li><li>OldAttributeValue</li><li>EventPolicy</li></ul>                                                                                                                                                                                                                                                                                            |
| MoveAuthAnalytics        | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for Authentication Analytics.       | This stored procedure moves “old” data from one database to another in the following tables: <ul><li>A_Login</li><li>A_Login2Policy</li><li>AR_BruteForceAttacks</li><li>AR_UserAccountHackingAttacks</li><li>AR_HorizontalMovementAttacks</li><li>AR_BadUserIdByUser</li><li>AR_BadUserIdByHost</li><li>AR_BreachedPassword</li><li>AR_ConcurrentLogins</li><li>AR_DiamondPAC</li><li>AR_EventTracker</li><li>AR_ImpersonationLogins</li><li>AR_GoldenTickets</li><li>AR_KerberosWeakEncryption</li></ul> |
| MoveByPolicy             | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for selected policies.              | This stored procedure moves “old” database from one database to another in the following tables: <ul><li>NvEvent</li><li>NvEvent_EventTracker</li><li>AttributeValue</li><li>OldAttributeValue</li><li>EventPolicy</li><li>E_LDAP</li><li>E_LDAP_EventTracker</li><li>E_LDAP2Policy</li></ul>                                                                                                                                                                                                              |
| MoveFSAnalytics          | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for File System Analytics.          | This stored procedure moves “old” data from one database into another in the following tables: <ul><li>A_FS</li><li>A_FS2Policy</li><li>AR_FilesPerUser</li><li>AR_EventTracker</li></ul>                                                                                                                                                                                                                                                                                                                  |
| Move LDAP                | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for LDAP Event Type.                | This stored procedure moves “old” data from one database into another in the following tables: <ul><li>E_LDAP</li><li>E_LDAP_EventTracker</li><li>E_LDAP2Policy</li></ul>                                                                                                                                                                                                                                                                                                                                  |
| MoveNvEventsByEventType  | Called from the SQLAgent job if the “Move” operation is selected for database maintenance for all Event Types except LDAP.    | This stored procedure moves “old” data from one database to another in the following tables: <ul><li>NvEvent</li><li>NvEvent_EventTracker</li><li>AttributeValue</li><li>OldAttributeValue</li><li>EventPolicy</li></ul>                                                                                                                                                                                                                                                                                   |
| RdbPolicyCopy            | Called from the SQLAgent job if the “Move” operation is selected for database maintenance.                                    | This stored procedure creates a copy of the RdbPolicy table in the target database.                                                                                                                                                                                                                                                                                                                                                                                                                        |

